/*
 Copyright 2012 Beta Cubed. All rights reserved.
 Polychart.js charting library. 
 This library uses the following projects.

 JSON2.js
 d3.js
 underscore.js
 underscore.string.js
 raphael.js
*/
var gg=function(){var j=j||{},f=f||{};if(!Aa)var Aa={log:function(){},assert:function(){},warn:function(){}};var ha=j,q=f,ab=function(a){if(!isFinite(a))return a;var b=""+a,c=Math.abs(a),d;1E3<=c&&(c=(""+c).split(/\./),d=c[0].length%3||3,c[0]=b.slice(0,d+(0>a))+c[0].slice(d).replace(/(\d{3})/g,",$1"),b=c.join("."));return b};q.makeClass=function(a,b){var c={},d=function(a,b){if(this instanceof d)"function"==typeof this.init&&this.init.apply(this,a===c?b:arguments);else return new d(c,arguments)};
2<=arguments.length&&(d.prototype=new b,d.prototype.constructor=d);q.undef(a)||(d.prototype._cls_name=a,d._class=!0);return d};q.undef=function(a){return"undefined"==typeof a};q.constfunc=function(a){return function(){return a}};q.invertedIndex=function(a){var b={};e.each(a,function(a,d){b[a]=d});return b};q.identity=function(a){return a};q.strlenToPixel=function(a,b){return"bold"==b?Math.max(7*a,0):Math.max(6*a,0)};q.cloneobj=function(a){var b=e.clone(a);b.constructor!=a.constructor&&(b.constructor=
a.constructor);e.has(a,"_attr")&&(b._attr=e.clone(a._attr));return b};q.postfix=function(a,b){var c={"0":"",3:"k",6:"m",9:"b",12:"t"};return!e.isUndefined(c[b])?a+c[b]:a+"e"+(0<b?"+":"-")+Math.abs(b)};q.prettify=function(a,b){var c=0,d=0;b=1==arguments.length?Math.floor(Math.log(Math.abs(a?a:1))/Math.LN10):-b;2==arguments.length&&(2==b||5==b||8==b||11==b)?(c=b+1,d=1):-1==b?(c=0,d=2==arguments.length?1:2):-2==b?(c=0,d=2==arguments.length?2:3):1==b||2==b?c=0:3<b&&6>b?c=3:6<b&&9>b?c=6:9<b&&12>b?c=9:
12<b&&15>b?c=12:(c=b,d=2==arguments.length?0:1);var g=Math.round(a/Math.pow(10,c-d)),g=g/Math.pow(10,d),g=g.toFixed(d);return q.postfix(ab(g),c)};q.roundTo=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c};q.array=function(a,b){for(var c=[],d=a,g,n=e.isFunction(b);d--;)g=n?b():b,c[d]=g;return c};q.grid=function(a,b,c){for(var d=0,g=0,n=[],h=e.isFunction(c),d=0;d<a;d++){for(var f=[],g=0;g<b;g++)h?f.push(c()):f.push(c);n.push(f)}return n};q.opts=function(){return function(a,b){0===arguments.length&&
ha.error(12,"Function opts() called with less than 1 parameter.");var c=this,d=this._optsUpdate,d=e.isFunction(d)?e.bind(d,this):function(){};if(1==arguments.length)return!e.isString(a)&&0<e.keys(a).length?(e.each(a,function(a,b){c._attr[b]=a;d(b,a)}),this):this._attr[a];q.assertString(a);this._attr[a]=b;d(a,b);return this}};q.singleOpts=function(a){return function(b){return 0===arguments.length?this.opts(a):this.opts(a,b)}};q.getAttr=function(){var a={};e.each(this._attr,function(b,c){!e.isNull(b)&&
(!e.isUndefined(b)&&-Infinity!=b&&Infinity!=b)&&(a[c]=b)});return a};q.dataGetter=function(a){a=a||{};var b=a.onChange;return function(a){if(0===arguments.length)return this._data;if(!a||"gg.data"!=a._cls_name)a=ha.data(a);this._data=a;b&&b.apply(this);return this}};q.doubleMap=function(a,b){return e.map(a,function(a){return e.map(a,b)})};q.tripleMap=function(a,b){return e.map(a,function(a){return e.map(a,function(a){return e.map(a,b)})})};q.compareBy=function(a){return function(b,c){var d,g;for(d=
0;d<a.length;d++)if(g=a[d],g=b[g]==c[g]?0:b[g]<c[g]?-1:1,0!==g)return g;return 0}};q.sortByMultiple=function(a,b){return a.sort(q.compareBy(b))};var Ka=[];q.concat=function(a){return Ka.concat.apply(Ka,a)};q.pushall=function(a,b){return Ka.push.apply(a,b)};q.add=function(a,b){var c=e.isFunction(a),d=e.isFunction(b);return c&&d?function(c){return a(c)+b(c)}:c?function(c){return a(c)+b}:d?function(c){return a+b(c)}:q.constfunc(a+b)};q.sub=function(a,b){var c=e.isFunction(a),d=e.isFunction(b);return c&&
d?function(c){return a(c)-b(c)}:c?function(c){return a(c)-b}:d?function(c){return a-b(c)}:q.constfunc(a-b)};q.evaluate=function(a,b){return e.isFunction(a)?a(b):a};q.unionType=function(a){a=e.uniq(e.reject(a,e.isNull));a.sort();return 0===a.length?null:1===a.length?a[0]:e.isEqual(a,["date","number"])?"date":e.include(a,"unknown")?"unknown":"category"};q.bool=function(a){return a?!0:!1};q.startswith=function(a,b){if(!e.isString(b)||!e.isString(a))return!1;var c=b.length;return c>a.length?!1:a.slice(0,
c)===b};q.instantiate=function(a){return e.isString(a)?ha[a]():a&&a.prototype&&a.prototype._cls_name?a():a};q.sum=function(){var a,b=0,c;if(e.isArray(this)){c=this.length;for(a=0;a<c;a++)b+=this[a]}c=arguments.length;for(a=0;a<c;a++)b+=arguments[a];return b};q.mergeArrays=function(a,b){var c=q.concat(a);b=b?b:q.identity;c=e.sortBy(c,b);return e.uniq(c,!0,b)};q.minimumDelta=function(a,b){if(1>=a.length)return null;var c=a.length,d,g;b=b?b:function(a){return a};var e=b(a[0]),h=Infinity;for(d=1;d<c;d++)g=
b(a[d]),h=Math.min(h,g-e),e=g;return h};q.isSuperset=function(a,b){for(var c=0,d=0;d<b.length;d++){for(;a[c]!=b[d]&&c<a.length;)c++;if(c==a.length)return!1}return!0};q.assertNumber=function(a){e.isNumber(a)||ha.warn(13,"Expecting a number but got "+a+".")};q.assertString=function(a){e.isString(a)||ha.warn(14,"Expecting a string but got "+a+".")};q.assertAes=function(a){e.include(ha.opts.aes,q.getBaseAes(a))||ha.error(11,"Aesthetics "+a+" does not exist.")};q.assertQuery=function(a){"data"===a||("aes"===
a||"aes_group"===a||"key"===a)||ha.error(-1,"Query type "+a+" is invalid.")};q.getBlank=function(a){return Array(a+1).join(" ")};q.qt=function(a){return'"'+a+'"'};q.toCode=function(a,b,c){a||(a=0);e.isNumber(b)||(b=a+2);c.cls||(c.cls=[]);c.params||(c.params=[]);c.funcs||(c.funcs=[]);var d=q.getBlank(a)+c.cls+"("+c.params.join(", ")+")";e.each(c.funcs,function(a){var c=a[0];a=a[1]||[];e.isArray(a)||(a=[a]);d+="\n"+q.getBlank(b)+"."+c+"("+a.join(", ")+")"});return d};q.toCodeBasic=function(a,b){var c=
{cls:this._cls_name};e.isFunction(this.getAttr)&&(c.funcs=[["opts",JSON.stringify(this.getAttr())]]);return q.toCode(a,b,c)};q.timer=function(){return{_time:new Date,mark:function(){this._time=new Date}}};q.getRandomColor=function(){function a(){return Math.floor(256*Math.random()).toString(16)}return"#"+a()+a()+a()};f.isDerivedAes=function(a){return-1<a.indexOf("_")};f.getBaseAes=function(a){return a.split("_",1)[0]};var La=f;La.isNode=function(a){return"object"===typeof window.Node?a instanceof
window.Node:a&&"object"===typeof a&&"number"===typeof a.nodeType&&"string"===typeof a.nodeName};La.isElement=function(a){return"object"===typeof window.HTMLElement?a instanceof window.HTMLElement:a&&"object"===typeof a&&1===a.nodeType&&"string"===typeof a.nodeName};La.isURL=function(a){var b=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return e.isString(a)&&b.test(a)};var j=j||{},f=f||{},bb=j;f.jQuery=function(){jQuery||bb.error(4,"jQuery is required, but is not found.");
return jQuery};var ua=f;ua.Observer=function(){this.callbacks=[]};ua.Observer.prototype.register=function(a,b,c){this.callbacks.push({key:a,callback:b,name:c})};ua.Observer.prototype.remove=function(a){this.callbacks=e.reject(this.callbacks,function(b){return b.callback===a})};ua.Observer.prototype.removeNamed=function(a){this.callbacks=e.reject(this.callbacks,function(b){return b.name===a})};ua.Observer.prototype.removeKey=function(a){this.callbacks=e.reject(this.callbacks,function(b){return b.key===
a})};ua.Observer.prototype.trigger=function(a,b){e.chain(this.callback).filter(function(b){return b.key===a}).each(function(a){a.callback(b)})};var cb=function(a){a.tooltip&&f.addTooltip(this,a.tooltip);return this},db=function(a,b){a&&this.dblclick(function(){var c=this.attr("data");a.call(this,c,b)});return this},U=function(a){a.ggTooltip=cb;a.ggDoubleClick=db};Raphael.fn.gg_point=function(a){V++;var b=a._offsetX,c=a._offsetY,d=this.circle().attr("postProcess",function(d){var e=d.cx,h=d.cy;d.cx=
b+a.transX(e,h);d.cy=c+a.transY(e,h);return d}),d=f.addMouseover(a,d);U(d);return d};Raphael.fn.gg_symbol=function(a){V++;var b=a._offsetX,c=a._offsetY,d=this.path().attr("postProcess",function(d){var e=d.cx,h=d.cy,f=b+a.transX(e,h),e=c+a.transY(e,h);d.path=j.symbol.makePath(d.symbol,f,e,d.r);delete d.cx;delete d.cy;delete d.symbol;delete d.r;return d}),d=f.addMouseover(a,d);U(d);return d};Raphael.fn.gg_text=function(a){V++;var b=a._offsetX,c=a._offsetY,d=this.text().attr("postProcess",function(d){var e=
d.x,h=d.y;d.x=b+a.transX(e,h);d.y=c+a.transY(e,h);d.text||(d.text=" ");return d}),d=f.addMouseover(a,d);U(d);return d};Raphael.fn.gg_cart_line=function(a){V++;var b=a._offsetX,c=a._offsetY,d=this.path().attr("postProcess",function(d){var e,h,f,s;f=c+a.transY(d.x1,d.y1);s=c+a.transY(d.x2,d.y2);e=b+a.transX(d.x1,d.y1);h=b+a.transX(d.x2,d.y2);delete d.x1;delete d.x2;delete d.y1;delete d.y2;d.path=[["M",e,f],["L",h,s]];return d}),d=f.addMouseover(a,d);U(d);return d};Raphael.fn.gg_cart_rect=function(a){V++;
var b=a._offsetX,c=a._offsetY,d=this.rect().attr("postProcess",function(d){var e,h,f,s,p;e=a.transX(d.x1,d.y1);h=a.transX(d.x2,d.y2);f=a.transY(d.x1,d.y1);s=a.transY(d.x2,d.y2);p=Math.min(e,h);h=Math.abs(h-e);e=Math.min(f,s);f=Math.abs(s-f);delete d.x1;delete d.x2;delete d.y1;delete d.y2;d.x=b+p;d.y=c+e;d.width=h;d.height=f;return d}),d=f.addMouseover(a,d);U(d);return d};var Ea=-Math.PI/2,eb=2*Math.PI-1E-6,Ma=function(a,b,c,d,g,e,h){return function(k){var s,p,u;a?(s=e(k),p=h(k),u=d(k)+Ea,k=g(k)+Ea):
(s=d(k),p=g(k),u=e(k)+Ea,k=h(k)+Ea);return f.d3_arc(b,c,s,p,u,k)}};f.d3_arc=function(a,b,c,d,g,e){if(d<c){var h=c;c=d;d=h}var f=(e<g&&(f=g,g=e,e=f),e-g),h=f<Math.PI?0:1,s=Math.cos(g),p=Math.sin(g),u=Math.cos(e),y=Math.sin(e);return f>=eb?c?[["M",a,b+d],["A",d,d,0,1,1,a,b-d],["A",d,d,0,1,1,a,b+d],["M",a,b+c],["A",c,c,0,1,0,a,b-c],["A",c,c,0,1,0,a,b+c],["Z"]]:d?[["M",a,b+d],["A",d,d,0,1,1,a,b-d],["A",d,d,0,1,1,a,b+d],["Z"]]:"":c?g==e?[["M",d*s+a,d*p+b],["L",c*u+a,c*y+b]]:[["M",d*s+a,d*p+b],["A",d,d,
0,h,1,d*u+a,d*y+b],["L",c*u+a,c*y+b],["A",c,c,0,h,0,c*s+a,c*p+b],["Z"]]:d?g==e?[["M",d*s+a,d*p+b],["L",c*u+a,c*y+b]]:[["M",d*s+a,d*p+b],["A",d,d,0,h,1,d*u+a,d*y+b],["L",a,b],["Z"]]:""};Raphael.fn.gg_polar_rect=function(a){V++;var b=a._offsetX,c=a._offsetY,d=a._flip,g=this.path().attr("preProcess",function(a){var g,e,f,p;g=a.x1;e=a.x2;f=a.y1;p=a.y2;delete a.x1;delete a.x2;delete a.y1;delete a.y2;a.path=Ma(d,b,c,g,e,f,p);return a}),g=f.addMouseover(a,g);U(g);return g};Raphael.fn.gg_cart_vline=function(a){V++;
var b=a._offsetX,c=a._offsetY,d=this.path().attr("postProcess",function(d){var e,f,k,s;k=c+a.transY(d.x,d.y1);s=c+a.transY(d.x,d.y2);e=b+a.transX(d.x,d.y1);f=b+a.transX(d.x,d.y2);d.path=[["M",e,k],["L",f,s]];delete d.x;delete d.y1;delete d.y2;return d}),d=f.addMouseover(a,d);U(d);return d};Raphael.fn.gg_polar_vline=function(a){V++;var b=a._offsetX,c=a._offsetY,d=a._flip,g=this.path().attr("preProcess",function(a){var g,e,f,p;g=e=a.x;f=a.y1;p=a.y2;delete a.x;delete a.y1;delete a.y2;a.path=Ma(d,b,c,
g,e,f,p);return a}),g=f.addMouseover(a,g);U(g);return g};Raphael.fn.gg_cart_hline=function(a){V++;var b=a._offsetX,c=a._offsetY,d=this.path().attr("postProcess",function(d){var e,f,k,s;k=c+a.transY(d.x1,d.y);s=c+a.transY(d.x2,d.y);e=b+a.transX(d.x1,d.y);f=b+a.transX(d.x2,d.y);d.path=[["M",e,k],["L",f,s]];delete d.x1;delete d.x2;delete d.y;return d}),d=f.addMouseover(a,d);U(d);return d};Raphael.fn.gg_polar_hline=function(a){V++;var b=a._offsetX,c=a._offsetY,d=a._flip,g=this.path().attr("preProcess",
function(a){var g,e,f,p;g=a.x1;e=a.x2;f=p=a.y;delete a.x1;delete a.x2;delete a.y;a.path=Ma(d,b,c,g,e,f,p);return a}),g=f.addMouseover(a,g);U(g);return g};f._path_function=function(a,b,c,d,g,n,f){var k=a._offsetX,s=a._offsetY;f=f.getObjects();n&&(f=e.sortBy(f,n));b=e.map(f,b);c=e.map(f,c);d&&d(b,c);g&&(c=g(b,c),b=c.x,c=c.y);d=[];g=!0;n=b.length;for(f=0;f<n;f++){var p=b[f],u=c[f];if(e.isNumber(p)&&e.isNumber(u)&&!e.isNaN(p)&&!e.isNaN(u)){var y=a.transX(p,u),p=a.transY(p,u);e.isNumber(y)&&e.isNumber(p)&&
(g?(d.push(["M",y+k,p+s]),g=!1):d.push(["L",y+k,p+s]))}}return d};f._ensureFunction=function(a){for(var b in a){var c=a[b];"function"!==typeof c&&(a[b]=f.constfunc(c))}};Raphael.fn.gg_path=function(a,b){V++;var c=this.path().attr("preProcess",function(c){var g=c._sort;delete c._sort;var n=c.x;delete c.x;var h=c.y;delete c.y;var k=c._pointModifier;delete c._pointModifier;c.path=e.bind(f._path_function,null,a,n,h,k,b,g);return c}),c=f.addMouseover(a,c);U(c);return c};f.configRaphaelAttributes=function(a){var b=
function(a,b){var g=this.attr("preProcess"),n=this.attr("postProcess");if(!a||!b)return{};if(b._style){b=e.clone(b);var h=b._style;b.stroke=h.stroke;b.fill=h.color;b["stroke-width"]=h.strokewidth;b["fill-opacity"]=h.opacity;delete b._style}f._ensureFunction(b);g&&(b=g(e.clone(b)));var g={},k;for(k in b)g[k]=(0,b[k])(a);return n?n(g):g};a.ca.func=function(a){return b.call(this,this.attr("data"),a)};a.ca.data=function(a){return b.call(this,a,this.attr("func"))};a.ca.postProcess=function(){};a.ca.preProcess=
function(){}};f.Raphael=Raphael;f.addMouseover=function(a,b){if(!a.opts("mouseover_highlight"))return b;b.mouseover(function(){var a=b.attr("fill"),d=b.attr("stroke");"none"!=a?(b.data("_old_fill",a),b.attr("fill",F.rgb(a).darker().toString())):0<b.attr("stroke-width")&&(b.data("_old_stroke",d),b.attr("stroke",F.rgb(d).darker().toString()));b.attr("cursor","hand")});b.mouseout(function(){b.attr("fill");"none"!=b.attr("fill")?b.attr("fill",b.data("_old_fill")):0<b.attr("stroke-width")&&b.attr("stroke",
b.data("_old_stroke"));b.attr("cursor","normal")});return b};var fb=function(a){var b=this.tooltipFn;(b=b(this.element.attr("data")))&&$(a.originalTarget||a.srcElement).tooltip({title:b,helper:$("#polychart-helper"),trigger:"manual",placement:"left"}).tooltip("show")},gb=function(a){$(a.originalTarget||a.srcElement).tooltip("hide")};f.addTooltip=function(a,b){if(b){var c={tooltipFn:b,element:a};a.hover(fb,gb,c,c)}return a};f.unbindAll=function(a){if(a.events)for(var b=a.events,c=0;c<b.length;c++)b[c].unbind();
a.removeData();for(var d in a)delete a[d]};var V=0;f.raphael_mark=function(){};var Na=j,Qa=function(a,b){this.code=a;this.msg=b;this.toString=function(){return"Error Code #"+a+": "+b}};Na.error=function(a,b){throw new Qa(a,b);};Na.warn=function(a,b){Aa&&Aa.log(new Qa(a,b))};Na.info=function(a){Aa&&Aa.log(a)};var z=j;z.opts={};z.opts.pivot={width:300,height:300,stat:"sum",columnFormatter:null,rowFormatter:null,title:null,"title-column":null,"title-row":null,"title-all":"all"};z.opts.graph={width:300,
height:300,"padding-left":null,"padding-right":null,"padding-top":null,"padding-bottom":null,"legend-position":"right","legend-width":60,"legend-height":30,"spacing-x":20,"spacing-y":40,"facet-x":20,title:"","title-size":15,"title-bold":!0,"label-size":12,"label-bold":!1,"axis-y":"left","axis-y-line":null,"axis-y-label":null,"axis-y-ticks":null,"axis-y-ticklength":null,"axis-y-color":null,"axis-y-strokewidth":null,"axis-y-":null,"axis-x":"bottom","axis-x-line":null,"axis-x-label":null,"axis-x-ticks":null,
"axis-x-ticklength":null,"axis-x-color":null,"axis-x-strokewidth":null,"grid-render-vertical":null,"grid-render-horizontal":null,"grid-stroke":null,"grid-strokewidth":null,"grid-dasharray":null,branding:!0,dom:null,filter:null,"render-make-default-scale":!0,"render-compute":!0,"render-impute-mapping":!0,tooltip:null,"callback-warn":null};z.opts.aes="color fill font fontsize group opacity radius size stats stroke strokewidth symbol text tooltip x y".split(" ");z.opts.aes.sort();z.opts.mainFill="steelblue";
z.opts.mainColor="black";z.opts.layer={x:"",y:1,color:z.opts.mainFill,opacity:0.9,stroke:"#FFFFFF",strokewidth:0,facet:!0,radius:3,visible:!0,"render-max":400};z.opts.point={stroke:z.opts.mainColor,strokewidth:1,radius:6,padding:0};z.opts.box={stroke:z.opts.mainColor,strokewidth:1,padding:0.1,width:1,align:"center"};z.opts.bar={stroke:z.opts.mainColor,strokewidth:1,width:1,align:"center"};z.opts.line={color:z.opts.mainColor,strokewidth:2,padding:0.5,radius:6};z.opts.text={opacity:1,color:"#000000",
font:"Verdana",text:"text label"};z.opts.gradient={low:"#cccccc",high:"steelblue"};z.opts.grid={dasharray:"- ",dashoffset:5,stroke:"#CCC",strokewidth:1,"render-vertical":!1,"render-horizontal":!0};z.opts.axis={color:"#000",fontsize:11,labels:!0,strokewidth:1,"ticklength-x":3,"ticklength-y":7,ticks:!0};z.opts.axis_x={line:!0};z.opts.axis_y={line:!1};z.opts.coord={mouseover_highlight:!0};z.opts.epsilon=Math.pow(10,-7);z.opts.theme_bw=function(){};var r=j;r.graph=f.makeClass("gg.graph");r.graph.prototype.init=
function(a){this._filteredData=this._paper=this._data=null;this._layers=[];this._scales={};this._facet=this._coord=null;this._attr=f.cloneobj(r.opts.graph);this._legend={};this._doms={};this._dimCache=null;this._rendered=!1;a&&this.data(a)};r.graph.prototype.data=f.dataGetter({onChange:function(){this._filterData()}});r.graph.prototype.getFilteredData=function(){return this._filteredData};r.graph.prototype.getAttr=function(){var a={};e.each(this._attr,function(b,c){if(!e.isNull(b)&&!e.isUndefined(b)&&
!(-Infinity===b||Infinity===b||e.isFunction(b)))if(f.isNode(b)){var d=b.getAttribute("id");null!==d&&""!==d&&(a[c]=d)}else a[c]=b});return a};r.graph.prototype._varlabel=function(a){var b=this.opts("label-"+a);if(!f.undef(b))return b;b=e.chain(this._layers).map(function(b){return b.map(a)}).filter(f.identity).value();return 0<b.length?b[0]:""};r.graph.prototype.getLayer=function(a){return this._layers[a]};r.graph.prototype.getLayerIndex=function(a){for(var b=0;b<this._layers.length;b++)if(a==this._layers[b])return b;
return-1};r.graph.prototype.removeLayer=function(a){var b=this._layers.length;this._layers=e.without(this._layers,a);return b!==this._layers.length};r.graph.prototype.addLayer=function(a,b){(a=f.instantiate(a))||r.error(201,"Attempting to add an undefined or malformed layer: "+a);var c=f.cloneobj(a);c.attach(this);null===b?this._layers.push(c):this._layers.splice(b,0,c);return this};r.graph.prototype.numLayers=function(){return this._layers.length};r.graph.prototype.getMapKeys=function(){return e.chain(this._layers).map(function(a){return e.keys(a.getMap())}).flatten().uniq().value()};
r.graph.prototype.isMapped=function(a,b){return b?(a=f.getBaseAes(a),e.any(this._layers,function(b){return e.any(e.keys(b.getMap()),function(b){return f.getBaseAes(b)===a})})):e.any(e.invoke(this._layers,"map",a))};r.graph.prototype.defaultMin=function(a,b){if(0===this._layers.length)return null;var c=e.chain(this._layers).invoke("defaultMin",a,b).filter(e.isNumber).min().value();return Infinity!=c?c:null};r.graph.prototype.defaultMax=function(a,b){if(0===this._layers.length)return null;var c=e.chain(this._layers).invoke("defaultMax",
a,b).filter(e.isNumber).max().value();return-Infinity!=c?c:null};r.graph.prototype.opts=f.opts();r.graph.prototype.warn=function(a,b){var c=this.opts("callback-warn");c?c({code:a,message:b}):r.warn(a,b)};r.graph.prototype._optsUpdate=function(a,b){this._rendered&&("title"==a?this._update_label("_debug_title",b):"label-x"==a?this._update_label("_debug_x_label",b):"label-y"==a&&this._update_label("_debug_y_label",b));"dom"===a&&this._clearCache();this._clearDimCache()};r.graph.prototype.layer=function(a){return this.addLayer(a,
null)};r.graph.prototype.coord=function(a){if(0===arguments.length)return this._coord;a=f.instantiate(a);var b=null,b=f.cloneobj(a);b.attach(this);this._coord=b;return this};r.graph.prototype.facet=function(a){if(0===arguments.length)return this._facet;if(null===a)this._facet=null;else{(a=f.instantiate(a))||r.error(201,"Attempting to add an undefined or malformed facet: "+a);var b=f.cloneobj(a);b.attach(this);this._facet=b}this._clearCanvas();return this};r.graph.prototype._update_label=function(a,
b){var c=this._doms[a];c&&c.attr("text",b)};r.graph.prototype.dimensions=function(a){if(!this._dimCache||!0===a)this._dimCache=this._calculateDims();return this._dimCache};r.graph.prototype._calculateDims=function(){var a=this._facet?this._facet.ncol():1,b=this._facet?this._facet.nrow():1,c=1<b*a,d=0,g=0,e=0,h=null==this.opts("padding-top")?20:this.opts("padding-top"),k=null==this.opts("padding-left")?50:this.opts("padding-left"),s=null==this.opts("padding-right")?50:this.opts("padding-right"),p=
null==this.opts("padding-bottom")?50:this.opts("padding-bottom");this._legend&&this._legend._aes&&(g=this._legend.width(),e=this._legend.height());this._axes&&this._axes.y&&(d=this._axes.y.width());var u=this.opts("axis-y"),y=this.opts("axis-x"),j=this.opts("legend-position"),h=Math.max(h,30+25*("top"==y)-c*this.opts("spacing-x")),p=Math.max(p,30+20*("bottom"==y)+e),k=Math.max(Math.min(30+("left"==u)*d+("left"==j)*g,0.25*this.opts("width")),k),s=Math.max(Math.min(15+("right"==u)*d+("right"==j)*g,
0.25*this.opts("width")),s),d=this.opts("width")-k-s,g=this.opts("height")-h-p;f.assertNumber(d);f.assertNumber(g);e=c?this.opts("spacing-x"):0;c=c?this.opts("spacing-y"):0;return{ncol:a,nrow:b,paddingLeft:k,paddingRight:s,paddingTop:h,paddingBottom:p,chartWidth:d,chartHeight:g,eachWidth:(d-(a-1)*e)/a,eachHeight:(g-b*c)/b,spacingX:e,spacingY:c,xLabelY:"bottom"==y?h+g+30:30,yLabelX:"left"==u?15:k+d+s-5,additionalScales:!!this._legend&&!!this._legend._aes}};r.graph.prototype.getAxisOffset=function(a,
b,c){var d=this.dimensions();b=this.xposition(b);a=this.yposition(a);var g=d.eachWidth,d=d.eachHeight,e="gg.coord.polar"===this.coord()._cls_name,f=this.coord()._flip!==e?"x":"y";"right"==c?b+=g:"bottom"==c?a+=d:"center"==c?(b+=g/2,a+=d/2):"left"==c&&e&&(b-=9,a+=d/2-this._scales[f].range()[1]);return{x:b-0.5,y:a-0.5}};r.graph.prototype.createOffsetCoord=function(a,b){var c=new r.coord.cart;c.attach(this);c.opts("mouseover_highlight",!1);return c.differentOffset(a,b)};r.graph.prototype.makeplot=function(a){var b=
this.opts("width"),c=this.opts("height"),d;a?e.isString(a)?(d="#"==a.charAt(0)?a.substring(1):a,(d=document.getElementById(d))||r.error(212,"Invalid dom for .opts('dom') - "+a)):d=a:r.error(212,"Invalid dom for .opts('dom') - "+a);a=f.Raphael(d,b,c);f.configRaphaelAttributes(a);return a};r.graph.prototype.setDefaultCoord=function(){this._coord||this.coord(r.coord.cart());return this};r.graph.prototype.filter=function(a){if(0===arguments.length)return this.opts("filter");this.opts("filter",a);this._filterData();
return this};r.graph.prototype._filterData=function(){this._filteredData=this.opts("filter")?this.data().filter(this.opts("filter")):this.data()};var Ra=function(a){a&&(a.forEach(function(a){f.unbindAll(a)}),a.clear())};r.graph.prototype._clearCache=function(){Ra(this._paper);this._paper=null;this._doms={};this._dimCache=null;this._rendered=!1};r.graph.prototype._clearCanvas=function(){Ra(this._paper);this._doms={};this._dimCache=null;this._rendered=!1};r.graph.prototype._clearDimCache=function(){this._dimCache=
null};r.graph.prototype._preRender=function(a){this._debugStartTime=new Date;a&&this.opts("dom",a);if(this._paper){a=this.opts("width");var b=this.opts("height");this._paper.setSize(a,b);this._clearCanvas()}else this._paper=this.makeplot(this.opts("dom"))};r.graph.prototype._postRender=function(){var a=new Date-this._debugStartTime;this._rendered=!0;r.info("render() took "+a+" ms.");this._renderingTime=a};r.graph.prototype.xposition=function(a){var b=this.dimensions();return b.paddingLeft+a*(b.eachWidth+
b.spacingX)};r.graph.prototype.yposition=function(a){var b=this.dimensions();return b.paddingTop+a*(b.eachHeight+b.spacingY)+b.spacingY};r.graph.prototype._defaultComputeOptions=function(){return{defaultScale:this.opts("render-make-default-scale"),imputeMapping:this.opts("render-impute-mapping")}};r.graph.prototype.compute=function(a){a=a||this._defaultComputeOptions();var b=this;this._facet&&this._facet.prepare();a.imputeMapping&&e.invoke(this._layers,"attachDerivedMappings");e.invoke(this._layers,
"resetCalculate");e.invoke(this._layers,"calculate");a.defaultScale&&e.each(this.makeDefaultScales(),function(a,d){b.scale(d,a)});this.setDefaultCoord();this._setupAxes();a=this.opts("legend-position");this._legend="none"!=a?r.guide.legend(this,this._layers,this._scales,a):null;this.dimensions(!0);this.computeScale()};r.graph.prototype.render=function(a){this._preRender(a);this._timer=a=f.timer();f.raphael_mark();this.opts("render-compute")&&(this.compute(),a.mark("compute()"),f.raphael_mark("compute()"));
this.bindDerivedScales();a.mark("bindDerivedScales()");f.raphael_mark("bindDeriveScales()");var b=this.checkLayerError();this.renderPrimary(b);f.raphael_mark("renderPrimary()");this.renderAllFacetLabel();a.mark("renderAllFacetLabel()");f.raphael_mark("renderAllFacetLabel()");this.renderOtherLabel();a.mark("renderOtherLabel()");f.raphael_mark("renderOtherLabel()");this.renderLegend();a.mark("renderLegend()");f.raphael_mark("renderOtherLabel()");this.opts("branding")&&this.render_branding();this._postRender();
return this};r.graph.prototype.checkLayerError=function(){return e.invoke(this._layers,"checkErrors",{rawScales:this._scales,coord:this._coord})};r.graph.prototype.toCode=function(a,b,c){var d=[];a||(a=0);var g=a+this._cls_name.length+3;c?d=[c]:this._data&&(d=[this._data.toCode(a,g)]);var n={cls:this._cls_name,params:d,funcs:[]};e.each(this._layers,function(b){n.funcs.push(["layer",b.toCode(a,g)])});e.each(this._scales,function(b,c){if(b){var d=f.qt(c);n.funcs.push(["scale",[d,b.toCode(a,g+d.length+
2)]])}});this._coord&&n.funcs.push(["coord",this._coord.toCode(a,g)]);this._facet&&n.funcs.push(["facet",this._facet.toCode(a,g)]);var h=this.getAttr();e.each(h,function(a,b){"render"==b.split("-")[0]&&delete h[b]});n.funcs.push(["opts",JSON.stringify(h)]);return f.toCode(a,b,n)};var w=j;w.coord=w.coord||{};w.coord.base=f.makeClass("gg.coord.base");w.coord.base.prototype.init=function(){this._graph=null;this._detached=!0;this._offsetY=this._offsetX=0;this._attr=e.clone(w.opts.coord);this._flip=null};
w.coord.base.prototype.flip=function(){this._flip=!this._flip};w.coord.base.prototype.opts=f.opts();w.coord.base.prototype.differentOffset=function(a,b){var c=f.cloneobj(this);c._offsetX+=a;c._offsetY+=b;c._attr=f.cloneobj(this._attr);return c};w.coord.base.prototype.attach=function(a){this._detached||w.error(600,"This coordinate is already attached to a graph. Unexpected behaviour may occur.");this._detached=!1;this._graph=a;return this};w.coord.base.prototype.getPaper=function(){return this._graph._paper};
w.coord.base.prototype.set=function(a,b){this.attr[a]=b;return this};w.coord.base.prototype.configScale=function(){w.error(10,"Not implemented.")};w.coord.base.prototype.transX=function(){w.error(10,"Not implemented.")};w.coord.base.prototype.transY=function(){w.error(10,"Not implemented.")};w.coord.base.prototype.drawAxis=function(){w.error(10,"Not implemented.")};w.coord.base.prototype.line=function(){w.error(10,"Not implemented.")};w.coord.base.prototype.vline=function(){w.error(10,"Not implemented.")};
w.coord.base.prototype.hline=function(){w.error(10,"Not implemented.")};w.coord.base.prototype.rect=function(){w.error(10,"Not implemented.")};w.coord.base.prototype.point=function(){return this.getPaper().gg_symbol(this)};w.coord.base.prototype.poly=function(){return this.getPaper().gg_path(this)};w.coord.base.prototype.text=function(){return this.getPaper().gg_text(this)};w.coord.base.prototype.toCode=f.toCodeBasic;var B=j;B.facet=B.facet||{};B.facet.base=f.makeClass("gg.facet.base");B.facet.base.prototype.init=
function(){this._graph=null;this._detached=!0;this._attr={free_x:!1,free_y:!1}};B.facet.base.prototype.attach=function(a){this._detached||this.warn(700,"This facet is already attached to a graph. Unexpected behaviour may occur.");this._graph=a;this._detached=!1};B.facet.base.prototype.opts=f.opts();B.facet.base.prototype.warn=function(a,b){this._detached?B.warn(a,b):this._graph.warn(a,b)};B.facet.base.prototype.calculate=function(a){var b=this.nrow()*this.ncol(),c=f.array(b,function(){return a.clone()}),
d,g=a.len();for(d=0;d<g;d++){var e=a.getObject(d),h=this.bin(e);h<b?c[h].push(e):B.warn(702,"Facet number of cells is too small, ignoring data row number "+d)}return c};B.facet.base.prototype.getAttr=f.getAttr;B.facet.base.bin=function(){B.error(10,"Not implemented.")};B.facet.base.prototype.ncol=function(){B.error(10,"Not implemented.")};B.facet.base.prototype.nrow=function(){B.error(10,"Not implemented.")};B.facet.base.prototype.isValidIndex=function(){return!0};B.facet.base.prototype.renderLabel=
function(){B.error(10,"Not implemented.")};B.facet.base.prototype.toCode=f.toCodeBasic;var Ba=j;Ba.guide=Ba.guide||{};Ba.guide.base=f.makeClass("gg.guide.base");Ba.guide.base.prototype.init=function(){this._attr={num_ticks:5}};Ba.guide.base.prototype.opts=f.opts();var m=j,Fa={};m.layer=m.layer||{};m.layer.base=f.makeClass("gg.layer.base");var L=function(a,b){e.isFunction(a)?(this.val=a._name?a._name:e.uniqueId("$func:"),this.code=a,this.functionMapping=!0):this.val=a;this.defaultMapping=f.bool(b)};
L.prototype.val=null;L.prototype.code=null;L.prototype.defaultMapping=!1;L.prototype.functionMapping=!1;m.layer.base.prototype.init=function(a){this._attr=f.cloneobj(m.opts.layer);this._statData=this._facetedData=this._data=this._graph=null;this._stats=void 0;this._detached=!0;this._default_stats=m.stats.id;this._calculated=!1;this.opts("domain",null);a&&this.data(a)};m.layer.base.prototype.warn=function(a,b){this._detached?m.warn(a,b):this._graph.warn(a,b)};m.layer.base.prototype.opts=f.opts();m.layer.base.prototype.data=
function(a){if(0===arguments.length)return this._data===Fa?this._graph.getFilteredData():this._data;if(a!==Fa&&(!a||"gg.data"!=a._cls_name))a=m.data(a);this._data=a;return this};m.layer.base.prototype.stats=function(a){if(1===arguments.length)return(a=f.instantiate(a))||m.error(304,"Attempting to add an undefined or malformed statistic: "+a),this._stats=a,this.resetCalculate(),this;e.isUndefined(this._stats)&&(this._stats=this._default_stats());return this._stats};m.layer.base.prototype.attach=function(a){this._detached||
this.warn(300,"This layer is already attached to a graph. Unexpected behaviour may occur.");this.data()||this.data(Fa);this._detached=!1;this._graph=a;return this};m.layer.base.prototype.resetCalculate=function(){this._calculated=!1};m.layer.base.prototype.defaultMin=function(){};m.layer.base.prototype.defaultMax=function(){};m.layer.base.prototype.requiredMap=function(){return null};m.layer.base.prototype.calculatePartials=function(){return!1};m.layer.base.prototype.layerGroup=function(){return[]};
m.layer.base.prototype.needDefined=function(){return["x","y"]};m.layer.base.prototype.calculateStats=function(a){var b=this.getMap(),c=this.getAttr(),d=e.chain(this.needDefined()).map(function(a){return b[a]}).filter(function(a){return a}).value();!this.hasGroup()&&b.group&&delete b.group;c={mapping:b,attr:c,need:d,layer_group_aes:this.layerGroup(),no_partials:!this.calculatePartials()};return this.stats().calculateStats(a,c)};m.layer.base.prototype.hasGroup=function(){return!0};m.layer.base.prototype.calculate=
function(){this._detached&&this.warn(301,"Calculating statistics on a detached layer.");if(!this._calculated){this.checkStatsRequiredMapping();this.checkLayerRequiredMapping();this.checkInvalidMapping();var a=this._getFacet();this._facetedData=a?a.calculate(this.data()):[this.data()];a=e.bind(this.calculateStats,this);this._statData=e.map(this._facetedData,a);var b=e.bind(this._bindFunctionMapping,this);e.each(this._statData,function(a){e.each(a,b)});this._calculated=!0;return this}};m.layer.base.prototype._map=
function(a,b){this._attr[a]=new L(b)};m.layer.base.prototype.map=function(a,b){var c=this;0===arguments.length&&m.error(12,"Function map() called with less than 1 parameter.");if(1===arguments.length){if(!e.isString(a)&&0<e.keys(a).length)return e.each(e.keys(a),function(a){f.assertAes(a)}),e.each(a,function(a,b){c._map(b,a)}),this.resetCalculate(),this;f.assertAes(a);var d=this._attr[a];return d instanceof L?d.val:null}f.assertAes(a);e.isUndefined(b)||null===b?this.unset(a):this._map(a,b);this.resetCalculate();
return this};m.layer.base.prototype.isDefaultMap=function(a){a=this._attr[a];return a instanceof L?a.defaultMapping:!1};m.layer.base.prototype.getAttr=function(){var a={};e.each(this._attr,function(b,c){b instanceof L||(a[c]=b)});return a};m.layer.base.prototype.getMap=function(){var a={};e.each(this._attr,function(b,c){b instanceof L&&(a[c]=b.val)});return a};m.layer.base.prototype.unset=function(a){e.has(this._attr,a)&&delete this._attr[a];e.has(m.opts.layer,a)&&(this._attr[a]=m.opts.layer[a]);
return this};m.layer.base.prototype.getAestheticsGroup=function(a){var b=a+"_",c=this.getMap(),d={};e.chain(c).keys().filter(function(c){return c==a||f.startswith(c,b)}).map(function(a){d[a]=c[a]});d.y&&d.y_override&&delete d.y;return d};m.layer.base.prototype.getData=function(a,b){if(!this.data())return null;var c=this.map(a);return!c?null:this.data().get(c,b)};m.layer.base.prototype.getScales=function(a){var b=a.rawScales,c,d={};e.each(this._attr,function(g,n){if(g instanceof L){var h=b[n];h&&(d[n]=
e.bind(h.apply,h,g.val))}else"x"==n||"y"==n?(c=b[n],a["free_"+n]&&"category"==c._type&&c.make(this._levels(n,null,a.facetId)),d[n]=f.constfunc(c.apply(g))):d[n]=f.constfunc(g)});return d};m.layer.base.prototype.renderEntry=function(a){this.calculate();a.computedData=this.hasGroup()?this._statData[a.facetIndex]:this._statData[a.facetIndex][0];a.scales=this.getScales(a);var b=null,b=a.rawScales.x.width();a.align="center";a.width=b;a.computedData&&this.opts("visible")&&this.render(a)};m.layer.base.prototype.checkErrors=
function(){return 0===e.keys(this.getMap()).length?(this.warn(320,"No mapping has been set in layer "+this._cls_name),!0):!1};m.layer.base.prototype.render=function(){m.error(10,"Not implemented.")};m.layer.base.prototype.queryData=function(a,b,c,d,g){if("data"===b)return c(a,this.data());this.calculate();b=b||"aes_group";g=e.isNumber(g)?g:-1;g>this._statData.length&&m.error(-1,"Attempting to access facet id "+g+" when there are only "+this._statData.length);var n=-1==g?f.doubleMap:e.map,h=-1==g?
this._statData:this._statData[g],k;"aes_group"===b?(a=e.values(this.getAestheticsGroup(a)),a=e.map(a,function(a){return n(h,e.bind(c,null,a))}),a=f.concat(a)):("key"===b?k=a:"aes"===b?k=this.map(a):this.warn(-1,"Should not reach here."),a=n(h,e.bind(c,null,k)));a=f.concat(a);return d(a)};m.layer.base.prototype.min=function(a,b,c){var d=this.type(a,b),d=m.type.fromString(d).min;return this.queryData(a,b,function(a,b){return b.min(a)},d,c)};m.layer.base.prototype.max=function(a,b,c){var d=this.type(a,
b),d=m.type.fromString(d).max;return this.queryData(a,b,function(a,b){return b.max(a)},d,c)};m.layer.base.prototype.levels=function(a,b,c){var d=this.type(a,b),g=m.type.fromString(d);return this.queryData(a,b,function(a,b){return b.levels(a)},function(a){return f.mergeArrays(a,g.represent)},c)};m.layer.base.prototype.type=function(a,b,c){return this.queryData(a,b,function(a,b){return b.type(a)},f.unionType,c)};m.layer.base.prototype.checkStatsRequiredMapping=function(){var a=this.stats().requiredMap()||
[],a=e.difference(a,e.keys(this.getMap()));0<a.length&&m.error(302,"Variable need to be mapped to the following aesthetics: "+a.join(", "))};m.layer.base.prototype.checkLayerRequiredMapping=function(){var a=this.stats().requiredMap()||[],a=e.difference(a,e.keys(this.getMap()));0<a.length&&m.error(302,"Variable need to be mapped to the following aesthetics: "+a.join(", "))};m.layer.base.prototype._bindFunctionMapping=function(a){var b=this._getFunctionMappings();e.each(b,function(b){var d=b.val;a.hasKey(d)||
a.derive(b.code,d)})};m.layer.base.prototype._getFunctionMappings=function(){var a=[];e.each(this._attr,function(b){b instanceof L&&b.functionMapping&&a.push(b)});return a};m.layer.base.prototype.getInvalidMapping=function(){var a=this,b=this.data().keys(),c=this.stats().keys(),d=e.union(b,c),g={};e.each(this.getMap(),function(b,c){e.include(d,b)||a.opts(c).functionMapping||(g[c]=b)});return g};m.layer.base.prototype.checkInvalidMapping=function(){var a=this.getInvalidMapping();0<e.size(a)&&(a=e.map(a,
function(a,c){return"Mapping of aesthetics "+c+" to variable "+a+" is invalid."}),m.error(303,a.join("\n")))};m.layer.base.prototype.checkAllMapping=function(){this.checkStatsRequiredMapping();this.checkInvalidMapping()};m.layer.base.prototype.imputeMapping=function(a,b){var c={};if(!a||!b)return c;e.each(b,function(b,g){if(!a[g])if(e.isArray(b))for(var f=0;f<b.length;f++){var h=b[f];if(a[h]){f=g;h=a[h];a[f]=h;c[f]=h;break}}else a[b]&&(h=a[b],a[g]=h,c[g]=h)});return c};m.layer.base.prototype._removePreviousDefaults=
function(){var a=this;e.each(this._attr,function(b,c){b instanceof L&&b.defaultMapping&&delete a._attr[c]})};m.layer.base.prototype._getFacet=function(){return this._graph?this._graph.facet():null};m.layer.base.prototype._attachImputed=function(a,b){var c=this._attr[a];e.isUndefined(c)||!(c instanceof L)?this._attr[a]=new L(b,!0):c instanceof L&&c.defaultMapping&&(this._attr[a].value=b)};m.layer.base.prototype.attachDerivedMappings=function(){this._removePreviousDefaults();var a=this,b=this.stats(),
c=this.getMap(),d=this.imputeMapping(c),b=b?b.imputeMapping(c):{},d=e.defaults({},d,b);e.each(d,function(b,c){a._attachImputed(c,b)});return d};m.layer.base.prototype.toCode=function(a,b){var c={cls:this._cls_name};this._data&&this._data!==Fa&&(c.params=[this._data.toCode(a,a+this._cls_name.length+3)]);c.funcs=[["opts",JSON.stringify(this.getAttr())]];var d=this.getMap();e.each(d,function(a,b){e.include(m.opts.aes,b.split("_")[0])||delete d[b];"tooltip"==b&&delete d[b]});0<e.keys(d).length&&c.funcs.push(["map",
JSON.stringify(d)]);this._stats&&c.funcs.push(["stats",this._stats.toCode()]);return f.toCode(a,b,c)};m.layer.base.prototype.fillZero=function(a,b,c){var d=this.map("x"),g=this.opts("domain"),f=a.levels(d),h=a.getRaw().slice(),k=b.rawScales.x.opts("domain_low");b=b.rawScales.x.opts("domain_high");for(var s={},p=function(a){s[a]=0};k<=b;)e.include(f,k)||(s={},s[d]=k,e.each(c,p),h.push(s)),k=g(k);return a.clone(h)};var v=j,hb=function(a,b,c){this.data=a;this.label=c;this.pos=b};v.scale=v.scale||{};
v.scale.base=f.makeClass("gg.scale.base");v.scale.base.prototype.init=function(){this._graph=this._aes=null;this._detached=!0;this._type=null;this._attr={pixel_per_tick_x:60,pixel_per_tick_y:30,ticks:null,numticks:null,min:null,max:null,absolute_min:-Infinity,absolute_max:Infinity,domain_low:null,domain_high:null,range_low:null,range_high:null};this._facetIndex=-1};v.scale.base.prototype.opts=f.opts();v.scale.base.prototype.warn=function(a,b){this._detached?v.warn(a,b):this._graph.warn(a,b)};v.scale.base.prototype.CONTINUOUS=
!1;v.scale.base.prototype.DISCRETE=!1;v.scale.base.prototype.getAttr=f.getAttr;v.scale.base.prototype.attach=function(a,b){this._detached||this.warn(400,"This scale is already attached to a graph. Unexpected behaviour may occur.");a||v.error(401,"Attempting to attach a scale to an empty graph.");b||v.error(402,"Scale type "+this._cls_name+" cannot to be attached to aesthetics "+b+".");this._aes=b;this._graph=a;this._detached=!1};v.scale.base.prototype.min=function(a){var b=this._attr.absolute_min;
return 1===arguments.length?(e.isNumber(b)&&a<b&&(this.warn(403,"Minimum cannot be set below "+b+". Using "+b+" instead of "+a+"."),a=b),this._attr.min=a,this):this._attr.min};v.scale.base.prototype.max=function(a){var b=this._attr.absolute_max;return 1===arguments.length?(e.isNumber(b)&&a>b&&(this.warn(403,"Maximum cannot be set above "+b+". Using "+b+" instead of "+a+"."),a=b),this._attr.max=a,this):this._attr.max};v.scale.base.prototype.rangeSize=function(){return Math.abs(this._attr.range_low-
this._attr.range_high)};v.scale.base.prototype.type=function(){return this._type};v.scale.base.prototype._saneNumber=function(a){return e.isNumber(a)&&!isNaN(a)&&Infinity!=a&&-Infinity!=a};v.scale.base.prototype._makeDomain=function(){var a=this._aes,b=this._graph.min(a),c=this._graph.defaultMin(a,b),d=this._graph.max(a),a=this._graph.defaultMax(a,d);this._attr.domain_low=e.chain([b,this._attr.min,c]).filter(e.isNumber).min().value();this._attr.domain_high=e.chain([d,this._attr.max,a]).filter(e.isNumber).max().value();
return[this._attr.domain_low,this._attr.domain_high]};v.scale.base.prototype.domain=function(a){return 1===arguments.length?(this._attr.min=a[0],this._attr.max=a[1],this):[this._attr.min,this._attr.max]};v.scale.base.prototype.range=function(a){return 1===arguments.length?(this._attr.range_low=a[0],this._attr.range_high=a[1],this):!e.isUndefined(this._attr.range_low)&&!e.isUndefined(this._attr.range_high)?[this._attr.range_low,this._attr.range_high]:null};v.scale.base.prototype.make=function(){v.error(10,
"Not implemented.")};v.scale.base.prototype._apply=function(){v.error(10,"Not implemented.")};v.scale.base.prototype.apply=function(a,b){1==arguments.length&&(b=a,a=void 0);b&&"gg.data"===b._cls_name&&(b=b.getObject(0));var c=e.isUndefined(a)||e.isUndefined(b[a])?b:b[a];return this._apply(c)};v.scale.base.prototype._tickObject=function(a,b,c){return new hb(a,b,c)};v.scale.base.prototype._suggestNumticks=function(a,b,c){e.isNumber(a)||(a=null);null===a&&(a=this.opts("numticks"),e.isNull(a)&&(a=this.rangeSize(),
e.isNumber(c)&&0<c||(c="x"==this._aes==Boolean(b)?this.opts("pixel_per_tick_y"):this.opts("pixel_per_tick_x")),a/=c));return Math.ceil(a)};v.scale.base.prototype.ticks=function(){v.error(10,"Not implemented.")};v.scale.base.prototype.maxLabelWidth=function(){v.error(10,"Not implemented.")};v.scale.base.prototype.toCode=f.toCodeBasic;var O=j;O.stats=O.stats||{};O.stats.base=f.makeClass("gg.stats.base");O.stats.base.prototype.init=function(){this._attr={}};O.stats.base.prototype.imputeMapping=function(a,
b){var c={};if(!a||!b)return c;e.each(b,function(b,g){if(!a[g])if(e.isArray(b))for(var f=0;f<b.length;f++){var h=b[f];if(a[h]){f=g;h=a[h];a[f]=h;c[f]=h;break}}else a[b]&&(h=a[b],a[g]=h,c[g]=h)});return c};O.stats.base.prototype.requiredMap=function(){return null};O.stats.base.prototype.compute=function(a){return a};O.stats.base.prototype.postProcess=function(a){return a};O.stats.base.prototype.calculateStats=function(a,b){return this.group(a,b)};O.stats.base.prototype.group=function(a,b){var c=this,
d=b.mapping,g={},n=b.groupFunctions||{};b.need||(b.need=[]);var h=function(a){for(var c=0;c<b.need.length;c++)if(e.isNull(a[b.need[c]]))return!1;return!0};e.each(d,function(a,b){"group"==f.getBaseAes(b)&&(g[a]=n[b]||f.identity)});var k=a.group(g),k=e.map(k,function(a){return c.compute(a,b)});if(!b.no_partials){var s=b.mapping.x,p={};s&&(p[s]=g[s]||f.identity);var k=O.data.group(k,p,h),u={};e.each(d,function(b,c){"group"==f.getBaseAes(c)&&("group_stats"!==c&&!u[c])&&(u[b]=a.levels(b))});k=this.postProcess(k,
b,u)}var y={};e.each(b.layer_group_aes||["group"],function(a){(a=d[a])&&(y[a]=n[a]||f.identity)});return k=O.data.group(k,y,h)};O.stats.base.prototype.keys=function(){return[]};O.stats.base.prototype.toCode=f.toCodeBasic;var A=j;A.type={};var Oa=null;A.type.fromString=function(a){null===Oa&&(Oa={number:new A.type.number,category:new A.type.category,unknown:new A.type.unknown,date:new A.type.date});a||(a="unknown");var b=Oa[a];b||A.error(800,"No such type "+a+".");return b};A.type.base=f.makeClass("gg.type.base");
A.type.base.prototype.init=function(){e.bindAll(this,"min","max")};A.type.base.prototype.min=function(){A.error(10,"Not implemented.")};A.type.base.prototype.max=function(){A.error(10,"Not implemented.")};A.type.base.prototype.ticks=function(){A.error(10,"Not implemented.")};A.type.base.prototype.coerce=function(){A.error(10,"Not implemented.")};A.type.base.prototype.validate=function(){A.error(10,"Not implemented.")};A.type.base.prototype.defaultScale=function(){A.error(10,"Not implemented.")};A.type.base.prototype.represent=
function(){A.error(10,"Not implemented.")};A.type.base.prototype._postProcess=function(a,b){"opacity"==a?b.range([0.2,0.9]):"strokewidth"==a?b.range([0,5]):"radius"==a&&(b.opts("transform","sqrt"),b.range([0.5,10]),b.min(0))};var aa=j;aa.stats.aggregate=f.makeClass("gg.stats.aggregate",aa.stats.base);aa.stats.aggregate.prototype.init=function(){aa.stats.base.prototype.init.call(this)};aa.stats.aggregate.prototype.calculateStats=function(a,b){return this.group(a,b)};aa.stats.aggregate.prototype.imputeMapping=
function(a,b){return aa.stats.base.prototype.imputeMapping.call(this,a,b)};aa.stats.aggregate.prototype.keys=function(){return[]};aa.stats.aggregate.prototype.makeMeta=function(a){var b=a.metas();a=this.keys();e.each(a,function(a){e.contains(b,a)||(b[a]={type:"number"})});return b};var ba=j;ba.stats.sum=f.makeClass("gg.stats.sum",ba.stats.aggregate);ba.stats.sum.prototype.compute=function(a,b){var c=b.mapping,d=a.len(),g=c.y,c=a.getObject(0);if(g){for(var n=1;n<d&&e.isNull(c[g]);)c=a.getObject(n),
n++;d=f.sum.apply(a.get(g));c.$sum=d}else c.$sum=b.attr.y*a.len();d=this.makeMeta(a);return ba.data([c],d)};ba.stats.sum.prototype.imputeMapping=function(a){a=ba.stats.aggregate.prototype.imputeMapping.call(this,a,{group_stats:"x"});return e.extend(a,{y_override:"$sum",y_1:"$partial_1",y_2:"$partial_2"})};ba.stats.sum.prototype.keys=function(){return ba.stats.aggregate.prototype.keys.call(this).concat(["$sum","$partial_1","$partial_2"])};ba.stats.sum.prototype.postProcess=function(a,b,c){var d=[],
g=e.keys(c),n={plus:0,minus:0},h="",k={},s=function(a){h=0<=a.$sum?"plus":"minus";a.$partial_1=n[h];a.$partial_2=a.$partial_1+a.$sum;n[h]+=a.$sum;d.push(a)},p=function(a){var b=e.clone(k);b.$partial_1=n.plus;b.$partial_2=n.plus;b.$sum=0;e.each(g,function(c){b[c]=a[c]});d.push(b)};if(!c||0===g.length)a=e.map(a,function(a){d=[];n={plus:0,minus:0};e.each(a._internal,s);return a.clone(d)});else{var u=0,y={},j={},l={};e.each(c,function(a,b){l[b]=a.length});var m=f.compareBy(g),q=function(){e.each(y,function(a,
b){j[b]=c[b][a]})};a=e.map(a,function(a){e.each(g,function(a){y[a]=0});d=[];n={plus:0,minus:0};u=0;var b=a._internal.sort(m);k=b[0];for(var c=!0;c||u<b.length;){q();u<b.length&&0===m(b[u],j)?(s(b[u]),u++):p(j);a:{for(c=g.length-1;0<=c;c--){var f=g[c];y[f]++;if(y[f]<l[f]){c=!0;break a}y[f]=0}c=!1}}return a.clone(d)})}return a};var R=j;R.coord.cart=f.makeClass("gg.coord.cart",R.coord.base);R.coord.cart.prototype.init=function(a){R.coord.base.prototype.init.call(this);this._flip=f.bool(a)};R.coord.cart.prototype.configScale=
function(a,b){this._flip?(b.x.range([a.height,a.y]),b.y.range([a.x,a.width])):(b.x.range([a.x,a.width]),b.y.range([a.height,a.y]))};R.coord.cart.prototype.transX=function(a,b){return this._flip?b:a};R.coord.cart.prototype.transY=function(a,b){return this._flip?a:b};R.coord.cart.prototype.vline=function(){return this.getPaper().gg_cart_vline(this)};R.coord.cart.prototype.hline=function(){return this.getPaper().gg_cart_hline(this)};R.coord.cart.prototype.line=function(){return this.getPaper().gg_cart_line(this)};
R.coord.cart.prototype.rect=function(){return this.getPaper().gg_cart_rect(this)};R.coord.cart.prototype.toCode=function(a,b){return f.toCode(a,b,{cls:this._cls_name,params:[this._flip.toString()]})};var H=j;H.coord.polar=f.makeClass("gg.coord.polar",H.coord.base);H.coord.polar.prototype.init=function(a){H.coord.base.prototype.init.call(this);this._flip=f.bool(a);this._configured=!1};H.coord.polar.prototype.configScale=function(a,b){this._offsetX=a.x+a.width/2;this._offsetY=a.y+a.height/2;var c=1*
(Math.min(a.width,a.height)/2);this._flip?(b.y.range([0,c]),b.x.range([0,2*Math.PI]),b.x.opts("expand",0)):(b.x.range([0,c]),b.y.range([0,2*Math.PI]),b.y.opts("expand",0));this._configured=!0};H.coord.polar.prototype.transX=function(a,b){this._configured||H.error(605,"Attempting to use a coordinate that has not been configured.");return!this._flip?a*Math.cos(b-Math.PI/2):b*Math.cos(a-Math.PI/2)};H.coord.polar.prototype.transY=function(a,b){this._configured||H.error(605,"Attempting to use a coordinate that has not been configured.");
return!this._flip?a*Math.sin(b-Math.PI/2):b*Math.sin(a-Math.PI/2)};H.coord.polar.prototype.vline=function(){return this.getPaper().gg_polar_vline(this)};H.coord.polar.prototype.hline=function(){return this.getPaper().gg_polar_hline(this)};H.coord.polar.prototype.rect=function(){return this.getPaper().gg_polar_rect(this)};H.coord.polar.prototype.toCode=function(a,b){return f.toCode(a,b,{cls:this._cls_name,params:[this._flip.toString()]})};H.coord.polar.prototype.poly=function(){var a=this.getPaper(),
b=e.bind(this._smoother,this);return a.gg_path(this,b)};H.coord.polar.prototype._getRange=function(){return 2*Math.PI};H.coord.polar.prototype._getTickSize=function(){return 0.01};H.coord.polar.prototype._smoother=function(a,b){for(var c=this._flip,d=a.length,g=0,f=!0,h,k,s,p,u=[],y=[],j=this._getRange(),l=this._getTickSize(),g=0;g<d;g++)if(h=a[g],k=b[g],e.isNumber(h)&&e.isNumber(k))if(f)s=h,p=k,u.push(h),y.push(k),f=!1;else{var m,q,r,Ca,v;q=h-s;r=k-p;m=c?Math.floor(q/j/l):Math.floor(r/j/l);for(var t=
1;t<m;t++)Ca=t/m,v=Ca*r,Ca*=q,u.push(s+Ca),y.push(p+v);s=h;p=k;u.push(h);y.push(k)}return{x:u,y:y}};var l=j,ib=["min","max","levels"],Pa={hit:0,miss:0};l.data=f.makeClass("gg.data");l.data._CACHE_STATS=Pa;var Sa=["type","parser","format"];l.data.fetch=function(a,b,c){F.text(a,function(d){var e=null;/\.csv/.test(a)||(d=JSON.parse(d));e=l.data(d,c);b(e)})};l.data.group=function(a,b,c){c||(c=function(){return!0});var d;d=0===e.size(b)?function(){return""}:function(a){var c="";e.each(b,function(b,d){c+=
d+":"+b(a[d])+";"});return c};if(0===a.length)return[];var g={};e.each(a,function(a){for(var b=0;b<a.len();b++){var e=a._internal[b];if(c(e)){var f=d(e);g[f]||(g[f]=[]);g[f].push(e)}}});g=e.values(g);return e.map(g,function(b){return a[0].clone(b)})};l.data.prototype.fromObject=function(a,b){b=b?b:e.keys(a);for(var c=e.map(b,function(b){return a[b].length}),d=e.max(c),g=[],f=0;f<d;f++){for(var h={},k=0;k<b.length;k++){var s=b[k],p=a[s][f];"undefined"===typeof p&&(p=null);h[s]=f<c[k]?p:null}g.push(h)}this._unparsed=
g;this._keys=b};l.data.prototype.fromArray=function(a,b){if(0===a.length)this._unparsed=[],b=b?b:[];else{var c=e.keys(a[0]);b=b?e.union(b,c):c;for(c=1;c<a.length;c++)for(var d=0;d<b.length;d++)e.isUndefined(a[c][b[d]])&&(a[c][b[d]]=null);this._unparsed=a}this._keys=b};l.data.prototype.fromGrid=function(a,b){if(0===a.length)this._unparsed=[],b=b?b:[];else{b=b?b:e.keys(a[0]);var c=b.length;this._unparsed=e.map(a,function(a){for(var g={},f=0;f<c;f++)g[b[f]]=e.isUndefined(a[f])?null:a[f];return g})}this._keys=
b};l.data.prototype.fromCSV=function(a){a=F.csv.parseRows(a);for(var b=a[0],c=0,d=0,g=!1,f=0;f<b.length;f++)""==b[f]&&(b[f]="untitled");for(;!g;){for(f=0;f<b.length;f++)for(var h=0;h<b.length;h++)if(b[f]===b[h]&&f!=h)if(e.isNull(b[h].match(/[_][1234567890]*$/)))b[h]+="_1";else{for(g=b[h].length-1;0<=b[h].charAt(g)&&9>=b[h].charAt(g);g--)c+=b[h].charAt(g)*Math.pow(10,b[h].length-g-1),d++;c++;b[h]=b[h].substring(0,b[h].length-d)+""+c;d=c=0}g=!0;for(f=0;f<b.length;f++)for(h=0;h<b.length;h++)b[f]===b[h]&&
f!=h&&(g=!1)}this._unparsed=F.csv.parse(F.csv.format(a));this._keys=e.keys(this._unparsed[0]);for(f=0;f<this._unparsed.length;f++){var k=this._unparsed[f];e.each(this._keys,function(a){var b=parseFloat(k[a]);b==k[a]&&(k[a]=b)})}};l.data.prototype.constructData=function(a,b){var c=!1,d;if(e.isArray(b))d=e.clone(b),b={};else if(b){d=e.keys(b);var g={};e.each(b,function(a,b){var c;if(e.isString(a))c={type:a,format:null,parser:null};else{c={};for(var d=0;d<Sa.length;d++){var f=Sa[d],u=a[f];u&&(c[f]=u)}}g[b]=
c});b=g;c=!0}else d=null,b={};e.isArray(a)?0<a.length&&e.isArray(a[0])?this.fromGrid(a,d,b):this.fromArray(a,d,b):e.isString(a)?this.fromCSV(a,d,b):this.fromObject(a,d,b);this._meta=c?b:{};this.guessMeta()};l.data.prototype.guessMeta=function(){var a=this._meta,b=this;e.each(this._keys,function(c){if(!a[c]||!a[c].type){var d=b._guessType(c),e={};d&&(e.type=d);a[c]=e}});return a};l.data.prototype.init=function(a,b){this._cache=this._meta=this._keys=this._internal=this._unparsed=null;a?(this.constructData(a,
b),this._guessParsers(),this._applyParsers()):(this._unparsed=[],this._internal=[],this._keys=[],this._meta={});this._clearCache()};l.data.prototype.clone=function(a){a=a||[];var b=new l.data;b._keys=e.keys(this._meta);b._meta=e.clone(this._meta);b._internal=a;return b};l.data.prototype.copy=function(){return this.clone(this._internal)};l.data.prototype.transform=function(a,b){var c=e.map(this._internal,function(c){c=e.clone(c);c[a]=b(c[a]);return c});return this.clone(c)};l.data.prototype.niceNumber=
function(a,b){return this.transform(a,function(a){return Math.floor(a/b)*b})};l.data.prototype.niceDate=function(a,b){e.isArray(b)||(b=[b]);return this.transform(a,function(a){var d=new Date(0);e.isNumber(a)&&(a=new Date(a));e.each(b,function(b){var e=a["get"+b]();d["set"+b](e)});return d-0})};l.data.prototype.get=function(a,b){return 2<=arguments.length?this._internal[b][a]:e.pluck(this._internal,a)};l.data.prototype.getObject=function(a){var b,c,d={};for(b=0;b<this._keys.length;b++)c=this._keys[b],
d[c]=this.get(c,a);return d};l.data.prototype.getObjects=function(){for(var a=[],b=0;b<this.len();b++)a.push(this.getObject(b));return a};l.data.prototype.getRaw=function(){return this._internal};l.data.prototype.getBlock=function(){var a=[],b=this._internal,c,d=this._meta,g=function(a){return"date"!==d[a].type?b[c][a]:+b[c][a]};for(c=0;c<this._internal.length;c++)a[c]=e.map(this._keys,g);return a};l.data.prototype.getTypeObj=function(a){return l.type.fromString(this.type(a))};l.data.prototype.toCode=
function(a,b){return f.toCode(a,b,{cls:this._cls_name,params:[JSON.stringify(this.getBlock(),null," "),JSON.stringify(this._meta)]})};l.data.prototype.len=function(){return this._internal.length};l.data.prototype.indices=function(){return e.range(this.len())};l.data.prototype.keys=function(){return this._keys};l.data.prototype.hasKey=function(a){return-1<e.indexOf(this._keys,a)};l.data.prototype.metas=function(){return e.clone(this._meta)};l.data.prototype.getMeta=function(a){return this._meta[a]};
var jb=function(a){return null===a||"undefined"===typeof a||""===a},kb=function(a){return e.isNumber(a)||!e.isNaN(Number(a))};l.data.guessType=function(a){a=e.reject(a,jb);return 0===a.length?"category":e.all(a,e.isDate)?"date":e.all(a,kb)?"number":"category"};l.data.prototype._guessType=function(a){a=e.pluck(this._unparsed,a);return l.data.guessType(a)};l.data.prototype.type=function(a){return(a=this._meta[a])?a.type:"unknown"};l.data.prototype.levels=function(a){return this._cached("levels",a,function(a){var c=
this.getTypeObj(a);return e.chain(this._internal).pluck(a).reject(e.isUndefined).reject(e.isNull).sortBy(c.represent).uniq(!1,c.represent).value()},[])};l.data.prototype.min=function(a){return this._cached("min",a,function(a){var c=this.getTypeObj(a);return this.query(a,c.min,c.validate)},void 0)};l.data.prototype.max=function(a){return this._cached("max",a,function(a){var c=this.getTypeObj(a);return this.query(a,c.max,c.validate)},void 0)};l.data.prototype.query=function(a,b,c){return b(e.filter(this.get(a),
c))};l.data.prototype.remove=function(a){var b=e.indexOf(this._keys,a);if(-1===b)return!1;this._keys.splice(b,1);delete this._meta[a];for(var c=this._internal.length,b=0;b<c;b++)delete this._internal[b][a];return!0};l.data.prototype.derive=function(a,b,c){c=c||{};var d=c.dryrun,g=c.context;1===arguments.length&&(b=e.uniqueId("var_"));g||(g=l.derive);try{var f,h;if(e.isFunction(a))f=a,h=!1;else{var k=a;""===a&&(k='""');f=new Function("d","with(this) { with(d) { return "+k+";}}");h=!0}for(var s=this.len(),
k=[],p=0;p<s;p++){var u=this._internal[p],j=f.call(g,u);e.isFunction(j)&&l.error(121,"invalud return value");k.push(j);if(d){if(10<p)break}else u[b]=f.call(g,u)}if(d)return{success:!0,values:k};e.include(this._keys,b)||this._keys.push(b);g=null;g=c.type?c.type:l.data.guessType(k);this._meta[b]={type:g,derived:!0};h&&(this._meta[b].formula=a);return b}catch(m){if(d)return{success:!1,error:m};l.warn(121,"Error while generating derived variable "+b+": "+m.toString());return!1}};l.data.prototype.checkRename=
function(a,b){var c=e.indexOf(this._keys,a),d=e.indexOf(this._keys,b);if(b){if(-1===c||-1!==d)return!1}else return!1;return!0};l.data.prototype.rename=function(a,b){a=a.toString();b=b.toString();if(!this.checkRename(a,b))return!1;var c=e.indexOf(this._keys,a);e.each(this._internal,function(c){c[b]=c[a];delete c[a]});this._keys[c]=b;this._meta[b]=this._meta[a];delete this._meta[a];return!0};l.data.prototype.renameMany=function(a){var b=this,c={},d=!1;e.each(a,function(a,e){var f=a.toString();f!=e&&
(b.checkRename(e,a)?c[e]=f:d=!0)});if(d)return!1;a=e.values(c);if(e.uniq(a).length!=a.length)return!1;e.each(this._internal,function(a){e.each(c,function(b,c){a[b]=a[c];delete a[c]})});e.each(c,function(a,c){var d=e.indexOf(b._keys,c);b._keys[d]=a;b._meta[a]=b._meta[c];delete b._meta[c]});return!0};l.data.prototype.copyColumnDefinition=function(a,b){if(-1===e.indexOf(this._keys,a)&&-1!==e.indexOf(this._keys,b))return!1;data._keys.push(x_end);data._meta[x_end]=e.clone(data._meta[x]);return!0};l.data.prototype.push=
function(a){var b,c;for(b=0;b<this._keys.length;b++)c=this._keys[b],e.has(a,c)||l.warn(101,"Data is missing key "+c+".");this._internal.push(a);return this};l.data.prototype.iterator=function(a){var b=this,c={i:0,next:function(){for(var d=b.len();c.i<d&&!a(b._internal[c.i]);)c.i++;return c.i==d?!1:b._internal[c.i++]}};return c};l.data.prototype.filter=function(a){var b=[];a=l.data.makeFilterFunction(a);try{e.each(this._internal,function(c){a(c)&&b.push(c)})}catch(c){l.error(122,"Error while filtering data: "+
c.toString())}return this.clone(b)};l.data.prototype.sort=function(a,b){var c=this.getTypeObj(a),d;d=c.sort?e.clone(this._internal).sort(function(b,d){var e=c.represent(b[a]),f=c.represent(d[a]);return c.sort(e,f)}):e.sortBy(this._internal,function(b){return c.represent(b[a])});b&&d.reverse();return this.clone(d)};l.data.prototype.group=function(a){return l.data.group([this],a)};l.data.prototype.merge=function(a){e.isEqual(this.keys(),a.keys())||l.error(110,"Cannot merge two datasets with unequal keys.");
this._internal=this._internal.concat(a._internal);return this};l.data.prototype.each=function(a,b){if(!b||b>this.len())return e.each(this._internal,a);var c=e.shuffle(this._internal);return e.each(c.slice(0,b),a)};l.data.prototype._cached=function(a,b,c,d){e.isFunction(b)&&(b._data_key||(b._data_key=e.uniqueId("var_"),this.derive(b,b._data_key)),b=b._data_key);if(-1===e.indexOf(this._keys,b))return d;if(e.has(this._cache[a],b))return a=this._cache[a][b],Pa.hit++,a;Pa.miss++;c=c.call(this,b);return this._cache[a][b]=
c};l.data.prototype._clearCache=function(){var a=this._cache={};e.each(ib,function(b){a[b]={}})};l.data.prototype.parser=function(a,b){if(1===arguments.length)return this._meta[a].parser;this._meta[a].parser=b;return this};var Ta=function(a){var b=Number(a);return null===a||"undefined"==typeof a||""===a||e.isNaN(b)?null:b};l.data.prototype._guessParsers=function(){var a=this;e.each(this._keys,function(b){var c=a._meta[b];if(!a.parser(b))if("number"==c.type){if(c.format){var d=RegExp(c.format);b=function(a){a=
d.exec(a)[1];return Ta(a)}}else b=Ta;c.parser=b}else if("date"==c.type)c.format?(b=a._meta[b].format,c.parser=l.data.makeDateParser(b)):(b=e.pluck(a._unparsed,b),(b=l.data.guessDateFormat(b))?(c.parser=l.data.makeDateParser(b),c.format=b):(c.type="date",c.parser=function(a){return a},c.format=null));else if("category"==c.type&&null===c.format)c.parser=l.type.category.prototype.represent;else if(c.parser=l.type.category.prototype.represent,b=e.pluck(a._unparsed,b),b=l.data.guessDateFormat(b))c.type=
"date",c.parser=l.data.makeDateParser(b),c.format=b})};l.data.prototype._applyParsers=function(){var a=this,b=this.keys();this._internal=e.map(this._unparsed,function(c){for(var d={},e=0,e=0;e<b.length;e++){var f=b[e],h=a._meta[f].parser,k=c[f],s;if(h)try{s=h(k)}catch(p){s=null}else s=k;d[f]=s}return d})};var lb="%Y-%m-%d %H:%M:%S;%c;%m-%d-%Y;%Y-%m-%d;%m/%d/%Y;%Y/%m/%d;%m/%d/%Y %I:%M %p".split(";");l.data.guessDateFormat=function(a){return e.find(lb,function(b){for(var c=!0,d=!0,g=0;g<a.length;g++){var f=
a[g];if(f){if(f&&!e.isString(f))return!1;if(null!==l.date.parseDate(b,f))d=!1;else{c=!1;break}}}return c&&!d})};l.data.makeDateParser=function(a){var b=F.time.format.utc(a);return function(a){if(e.isNumber(a))return a;a=b.parse(a);return null!=a?a.getTime():null}};l.data.makeFilterFunction=function(a){return e.isFunction(a)?a:e.isString(a)?new Function("d","with(d) { return "+a+";}"):function(){return!0}};l.data.prettify=f.prettify;l.data.numberRounder=function(a){return function(b){return Math.floor(b/
a)*a}};l.data.dateRounder=function(a){e.isArray(a)||(a=[a]);return function(b){var c=new Date(0);b=new Date(b);e.each(a,function(a){if(e.isString(a)){var g=b["get"+a]();c["set"+a](g)}else a(c,b)});return c-0}};l.data.parseCSV=F.csv.parseRows;j.date={};j.date.parseDate=function(a,b){return!b?null:F.time.format.utc(a).parse(b)};j.date.formatDate=function(a,b){if(!b)return"";e.isNumber(b)&&(b=new Date(b));return F.time.format.utc(a)(b)};var na=j;na.derive={};na.derive.year=function(a){a=new Date(a);
return a.getUTCFullYear()};na.derive.month=function(a){a=new Date(a);return a.getUTCMonth()+1};na.derive.day=function(a){a=new Date(a);return a.getUTCDate()};na.derive.has=function(a,b){return-1<e.indexOf(""+a,""+b)};na.derive.len=function(a){return e.isString(a)?a.length:0};na.derive.count=function(a,b){if(!e.isString(a))return 0;for(var c=0,d=0;d<a.length;d++)a.charAt(d)==b&&c++;return c};var Q=j;Q.facet.grid=f.makeClass("gg.facet.grid",Q.facet.base);Q.facet.grid.prototype.init=function(a,b){Q.facet.base.prototype.init.call(this);
this.opts("x",a);this.opts("y",b);this.opts("col",null);this.opts("row",null);this._ylevels=this._xlevels=null;this._key_x;this._key_y};Q.facet.grid.prototype.x=f.singleOpts("x");Q.facet.grid.prototype.y=f.singleOpts("y");Q.facet.grid.prototype.ncol=function(a){if(0===arguments.length)return this.opts("col");f.assertNumber(a);this.opts("col",a);return this};Q.facet.grid.prototype.nrow=function(a){if(0===arguments.length)return this.opts("row");f.assertNumber(a);this.opts("row",a);return this};Q.facet.grid.prototype.isValidIndex=
function(){return!0};Q.facet.grid.prototype.bin=function(a){return e.indexOf(this._ylevels,a[this._key_y])*this.opts("col")+e.indexOf(this._xlevels,a[this._key_x])};Q.facet.grid.prototype.prepare=function(){var a=this.x(),b=this.y();!a&&!b&&Q.error(701,"There are no variables to facet on.");var c=this._graph.levels(a,"data"),d=this._graph.levels(b,"data");this.opts("col",c.length);this.opts("row",d.length);this._xlevels=c;this._ylevels=d;this._key_x=a;this._key_y=b;return this};Q.facet.grid.prototype.renderLabel=
function(a,b){var c=this._xlevels[b.col]+" "+this._ylevels[b.row],d=a.text();d.attr("font-size",12);d.attr("font-weight","bold");d.attr("text",c);1==this.opts("col")?d.attr("x",b.width+10).attr("y",b.ypos+b.eachHeight/2).transform("r90"):d.attr("x",b.xpos+b.eachWidth/2).attr("y",b.ypos-10);return this};var S=j;S.facet.wrap=f.makeClass("gg.facet.wrap",S.facet.base);S.facet.wrap.prototype.init=function(a){S.facet.base.prototype.init.call(this);this.opts("x",a);this.opts("col",null);this.opts("row",
null);this.opts("formatter",null);this._key=null};S.facet.wrap.prototype.x=f.singleOpts("x");S.facet.wrap.prototype.ncol=function(a){if(0===arguments.length)return this.opts("col");f.assertNumber(a);this.opts("col",a);return this};S.facet.wrap.prototype.nrow=function(a){if(0===arguments.length)return this.opts("row");f.assertNumber(a);this.opts("row",a);return this};S.facet.wrap.prototype.isValidIndex=function(a){return a<this._graph.levels(this.x(),"data").length};S.facet.wrap.prototype.bin=function(a){return e.indexOf(this._levels,
a[this._key])};S.facet.wrap.prototype.prepare=function(){var a=this.x();a||S.error(701,"There are no variables to facet on.");var b=this._graph.levels(a,"data"),c=b.length,d,e;this.opts("col")?(d=this.opts("col")||3,e=this.opts("row")||Math.ceil(c/d)):(e=this.opts("row")||2,d=this.opts("col")||Math.ceil(c/e));this.opts("col",d);this.opts("row",e);this._levels=b;this._key=a;return this};S.facet.wrap.prototype.renderLabel=function(a,b){var c=b.row*this.ncol()+b.col,c=this._levels[c];if(null===c||e.isUndefined(c))return this;
var d=this.opts("formatter");d||(d=function(a){return a+""});var g=a.text();g.attr("font-size",12);g.attr("font-weight","bold");g.attr("text",d(c));1==this.opts("col")?g.attr("x",b.width+10).attr("y",b.ypos+b.eachHeight/2).transform("r90"):g.attr("x",b.xpos+b.eachWidth/2).attr("y",b.ypos-10);return this};var oa=j;oa.graph.prototype.type=function(a,b,c){if(0===this._layers.length&&"data"==b)return this.data().type(a);a=e.invoke(this._layers,"type",a,b,c);return f.unionType(a)};oa.graph.prototype.min=
function(a,b,c){if(0===this._layers.length&&"data"==b)return this.data().min(a);c=e.invoke(this._layers,"min",a,b,c);a=this.type(a,b);return oa.type.fromString(a).min(c)};oa.graph.prototype.max=function(a,b,c){if(0===this._layers.length&&"data"==b)return this.data().max(a);c=e.invoke(this._layers,"max",a,b,c);a=this.type(a,b);return oa.type.fromString(a).max(c)};oa.graph.prototype.levels=function(a,b,c){if(0===this._layers.length&&"data"==b)return this.data().levels(a);c=e.invoke(this._layers,"levels",
a,b,c);a=this.type(a,b);a=oa.type.fromString(a);return f.mergeArrays(c,a.represent)};var I=j;I.graph.prototype._setupGrid=function(){var a=this.coord(),b=this._scales,c=I.guide.grid(b.x,b.y);"gg.coord.polar"===a._cls_name&&c.opts("render-vertical",!0);e.each(this._attr,function(a,b){"grid-"==b.substring(0,5)&&!e.isNull(a)&&c.opts(b.substring(5),a)});return c};I.graph.prototype._setupAxes=function(){var a=this.coord(),b=a._flip!==("gg.coord.polar"===a._cls_name),c=b?"x":"y",d=I.guide.axis(this._scales[b?
"y":"x"],"x",a),g=I.guide.axis(this._scales[c],"y",a);"gg.coord.polar"===a._cls_name&&g.opts("line",!0);e.each(this._attr,function(a,b){var c=b.substring(0,7);"axis-x-"==c&&!e.isNull(a)?d.opts(b.substring(7),a):"axis-y-"==c&&!e.isNull(a)?g.opts(b.substring(7),a):"axis-"==c.substring(0,5)&&(d.opts(b.substring(5),a),g.opts(b.substring(5),a))});return this._axes=a={x:d,y:g,flip:b}};I.graph.prototype._renderAxis=function(a,b){var c=this.coord(),d,e=a.flip?"x":"y",f=this.opts("axis-y");if("left"==f&&0===
b.col||"right"==f&&b.col===b.ncol-1||b.free_y)d=this.getAxisOffset(b.row,b.col,f),d={position:f,coord:c,canvas:this.createOffsetCoord(d.x,d.y)},a.y.renderLinear(d);f=this.opts("axis-x");"none"!=f&&("gg.coord.polar"===c._cls_name?(d=this.getAxisOffset(b.row,b.col,"circular"),d={position:"circular",coord:c.differentOffset(b.xpos,b.ypos),radius:this._scales[e].range()[1],canvas:this.createOffsetCoord(d.x,d.y)},a.x.renderCircular(d)):(d=this.getAxisOffset(b.row,b.col,f),d={position:f,coord:c,canvas:this.createOffsetCoord(d.x,
d.y)},"bottom"==f&&b.row==b.nrow-1||"top"==f&&0===b.row||b.free_x?a.x.renderLinear(d):a.x.renderLinear(d,{labels:!1})))};I.graph.prototype.renderPrimary=function(a){var b=this.dimensions(),c=this._facet,d=b.ncol,b=b.nrow,e=0,f,h,k=this.coord(),s=this._setupGrid(),p=this._axes,u=this._scales,j=c?c.opts("free_x"):!1,l=c?c.opts("free_y"):!1,m=function(a,b){u[a].make(b);s.opts(a+"scale",u[a]);p[p.flip==("x"==a)?"y":"x"].scale(u[a])};this._timer&&this._timer.mark("renderPrimary - pre-rendering()");for(var q=
0;q<b;q++)for(var r=0;r<d&&(!c||c.isValidIndex(e));r++){f=this.xposition(r);h=this.yposition(q);j&&m("x",e);l&&m("y",e);var va=k.differentOffset(f,h).opts("mouseover_highlight",!1);s.render(va);this._timer&&this._timer.mark("renderGrid()");for(va=0;va<this._layers.length;va++)if(!a||!a[va])this.renderLayer(this.getLayer(va),f,h,u,e),this._timer&&this._timer.mark("renderLayer()");this._renderAxis(p,{col:r,row:q,ncol:d,nrow:b,xpos:f,ypos:h,free_x:j,free_y:l});this._timer&&this._timer.mark("renderAxis()");
e++}};I.graph.prototype.renderLayer=function(a,b,c,d,e){b={rawScales:d,coord:this._coord.differentOffset(b,c),facetIndex:e};a.renderEntry(b)};I.graph.prototype.renderAllFacetLabel=function(){var a=this.dimensions(),b=a.ncol,c=a.nrow;if(1<c||1<b)for(var a={eachWidth:a.eachWidth,width:a.chartWidth+a.paddingLeft,eachHeight:a.eachHeight},d=0;d<c;d++)for(var e=0;e<b;e++)a.row=d,a.col=e,a.ypos=this.yposition(d),a.xpos=this.xposition(e),this._facet.renderLabel(this._paper,a)};I.graph.prototype.renderLegend=
function(){var a=this.opts("legend-position");if("none"!=a){var b=this.dimensions(),c=b.chartWidth,d=b.chartHeight,e,f;"left"==a||"right"==a?(f=b.paddingTop,e=10,"right"==a&&(e+=b.paddingLeft+c+10)):"bottom"==a?(f=d+b.paddingTop+45,e=b.paddingLeft):I.error(1E3,"Leged position should be left, right, bottom or none. Got "+a+" instead.");a={canvas:this.createOffsetCoord(e,f),chartWidth:c,chartHeight:d};this._legend.render(a)}};I.graph.prototype.renderOtherLabel=function(){this.dimensions();"polar"!==
this._coord._name&&(this.render_y_label(),this.render_x_label());this.render_title()};I.graph.prototype.render_label=function(a,b,c,d){a=this._paper.text(b,c,a).attr("class",d);return this._doms[d]=a};I.graph.prototype.render_title=function(){this.dimensions();var a=this.opts("width")/2;this.render_label(this.opts("title"),a,15,"_debug_title").attr("font-weight",this.opts("title-bold")?"bold":"normal").attr("font-size",this.opts("title-size"))};I.graph.prototype.render_x_label=function(){var a=this.dimensions(),
b=a.paddingLeft+a.chartWidth/2,a=a.xLabelY,c="gg.coord.polar"===this.coord()._cls_name?this._coord._flip?"x":"y":this._coord._flip?"y":"x";this.render_label(this._varlabel(c),b,a,"_debug_x_label").attr("font-weight",this.opts("label-bold")?"bold":"normal").attr("font-size",this.opts("label-size"))};I.graph.prototype.render_y_label=function(){var a=this.dimensions(),b=a.yLabelX,a=a.paddingTop+a.chartHeight/2,c="gg.coord.polar"===this.coord()._cls_name?this._coord._flip?"y":"x":this._coord._flip?"x":
"y";this.render_label(this._varlabel(c),b,a,"_debug_y_label").transform("r270").attr("font-weight",this.opts("label-bold")?"bold":"normal").attr("font-size",this.opts("label-size"))};I.graph.prototype.render_branding=function(){var a=this._paper,b=this.opts("height")-6;a.path(f.d3_arc(82,b+1,0,4,-Math.PI/2,1*Math.PI/6)).attr("fill","#F89E34").attr("stroke","#F89E34");a.path(f.d3_arc(82,b+1,0,5,1*Math.PI/6,5*Math.PI/6)).attr("fill","#FFF425").attr("stroke","#FFF425");a.path(f.d3_arc(82,b+1,0,6.5,5*
Math.PI/6,9*Math.PI/6)).attr("fill","#6DBB58").attr("stroke","#6DBB58");a.text(65,b,"Made With P o lychart").attr({"font-size":12,"font-weight":"bold","font-family":"Arial, sans-serif"}).attr("fill","#AAA").toBack()};"use strict";j.graph.prototype.getScaleKeys=function(){return e.keys(this._scales)};j.graph.prototype.removeScale=function(a){return e.has(this._scales,a)?(delete this._scales[a],!0):!1};j.graph.prototype.removeAllScales=function(){this._scales={}};j.graph.prototype.getScale=function(a){return this._scales[a]};
j.graph.prototype.scale=function(a,b){f.assertAes(a);(b=f.instantiate(b))||j.error(201,"Attempting to add an undefined or malformed scale: "+b);var c=f.cloneobj(b);c.attach(this,a);this._scales[a]=c;return this};j.graph.prototype.resetScale=function(a){var b=this.makeDefaultScales([a])[a];return b?(this.scale(a,b),this.computeScale(),!0):!1};j.graph.prototype.makeDefaultScales=function(a){var b=this,c=this._scales;a||(a=e.chain(this._layers).map(function(a){return e.keys(a.getMap())}).flatten().push("x").push("y").uniq().filter(function(a){return f.isDerivedAes(a)||
"group"==f.getBaseAes(a)?!1:!0}).reject(function(a){return e.has(c,a)}).value());var d={};e.each(a,function(a){var c=b.type(a),e=j.type.fromString(c);c&&(c="unknown"===c?j.scale.id():e.defaultScale(a),d[a]=c)});!this._scales.x&&(!d.x&&e.contains(a,"x"))&&(d.x=j.scale.discrete());!this._scales.y&&(!d.y&&e.contains(a,"y"))&&(d.y=j.scale.continuous());return d};j.graph.prototype.bindDerivedScales=function(){var a=this._scales,b=this.getMapKeys();e.each(b,function(b){f.isDerivedAes(b)&&(a[b]=a[f.getBaseAes(b)])})};
j.graph.prototype.computeScale=function(){var a=this._scales,b=this.dimensions();this._coord.configScale({x:0,y:0,width:b.eachWidth,height:b.eachHeight},a);e.each(a,function(a,b){f.isDerivedAes(b)||a.make()})};var M=j;M.guide.axis=f.makeClass("gg.guide.axis",M.guide.base);M.guide.axis.prototype.init=function(a,b,c){M.guide.base.prototype.init.call(this);this._type=b||a._aes;"x"!=this._type&&"y"!=this._type&&M.error(500,"Axis can only be created from x- or y- aesthetics, got "+this._type+" instead.");
this._scale=a;this._coord=c;this._flip="y"==b&&"gg.coord.polar"==c._cls_name;this._attr=f.cloneobj(M.opts.axis);"x"==this._type?e.extend(this._attr,M.opts.axis_x):"y"==this._type&&e.extend(this._attr,M.opts.axis_y)};M.guide.axis.prototype.width=function(){return this._scale.maxLabelWidth()};M.guide.axis.prototype.scale=function(a){this._scale=a;return this};M.guide.axis.prototype.renderLinear=function(a,b){var c=a.canvas,d=a.position,f="top"==d||"bottom"==d,n="left"==d||"right"==d,h=f?"middle":"left"==
d?"end":"start",k=f?0:"left"==d?-10:10,s=n?0:"top"==d?-10:15,p=f?this.opts("ticklength-x"):this.opts("ticklength-y"),u=this.opts("fontsize"),j=this.opts("color"),l=this.opts("strokewidth");b||(b={line:!0,ticks:!0,labels:!0});!f&&!n&&M.error(501,"Position should be 'top', 'bottom', 'left', or 'right'. Got "+d+" instead.");f&&"x"!=this._type&&M.error(501,"Position should be 'top' or 'bottom'. Got "+d+" instead.");n&&"y"!=this._type&&M.error(501,"Position should be 'left', or 'right'. Got "+d+" instead.");
var m=[0,0],q=[0,0];f?m=this._scale.range():q=this._scale.range();this.opts("line")&&!1!==b.line&&c.line().attr("func",{x1:m[0],x2:m[1],y1:q[0],y2:q[1],stroke:j,"stroke-width":l}).attr("data",{});m=this._scale.ticks(null,this._flip);if(this._flip){var r=e.max(this._scale.range());e.each(m,function(a){a.pos=r-a.pos})}this.opts("ticks")&&!1!==b.ticks&&e.each(m,function(a){c.line().attr("func",{x1:function(a){return f?a.pos:0},x2:function(a){return f?a.pos:"left"==d?-p:p},y1:function(a){return n?a.pos:
0},y2:function(a){return n?a.pos:"top"==d?-p:p},stroke:j,"stroke-width":l}).attr("data",a)});this.opts("labels")&&!1!==b.labels&&e.each(m,function(a){c.text().attr("func",{x:function(a){return f?a.pos:k},y:function(a){return n?a.pos:s},text:function(a){return String(a.label)},"font-size":u,"font-color":j,"text-anchor":h}).attr("data",a)})};M.guide.axis.prototype.renderCircular=function(a,b){var c=a.coord,d=a.radius,g=this.opts("ticklength-y"),n=this.opts("fontsize"),h=this.opts("color"),k=this.opts("strokewidth");
b=b||{line:!0,ticks:!0,labels:!0};var s,p,u,j,l,m,q,r;c._flip?(s=e.bind(c.vline,c),p=e.bind(c.hline,c),u="y",l="y1",m="y2",j="x",q="x1",r="x2"):(s=e.bind(c.hline,c),p=e.bind(c.vline,c),u="x",l="x1",m="x2",j="y",q="y1",r="y2");if(this.opts("line")&&!1!==b.line){var t={stroke:h,"stroke-width":k};t[u]=f.constfunc(d);t[q]=f.constfunc(0);t[r]=f.constfunc(360);p().attr("func",t).attr("data",{})}p=this._scale.ticks(null);this._scale.CONTINUOUS&&p.pop();this.opts("ticks")&&!1!==b.ticks&&(t={"class":"labeltick",
stroke:h,"stroke-width":k},t[l]=f.constfunc(d),t[m]=f.constfunc(d+g),t[j]=function(a){return a.pos},e.each(p,function(a){s().attr("func",t).attr("data",a)}));this.opts("labels")&&!1!==b.labels&&(t={text:function(a){return a.label},"font-size":f.constfunc(n),"text-anchor":f.constfunc("middle"),"font-color":f.constfunc(h)},t[u]=f.constfunc(d+g+10),t[j]=function(a){return a.pos},e.each(p,function(a){c.text().attr("func",t).attr("data",a)}))};var wa=j;wa.guide.grid=f.makeClass("gg.guide.grid",wa.guide.base);
wa.guide.grid.prototype.init=function(a,b){wa.guide.base.prototype.init.call(this);this._attr=f.cloneobj(wa.opts.grid);this.opts("xscale",a);this.opts("yscale",b)};wa.guide.grid.prototype.render=function(a){var b=this,c=a._flip!==("gg.coord.polar"===a._cls_name),d=null,g=null;"gg.coord.polar"==a._cls_name&&(a._flip?d=6:g=6);var n=this.opts("xscale"),h=n.range(),k=e.min(h),s=e.max(h),d=n.ticks(d,c),p=this.opts("yscale"),h=p.range(),u=e.min(h),j=e.max(h),c=p.ticks(g,c);this.opts("render-vertical")&&
e.each(d,function(c){a.vline().attr("func",{x:function(a){return n.apply(a.data)},y1:f.constfunc(u),y2:f.constfunc(j),stroke:b.opts("stroke"),"stroke-width":b.opts("strokewidth"),"stroke-dasharray":b.opts("dasharray"),"stroke-dashoffset":b.opts("dashoffset")}).attr("data",c)});this.opts("render-horizontal")&&e.each(c,function(c){a.hline().attr("func",{y:function(a){return p.apply(a.data)},x1:f.constfunc(k),x2:f.constfunc(s),stroke:b.opts("stroke"),"stroke-width":b.opts("strokewidth"),"stroke-dasharray":b.opts("dasharray"),
"stroke-dashoffset":b.opts("dashoffset")}).attr("data",c)})};var N=j,mb="x y text group group2 grp tooltip".split(" ");N.guide.legend=f.makeClass("gg.guide.legend",N.guide.base);N.guide.legend.prototype.init=function(a,b,c,d){N.guide.base.prototype.init.call(this);this._graph=a;this._layers=b;this._scales=c;this._aes=e.chain(c).keys().reject(function(a){return f.isDerivedAes(a)||-1!=e.indexOf(mb,a)}).value();this._mappings=e.map(b,function(a){return a.getMap()});this._legends=null;this._position=
d};N.guide.legend.prototype.width=function(){this.group();var a=this;if("bottom"!=this._position){var b=e.chain(this._legends).map(function(a){return a.sample_scale.maxLabelWidth()}).max().value()+30,c=e.chain(this._legends).map(function(b){return f.strlenToPixel(a._graph._varlabel(b.sample_aes).length,"bold")}).max().value()+30;return Math.max(b,c,0)}return 0};N.guide.legend.prototype.height=function(){return"bottom"==this._position?100:0};N.guide.legend.prototype.group=function(){var a=this;this._legends=
[];for(var b=e.clone(this._aes),c="",d=function(b,d){b.aes.push(d);b.sample_scale_categorical||(c=a._scales[d],b.sample_aes=d,b.sample_scale=c,b.sample_scale_categorical=c.DISCRETE)};0<b.length;){var f=b.pop(),n=e.pluck(this._mappings,f),h=null,k={aes:[],mapping:n,sample_aes:null,sample_scale:null,sample_scale_categorical:!1,layers:[],type:"point"};d(k,f);for(f=0;f<b.length;)h=e.pluck(this._mappings,b[f]),e.isEqual(h,n)?d(k,b.splice(f,1)[0]):f++;n=[];h=[];for(f=0;f<this._layers.length;f++)this._mappings[f][k.sample_aes]&&
(h.push(this._layers[f]),n.push(this._layers[f]._cls_name.split(".")[2]));if(0!==h.length){k.layers=h;f=k;a:{for(h=0;h<n.length;h++)if("line"==n[h]||"path"==n[h]){n="line";break a}n="point"}f.type=n;this._legends.push(k)}}return this};N.guide.legend.prototype.render=function(a){e.isNull(this._legends)&&this.group();var b=this,c,d=0,f="bottom"==this._position?"h":"v";e.each(this._legends,function(e){e={legend:e,canvas:a.canvas.differentOffset(0,d),orientation:f,chartWidth:a.chartWidth,chartHeight:a.chartHeight};
c=b._renderEach(e);d="h"==f?d+(c.y+15):d+(c.y+10)})};N.guide.legend.prototype._renderEach=function(a){var b=this,c=a.legend,d=a.canvas,g=c.sample_aes,n=c.sample_scale,h=c.layers,k={color:f.constfunc("#000000"),stroke:f.constfunc("#000000"),strokewidth:f.constfunc(0),symbol:f.constfunc(N.symbol.CIRCLE),radius:f.constfunc(5),opacity:f.constfunc(1)};"line"==c.type?(k.symbol=f.constfunc(N.symbol.CROSS),k.strokewidth=f.constfunc(1)):k.symbol=f.constfunc(N.symbol.CIRCLE);e.each(e.keys(k),function(a){if("radius"!=
a){var b=h[0].opts(a);if(e.isString(b)||e.isNumber(b))k[a]=f.constfunc(b)}});e.each(c.aes,function(a){k[a]=e.bind(b._scales[a].apply,b._scales[a],"data")});var s="category"==n.type()?this._graph.levels(g).length:5,n=n.ticks(s),p="line"==c.type?this._render_line_tick:this._render_point_tick,j=0,l=0,c=d.text().attr("func",{x:0,y:0,"font-size":"13px","font-weight":"bold","text-anchor":"start",text:f.constfunc(b._graph._varlabel(g))}).attr("data",{}),l=l+c.getBBox().height,m,q,r=0,t=0;e.each(n,function(c){m=
p(c,d,k,j,l);q=b._render_label(c,d,j+20,l);"v"==a.orientation?(l+=Math.max(q.getBBox().height,m.getBBox().height),t=Math.max(t,l)):(j+=q.getBBox().width+40,r=Math.max(r,j),j>a.chartWidth-q.getBBox().width&&(l+=Math.max(q.getBBox().height,m.getBBox().height),t=Math.max(t,l),j=0))});"h"==a.orientation&&(t+=Math.max(q.getBBox().height,m.getBBox().height));return{y:t,x:r}};N.guide.legend.prototype._render_line_tick=function(a,b,c,d,e){return b.line().attr("func",{x1:f.constfunc(d),x2:f.constfunc(d+14),
y1:f.constfunc(e),y2:f.constfunc(e),stroke:c.color,"fill-opacity":c.opacity,"stroke-width":c.strokewidth}).attr("data",a)};N.guide.legend.prototype._render_point_tick=function(a,b,c,d,e){return b.point().attr("func",{cx:f.constfunc(d+7),cy:f.constfunc(e),r:c.radius,symbol:c.symbol,fill:c.color,stroke:c.stroke,"fill-opacity":c.opacity,"stroke-width":c.strokewidth}).attr("data",a)};N.guide.legend.prototype._render_label=function(a,b,c,d){return b.text().attr("func",{x:f.constfunc(c),y:f.constfunc(d),
"font-size":"12px","text-anchor":"start",text:function(a){return String(a.label)}}).attr("data",a)};var W=j;W.layer.area=f.makeClass("gg.layer.area",W.layer.base);W.layer.area.prototype.init=function(){W.layer.base.prototype.init.call(this);this.opts("stroke","none").opts("opacity",0.4).opts("color","steelblue").opts("strokewidth",0).opts("padding",0.5)};W.layer.area.prototype.calculatePartials=function(){return!0};W.layer.area.prototype.layerGroup=function(){return["group","group_color","group_opacity"]};
W.layer.area.prototype.defaultMin=function(a,b){e.isDate(b)&&(b=b.getTime());return"y"==a?0:W.layer.base.prototype.defaultMin.call(this,a,b)};W.layer.area.prototype.render=function(a){var b=a.coord,c=a.scales,d=a.rawScales.y.opts("domain_low");c.y(d);var f=function(a){return function(b,c){e.each(a,function(a){b.push(n(a.x));c.push(h(a.y))})}},n,h;n=c.x;h=c.y_2||c.y_override||c.y;var k=this,d=a.computedData,s=this.map("group");s&&(d=e.sortBy(d,function(a){return a._internal[0][s]}));d.reverse();var p=
[],j=this.map("x");e.each(d,function(d){k.opts("domain")&&(d=k.fillZero(d,a,["$sum","$partial_1","$partial_2"]));p=e.chain(d._internal).map(function(a){return{x:j?a[j]:1,y:a.$partial_1||0}}).sortBy(function(a){return a.x}).value();p.reverse();b.poly().attr("func",{x:n,y:h,_sort:n,_pointModifier:f(p),_style:c}).attr("data",d)})};W.layer.area.prototype.imputeMapping=function(a){return W.layer.base.prototype.imputeMapping.call(this,a,{group:["stroke","color"]})};var K=j;K.layer.bar=f.makeClass("gg.layer.bar",
K.layer.base);K.layer.bar.prototype.init=function(){K.layer.base.prototype.init.call(this);var a=this;e.each(K.opts.bar,function(b,c){a.opts(c,b)});this.opts("padding",0)};K.layer.bar.prototype.calculatePartials=function(){return!0};K.layer.bar.prototype.layerGroup=function(){return["x"]};K.layer.bar.prototype.defaultMin=function(a,b){e.isDate(b)&&(b=b.getTime());if("y"==a)return 0;if("x"==a){var c=this.opts("align"),d=this.opts("width");if("center"==c)return b-d/2;if("right"==c)return b-d}return K.layer.base.prototype.defaultMin.call(this,
a,b)};K.layer.bar.prototype.defaultMax=function(a,b){if("x"==a){var c=this.opts("align"),d=this.opts("width");if("center"==c)return b- -d/2;if("left"==c)return b- -d}return K.layer.base.prototype.defaultMax.call(this,a,b)};K.layer.bar.prototype.defaultScales=function(){return{x:K.scale.discrete("x")}};K.layer.bar.prototype.checkErrors=function(a){return"number"!==a.rawScales.y.type()?(K.error(311,"y scale must be numeric."),!0):!1};K.layer.bar.prototype.render=function(a){var b=a.coord,c=a.scales,
d=this.opts("width"),g;g=a.rawScales.x.DISCRETE?a.width:a.rawScales.x.apply(d)-a.rawScales.x.apply(0);var d=g/2*(1-2*this.opts("padding")),n=a.rawScales.y.opts("domain_low");e.isNumber(n)||this.warn(-2,"originLocation is numeric.");0>n&&(n=0);var h=null,k=null,s,p,j=this.opts("align");"left"==j||"right"==j?(g=g/2-d,"right"==j?(s=f.sub(c.x,g),p=f.sub(c.x,g+2*d)):(s=f.add(c.x,g),p=f.add(c.x,g+2*d))):"center"==j&&(s=f.sub(c.x,d),p=f.add(c.x,d));c.y_1&&c.y_2?(k=c.y_1,h=c.y_2):(k=c.y_override?c.y_override:
c.y,h=d=k(n));var l=this,m=this.opts("onDoubleclick");e.each(a.computedData,function(a){a.each(function(a){b.rect().ggTooltip(c).ggDoubleClick(m,l).attr("func",{x1:s,x2:p,y1:k,y2:h,_style:c}).attr("data",a)})})};var G=j;G.layer.box=f.makeClass("gg.layer.box",G.layer.base);G.layer.box.prototype.init=function(){G.layer.base.prototype.init.call(this);var a=this;e.each(G.opts.box,function(b,c){a.opts(c,b)});this._default_stats=G.stats.box};G.layer.area.prototype.calculatePartials=function(){return!0};
G.layer.box.prototype.layerGroup=function(){return["x"]};G.layer.box.prototype.defaultMin=function(a,b){e.isDate(b)&&(b=b.getTime());if("y"==a)return 0;if("x"==a){var c=this.opts("align"),d=this.opts("width");if("center"==c)return b-d/2;if("right"==c)return b-d}};G.layer.box.prototype.defaultMax=function(a,b){if("x"==a){var c=this.opts("align"),d=this.opts("width");if("center"==c)return b- -d/2;if("left"==c)return b- -d}return G.layer.base.prototype.defaultMax.call(this,a,b)};G.layer.box.prototype.checkErrors=
function(){var a=e.keys(this.getMap());if(e.include(a,"y"))return!1;this.warn(320,"No mapping has been set in layer "+this._cls_name);return!0};G.layer.box.prototype.render=function(a){var b=a.coord,c=a.scales,d=this.opts("width"),d=a.rawScales.x.DISCRETE?a.width:a.rawScales.x.apply(d)-a.rawScales.x.apply(0),g=d/2*(1-2*this.opts("padding")),n,h,k,s=this.opts("align"),j=this;if("left"==s||"right"==s){var l=d/2-g;"right"==s?(k=f.sub(c.x,g),n=f.sub(c.x,d/2),h=f.sub(c.x,l+2*g)):(k=f.add(c.x,d/2),n=f.add(c.x,
l),h=f.add(c.x,l+2*g))}else"center"==s&&(n=f.sub(c.x,g),k=c.x,h=f.add(c.x,g));c.y_q0||(c.y_q0=c.y);c.y_q1||(c.y_q1=c.y);c.y_q2||(c.y_q2=c.y);c.y_q3||(c.y_q3=c.y);c.y_q4||(c.y_q4=c.y);var m=this.opts("onDoubleclick");e.each(a.computedData,function(a){a.each(function(a){!e.isNull(a.$q0)&&!e.isNull(a.$q3)?(b.vline().attr("func",{y1:c.y_q0,y2:c.y_q1,x:k,_style:c}).attr("data",a),b.vline().attr("func",{y1:c.y_q3,y2:c.y_q4,x:k,_style:c}).attr("data",a),b.rect().ggDoubleClick(m,j).attr("func",{x1:n,x2:h,
y1:c.y_q1,y2:c.y_q3,_style:c}).attr("data",a),b.hline().attr("func",{x1:n,x2:h,y:c.y_q4,_style:c}).attr("data",a),b.hline().attr("func",{x1:n,x2:h,y:c.y_q2,_style:c}).attr("data",a),b.hline().attr("func",{x1:n,x2:h,y:c.y_q0,_style:c}).attr("data",a)):b.point().ggTooltip(c).attr("func",{cx:k,cy:c.y,r:c.radius,symbol:f.constfunc(G.symbol.CIRCLE),_style:c}).attr("data",a)})})};G.layer.box.prototype.imputeMapping=function(a){return G.layer.base.prototype.imputeMapping.call(this,a,{group:"x"})};G.layer.box.prototype.checkErrors=
function(a){return"number"!==a.rawScales.y.type()?(G.error(311,"y scale must be numeric."),!0):!1};var Da=j;Da.layer.histo=f.makeClass("gg.layer.histo",Da.layer.bar);Da.layer.histo.prototype.init=function(){Da.layer.bar.prototype.init.call(this);this._default_stats=Da.stats.bin};var pa=j;pa.layer.jitter=f.makeClass("gg.layer.jitter",pa.layer.base);pa.layer.jitter.prototype.init=function(){pa.layer.base.prototype.init.call(this);this.opts("radius",3);this.opts("symbol",pa.symbol.CIRCLE)};pa.layer.jitter.prototype.render=
function(a){var b=a.coord,c=a.scales,d={cx:function(a){return c.x(a)+20*(Math.random()-0.5)},cy:function(a){return c.y(a)+20*(Math.random()-0.5)},r:c.radius,symbol:c.symbol,stroke:c.stroke,"stroke-width":c.strokewidth,"fill-opacity":c.opacity,fill:c.color};a.computedData.each(function(a){b.point().attr("func",d).attr("data",a)})};pa.layer.jitter.prototype.hasGroup=function(){return!1};var X=j;X.layer.line=f.makeClass("gg.layer.line",X.layer.base);X.layer.line.prototype.init=function(){X.layer.base.prototype.init.call(this);
this.opts("symbol",X.symbol.CIRCLE);var a=this;e.each(X.opts.line,function(b,c){a.opts(c,b)})};X.layer.line.prototype.layerGroup=function(){return["group","group_color","group_strokewidth"]};X.layer.line.prototype.render=function(a){var b=a.coord,c=a.scales,d=c.y_override||c.y;this.map("x");this.map("y");var f=this;e.each(a.computedData,function(e){var h;h=f.opts("domain")?f.fillZero(e,a,["$sum","$partial_1","$partial_2"]):e;b.poly().attr("func",{x:c.x,y:d,_sort:c.x,stroke:c.color,fill:"none","stroke-width":c.strokewidth}).attr("data",
h);if(100>e.len()){var k={cx:c.x,cy:d,r:c.strokewidth,stroke:"#FFFFFF",fill:c.color,symbol:c.symbol,"stroke-width":0};e.each(function(a){b.point().ggTooltip(c).attr("func",k).attr("data",a)})}})};X.layer.line.prototype.imputeMapping=function(a){return X.layer.base.prototype.imputeMapping.call(this,a,{group:["strokewidth","stroke","color"]})};X.layer.line.prototype.defaultMin=function(a){if("y"==a)return 0};var ia=j;ia.layer.path=f.makeClass("gg.layer.path",ia.layer.base);ia.layer.path.prototype.init=
function(){ia.layer.base.prototype.init.call(this);var a=this;e.each(ia.opts.line,function(b,c){a.opts(c,b)})};ia.layer.path.prototype.render=function(a){var b=a.coord,c=a.scales,d=c.y_override||c.y;e.each(a.computedData,function(a){b.poly().attr("func",{x:c.x,y:d,stroke:c.color,fill:"none","stroke-width":c.strokewidth}).attr("data",a)})};ia.layer.line.prototype.imputeMapping=function(a){return ia.layer.base.prototype.imputeMapping.call(this,a,{group:["stroke","color"]})};var Y=j;Y.layer.point=f.makeClass("gg.layer.point",
Y.layer.base);Y.layer.point.prototype.init=function(){Y.layer.base.prototype.init.call(this);var a=this;e.each(Y.opts.point,function(b,c){a.opts(c,b)});this.opts("symbol",Y.symbol.CIRCLE)};Y.layer.point.prototype.render=function(a){var b=a.coord,c=a.scales,d={cx:c.x,cy:c.y_override||c.y,r:c.radius,symbol:c.symbol,_style:c};a.computedData.each(function(a){b.point().ggTooltip(c).attr("func",d).attr("data",a)},this.opts("render-max"))};Y.layer.point.prototype.imputeMapping=function(a){return Y.layer.base.prototype.imputeMapping.call(this,
a,{color:"stroke"})};Y.layer.point.prototype.hasGroup=function(){return!1};Y.layer.base.prototype.requiredMap=function(){return["x","y"]};var qa=j;qa.layer.text=f.makeClass("gg.layer.text",qa.layer.base);qa.layer.text.prototype.init=function(){qa.layer.base.prototype.init.call(this);var a=this;e.each(qa.opts.text,function(b,c){a.opts(c,b)})};qa.layer.text.prototype.render=function(a){var b=a.coord,c=a.scales,d=c.y_override||c.y;a.computedData.each(function(a){b.text().attr("func",{x:c.x,y:d,text:c.text,
fill:c.color,"fill-opacity":c.opacity,"font-size":c.fontsize,"font-family":c.font}).attr("data",a)})};qa.layer.text.prototype.hasGroup=function(){return!1};var xa=j;xa.layer.tile=f.makeClass("gg.layer.tile",xa.layer.base);xa.layer.tile.prototype.init=function(){xa.layer.base.prototype.init.call(this);this.opts("stroke","none").opts("padding",0.5)};xa.layer.tile.prototype.render=function(a){var b=a.scales,c=a.rawScales.x.width(),d=a.rawScales.y.width(),e=c/2,n=d/2,h=a.coord;a.computedData.each(function(a){h.rect().attr("func",
{x1:f.sub(b.x,e),y1:f.sub(b.y,n),x2:f.add(b.x,e),y2:f.add(b.y,n),_style:b}).attr("data",a)})};xa.layer.tile.prototype.hasGroup=function(){return!1};var t=j;t.pivot=f.makeClass("gg.pivot");t.pivot.prototype.init=function(a){this._data=a;this._statData={};this._attr=f.cloneobj(t.opts.pivot);this._mapping={};this._levels={};this._stats=null;this._calculated=!1;this._scales={}};t.pivot.prototype.data=f.dataGetter();t.pivot.prototype.map=function(a,b){if(1===arguments.length)return this._mapping[a];b?
this._mapping[a]=b:delete this._mapping[a];this.resetCalculate();return this};t.pivot.prototype.levels=function(a,b){if(1===arguments.length)return this._levels[a]?this._levels[a]:this.callData("levels",a);b?this._levels[a]=b:delete this._levels[a];return this};t.pivot.prototype.getMap=function(){var a={};this._mapping.column&&(a.group_c=this._mapping.column);this._mapping.row&&(a.group_r=this._mapping.row);this._mapping.value&&(a.y=this._mapping.value);return a};t.pivot.prototype.getScale=function(a){return this._scales[a]};
t.pivot.prototype.scale=function(a,b){if(!("column"!=a&&"row"!=a)){(b=f.instantiate(b))||t.error(201,"Attempting to add an undefined or malformed scale: "+b);var c=f.cloneobj(b);c.attach(this,a);this._scales[a]=c;return this}};t.pivot.prototype.opts=f.opts();t.pivot.prototype.stats=function(a){if(1===arguments.length)return(a=f.instantiate(a))||t.error(304,"Attempting to add an undefined or malformed statistic: "+a),this._stats=a,this.resetCalculate(),this;if(this._stats)return this._stats;var b=
this._mapping.value,c=b?this._data.type(b):"";return"category"==c||!b?t.stats.count():"date"==c?t.stats.mean():t.stats.sum()};t.pivot.prototype.callData=function(a,b,c){if(!c||"data"==c)return this._data[a](b);if("aes"==c)return this._data[a](this.map(b));t.error(-1,"not supported "+c)};t.pivot.prototype.type=function(a,b){return this.callData("type",a,b)};t.pivot.prototype.min=function(a,b){return this.callData("min",a,b)};t.pivot.prototype.max=function(a,b){return this.callData("max",a,b)};t.pivot.prototype.calculateStats=
function(a,b){return a.calculateStats(this._data,b)[0]};t.pivot.prototype.calculate=function(){if(!this._calculated){var a=this.stats(),b={};this._scales.column&&(b.group_c=this._scales.column);this._scales.row&&(b.group_r=this._scales.row);var c=this.getMap(),b={scales:b,mapping:c,group_aes:[],attr:{y:this.opts("y"),x:this.opts("x")},no_partials:!0};this._statData={};c.group_c&&c.group_r&&(b.group_aes=["group_c","group_r"],this._statData.cr=this.calculateStats(a,b));if(c.group_c){var d=b.mapping.group_r;
delete b.mapping.group_r;b.group_aes=["group_c"];this._statData.c=this.calculateStats(a,b);b.mapping.group_r=d;delete b.mapping.group_c}c.group_r&&(b.group_aes=["group_r"],this._statData.r=this.calculateStats(a,b),delete b.mapping.group_r);this._statData.none=this.calculateStats(a,b);return this}};t.pivot.prototype.resetCalculate=function(){this._calculated=!1;this._default_stats=t.stats.sum;return this};t.pivot.prototype._getPrettifyFunction=function(a,b){var c=-Infinity,d=!0;e.each(a,function(a){e.each(a.get(b),
function(a){a>c&&(c=a);d&&0!==a%1&&(d=!1)})});var g=Math.log(Math.abs(c))/Math.LN10;return d||3<=g?function(a){return f.prettify(a,0)}:function(a){return f.prettify(a,-Math.floor(g-2))}};var Ua=function(a){return a.toString()};t.pivot.prototype._getColumnFormatter=function(){return!this.opts("colFormatter")?Ua:this.opts("colFormatter")};t.pivot.prototype._getRowFormatter=function(){return!this.opts("rowFormatter")?Ua:this.opts("rowFormatter")};t.pivot.prototype._makeTableArray=function(){var a=this.map("column"),
b=this.map("row"),c=this.stats().imputeMapping({}),d=c.y||c.y_override,f=a?this.levels(a):[],n=b?this.levels(b):[],h=this._getRowFormatter(),k=this._getColumnFormatter(),f=e.map(f,k),n=e.map(n,h),j=f.length,p=n.length,l=this._getPrettifyFunction(this._statData,d),m=Array(p+2),c=this.opts("title-all");m[0]=[""].concat(f).concat([c]);var q,r;for(r=1;r<p+2;r++)m[r]=Array(j+2),m[r][0]=r==p+1?c:n[r-1];this._statData.cr&&e.each(this._statData.cr.getRaw(),function(c){r=a?e.indexOf(f,k(c[a])):-1;q=b?e.indexOf(n,
h(c[b])):-1;-1!==q&&-1!==r&&(m[q+1][r+1]=l(c[d]))});this._statData.c&&e.each(this._statData.c.getRaw(),function(b){r=a?e.indexOf(f,k(b[a])):0;-1!==r&&(m[p+1][r+1]=l(b[d]))});this._statData.r&&e.each(this._statData.r.getRaw(),function(a){q=b?e.indexOf(n,h(a[b])):0;-1!==q&&(m[q+1][j+1]=l(a[d]))});this._statData.none&&e.each(this._statData.none.getRaw(),function(a){m[p+1][j+1]=l(a[d])});return m};t.pivot.prototype.makeTableDom=function(a){a||t.error(212,"Invalid dom for .opts('dom') - "+a);var b=jQuery,
c=b(a);c||t.error(212,"Invalid dom for .opts('dom') - "+a);var d=this.opts("padding-left"),e=this.opts("padding-right"),f=this.opts("padding-top"),h=this.opts("padding-bottom"),k=this.opts("width");c.empty();a=b("<table></table>");a.css("color","black");a.css("width",k);a.css("margin-top",f);a.css("margin-bottom",h);a.css("margin-right",e);a.css("margin-left",d);b=b("<tbody></tbody>");a.append(b);c.append(a);return b};t.pivot.prototype.render=function(a){this.calculate();var b=this._makeTableArray();
a=a||this.opts("dom");a=this.makeTableDom(a);var c,d,f,n;f=b[0]?b[0].length+2:2;d=b[0]?b[0].length:1;var h=b[0]?b.length:1,k=this.opts("title");c=$("<tr></tr>");f=$("<th></th>").attr("colspan",f);f.text(e.isUndefined(k)?" ":k);f.css("textAlign","center");f.css("paddingBottom","5px");c.append(f);a.append(c);k=this.opts("title-column")||this.map("column");c=$("<tr></tr>");c.append($("<th></th>"));c.append($("<th></th>"));f=$("<th></th>").attr("colspan",d);f.text(k);f.css("textAlign","center");f.css("paddingBottom",
"5px");f.css("font-weight","normal");k&&f.css("border","1px solid black");c.append(f);a.append(c);for(var j,k=0;k<b.length;k++){d=b[k];c=$("<tr></tr>");0===k?c.append($("<th></th>")):1==k&&(n=this.opts("title-row")||this.map("row"),f=$("<th></th>").attr("rowspan",h),j=$("<div></div>"),j.text(n),j.css("-webkit-transform","rotate(270deg)"),j.css("-moz-transform","rotate(270deg)"),j.css("-ms-transform","rotate(270deg)"),j.css("-o-transform","rotate(270deg)"),f.css("paddingBottom","5px"),f.css("font-weight",
"normal"),n&&f.css("border","1px solid black"),f.css("textAlign","center"),f.css("verticalAlign","middle"),f.append(j),c.append(f));for(j=0;j<d.length;j++)n=d[j],f=$(0===k*j?"<th></th>":"<td></td>"),f.text(e.isUndefined(n)?" \u00a0":n),c.append(f),f.css("minWidth","50px"),f.css("width",100/d.length+"%"),f.css("minHeight","22px"),f.css("height",100/b.length+"%"),f.css("padding","2px"),0==k&&0==j||(0==k||0==j?f.css("border","1px solid black"):(f.css("border","1px solid gray"),f.css("textAlign","right")));
a.append(c)}return this};var E=j;E.scale.continuous=f.makeClass("gg.scale.continuous",E.scale.base);E.scale.continuous.prototype.init=function(a,b,c){E.scale.base.prototype.init.call(this);this._type="number";this._d3scale=null;this._attr.min=e.isNumber(b)?b:null;this._attr.max=e.isNumber(c)?c:null;this._useDefault=!1;this._defaultMax=this._defaultMin=null;this.opts("transform",a||"linear");this.opts("expand",0);"log"===this.opts("transform")&&this.opts("absolute_min",0.1)};E.scale.continuous.prototype.domain=
function(a){return 1===arguments.length?(this.min(a[0]),this.max(a[1]),this):[this._attr.domain_low,this._attr.domain_high]};E.scale.continuous.prototype.width=function(){this._attr.width||(this._attr.width=this._makeWidth());return this._attr.width};E.scale.continuous.prototype.maxLabelWidth=function(){var a=this._graph.max(this._aes),b=this._graph.min(this._aes),b=Math.floor(Math.log((a-b)/10)/Math.LN10);return a?f.strlenToPixel(f.prettify(a,-b).length):15};E.scale.continuous.prototype.distance=
function(a,b){return Math.abs(this._d3scale(a)-this._d3scale(b))};E.scale.continuous.prototype._makeDefaultMinMax=function(){if(this._graph){var a=this._aes,b=this._graph.min(a),c=this._graph.max(a);this._defaultMin=this._graph.defaultMin(a,b);this._defaultMax=this._graph.defaultMax(a,c);e.isNumber(this._defaultMin)&&this._defaultMin<this._attr.absolute_min&&(this._defaultMin=this._attr.absolute_min);e.isNumber(this._defaultMax)&&this._defaultMax>this._attr.absolute_max&&(this._defaultMax=this._attr.absolute_max)}};
E.scale.continuous.prototype._makeWidth=function(){var a=this._graph.levels(this._aes,null,this._facetIndex);if(1>=a.length)a=this.rangeSize();else var b=e.bind(this._apply,this),a=f.minimumDelta(e.map(a,b));return Math.max(a,1)};E.scale.continuous.prototype._makeDomain=function(){this._makeDefaultMinMax();var a=this._aes,b=this._attr.min,c=this._attr.max,d;d=0;var f=2;e.isNumber(b)&&e.isNumber(c)?(d=b,f=c):0<this._graph._layers.length&&(this._graph.isMapped(a,!0)?(d=this._graph.min(a,null,this._facetIndex),
a=this._graph.max(a,null,this._facetIndex),d===a&&(d-=1,a+=1)):(a=e.chain(this._graph._layers).invoke("opts",a).value(),d=e.min(a)-1,a=e.max(a)+1),0<this.opts("expand")&&(f=(a-d)*this.opts("expand"),0===d&&"y"==this._aes||(d-=f),a+=f),e.isNumber(this._defaultMin)&&d>this._defaultMin&&(d=this._defaultMin),e.isNumber(this._defaultMax)&&a<this._defaultMax&&(a=this._defaultMax),d=e.isNumber(b)?b:d,f=e.isNumber(c)?c:a);e.isNumber(this._attr.absolute_min)&&(d=Math.max(d,this._attr.absolute_min));e.isNumber(this._attr.absolute_max)&&
(f=Math.min(f,this._attr.absolute_max));this._saneNumber(d)||E.error(406,"min() calculation returned an invalid number.");this._saneNumber(f)||E.error(406,"max() calculation returned an invalid number.");d>f&&E.error(408,"min is set to be bigger than max in a continuous scale.");this.opts("domain_low",d);this.opts("domain_high",f);return[d,f]};E.scale.continuous.prototype.make=function(a){this.range()||E.error(407,"Continuous scale's range is not set.");var b=this.opts("transform");this._d3scale=
"log"==b?F.scale.log():"sqrt"==b?F.scale.sqrt():F.scale.linear();this._facetIndex=e.isNumber(a)?a:-1;a=this._makeDomain();this._d3scale.domain(a).range(this.range());return this};E.scale.continuous.prototype._apply=function(a){this._d3scale||this.make();if(null===a)return null;0===a&&"log"==this.opts("transform")&&(a=this._attr.domain_low);return this._d3scale(a)};E.scale.continuous.prototype.ticks=function(a,b){var c=0,d=this._attr.domain_low,e=this._attr.domain_high,n="log"==this.opts("transform"),
h=this._suggestNumticks(a,b);n&&(d=Math.max(Math.log(d)/Math.LN10,0),e=Math.log(e)/Math.LN10,c=E.opts.epsilon);var k=e-d,j=Math.pow(10,Math.floor(Math.log(k/h)/Math.LN10)),h=h/k*j;0.15>=h?j*=10:0.35>=h?j*=5:0.75>=h&&(j*=2);h=[];d=Math.ceil(d/j)*j;n&&(d-=1);for(k=-Math.floor(Math.log(j)/Math.LN10);d<=e+c;){var p=d,l=p;if(n){if(0!==p%1&&0.1>=p%1){d+=j;continue}if(p%1>c&&(p=Math.floor(p)+Math.log(10*(p%1))/Math.LN10,0==p%1)){d+=j;continue}p=Math.exp(p*Math.LN10);if(p>this._attr.domain_high+c)break;if(p<
this._attr.domain_low-c){d+=j;continue}l=f.prettify(p)}else l=f.prettify(p,k);h.push(this._tickObject(p,this.apply(p),l));d+=j}return h};E.scale.continuous.prototype.CONTINUOUS=!0;var P=j;P.scale.discrete=f.makeClass("gg.scale.discrete",P.scale.base);P.scale.discrete.prototype.init=function(){P.scale.base.prototype.init.call(this);this._type="category";this._eachWidth=this._levels=null;this._padding=0.02;this._rangeMin=null};P.scale.discrete.prototype.domain=function(a){if(0===arguments.length)return this._levels;
this._levels=a;return this};P.scale.discrete.prototype.padding=function(a){if(0===arguments.length)return this._padding;f.assertNumber(a);this._padding=a;return this};P.scale.discrete.prototype.width=function(){this._eachWidth||this.make();return this._eachWidth};P.scale.discrete.prototype.maxLabelWidth=function(){var a=this._graph.levels(this._aes);return!a?0:f.strlenToPixel(e.chain(a).map(function(a){return String(a).length}).max().value())};P.scale.discrete.prototype.make=function(a){this.range()||
P.error(407,"Discrete scale's range is not set.");this._facetIndex=e.isNumber(a)?a:-1;var b=this.range(),c=Math.abs(b[1]-b[0]);this._rangeMin=e.min(b);this._levels||(this._levels=this._graph.levels(this._aes,null,a),0==this._levels.length&&(this._levels=[""]));this._eachWidth=c/this._levels.length;this._eachWidth=Math.abs(this._eachWidth);a=1<=this._padding?this._padding:this._eachWidth*this._padding;this._eachWidth-=a;this._padding=a;return this};P.scale.discrete.prototype._apply=function(a){this._levels||
this.make();var b=e.indexOf(this._levels,a);-1===b&&this.warn(404,"Discrete scale got value "+a+" that is not in the domain.");return this._rangeMin+b*(this._eachWidth+this._padding)+this._padding/2+this._eachWidth/2};P.scale.discrete.prototype.ticks=function(a,b){for(var c=this._suggestNumticks(a,b),c=Math.max(1,Math.round(this._levels.length/c)),d=[],e=Math.floor(c/2);e<this._levels.length;e+=c)d.push(this._tickObject(this._levels[e],this.apply(this._levels[e]),this._levels[e]));return d};P.scale.discrete.prototype.toCode=
function(a,b){var c={cls:this._cls_name,funcs:[["padding",this._padding],["opts",JSON.stringify(this.getAttr())]]};this._levels&&c.funcs.push(["domain",JSON.stringify(this._levels)]);return f.toCode(a,b,c)};P.scale.discrete.prototype.DISCRETE=!0;var ca=j;ca.scale.gradient=f.makeClass("gg.scale.gradient",ca.scale.continuous);ca.scale.gradient.prototype.init=function(a,b){ca.scale.continuous.prototype.init.call(this);this._attr.range_low=a||ca.opts.gradient.low;this._attr.range_high=b||ca.opts.gradient.high;
this._d3scale=null};ca.scale.gradient.prototype.make=function(){this.range()||ca.error(407,"Gradient scale's range is not set.");e.isNumber(this._attr.domain_low)||(this._attr.domain_low=this._graph.min(this._aes));e.isNumber(this._attr.domain_high)||(this._attr.domain_high=this._graph.max(this._aes));this._d3scale=F.scale.linear().domain([this._attr.domain_low,this._attr.domain_high]).range(this.range());return this};ca.scale.gradient.prototype._apply=function(a){this._d3scale||this.make();return this._d3scale(a)};
var Z=j;Z.scale.id=f.makeClass("gg.scale.id",Z.scale.base);Z.scale.id.prototype.init=function(){Z.scale.base.prototype.init.call(this);this._type=null};Z.scale.id.prototype.type=function(){this._type||(this._type=this._graph.type(this._aes));return this._type};Z.scale.id.prototype.domain=function(){return"number"==this._type?[this._graph.min(this._aes),this._graph.max(this._aes)]:this._graph.levels(this._aes)};Z.scale.id.prototype.range=function(){return this.domain()};Z.scale.id.prototype.make=function(){"number"==
this.type()&&(this._attr.domain_low=this._graph.min(this._aes),this._attr.domain_high=this._graph.max(this._aes))};Z.scale.id.prototype._apply=function(a){return a};Z.scale.id.prototype.maxLabelWidth=function(){var a=this._graph.levels(this._aes);return!a?0:f.strlenToPixel(e.chain(a).map(function(a){return String(a).length}).max().value())};var ra=j;ra.scale.palette=f.makeClass("gg.scale.palette",ra.scale.discrete);ra.scale.palette.prototype.init=function(a){ra.scale.discrete.prototype.init.call(this);
this._paletteName=a;this._d3scale=null;this._colorTable={};this._made=!1};ra.scale.palette.prototype.make=function(a){a?this._levels=a:this._levels||(this._levels=this._graph.levels(this._aes));a=this._levels.length;if(10>=a)this._d3scale=F.scale.category10();else if(20>=a)this._d3scale=F.scale.category20();else{this._colorTable={};var b;for(b=0;b<a;b++)this._colorTable[this._levels[b]]=f.getRandomColor()}this._made=!0;return this};ra.scale.palette.prototype._apply=function(a){this._made||this.make();
if(this._d3scale)return this._d3scale(a);if(this._colorTable[a])return this._colorTable[a];this.warn(404,"Palette scale got value "+a+" that is not in the domain.");return null};ra.scale.palette.prototype.toCode=function(a,b){var c={cls:this._cls_name,funcs:[["opts",JSON.stringify(this.getAttr())]]};this._paletteName&&(c.params=[f.qt(this._paletteName)]);this._levels&&c.funcs.push(["domain",JSON.stringify(this._levels)]);return f.toCode(a,b,c)};var ya=j;ya.scale.symbol=f.makeClass("gg.scale.symbol",
ya.scale.discrete);ya.scale.symbol.prototype.init=function(){ya.scale.discrete.prototype.init.call(this);this._symbols=[1,2,3,4,5,6,7,8,9];this._numSymbols=this._symbols.length};ya.scale.symbol.prototype.make=function(a){a?this._levels=a:this._levels||(this._levels=this._graph.levels(this._aes));this._numLevels=this._levels.length;return this};ya.scale.symbol.prototype._apply=function(a){this._d3scale||this.make();return this._symbols[e.indexOf(this._levels,a)%this._numSymbols]};var sa=j;sa.scale.time=
f.makeClass("gg.scale.time",sa.scale.continuous);sa.scale.time.prototype.init=function(){sa.scale.continuous.prototype.init.call(this);this.opts("pixel_per_tick_x",90);this._d3scale=F.time.scale()};sa.scale.time.prototype.make=function(a){this._facetIndex=e.isNumber(a)?a:-1;a=this._makeDomain();this._d3scale.domain(a).range(this.range())};sa.scale.time.prototype.ticks=function(a){a=this._suggestNumticks(a);var b=this,c=this._d3scale.ticks(a),d=this._d3scale.tickFormat(a);return e.map(c,function(a){return b._tickObject(a,
b.apply(a),d(a))})};sa.scale.time.prototype.maxLabelWidth=function(){var a;try{var b=this._makeDomain();a=b[1]-b[0]}catch(c){a=this._graph.min(this._aes),a=this._graph.max(this._aes)-a}a/=20;return 36E5>=a||864E5>=a?f.strlenToPixel(15):1296E6>=a||10368E6>=a?f.strlenToPixel(9):f.strlenToPixel(4)};var ja=j;ja.scale.time_gradient=f.makeClass("gg.scale.time_gradient",ja.scale.time);ja.scale.time_gradient.prototype.init=function(a,b){ja.scale.time.prototype.init.call(this);this._attr.range_low=a||ja.opts.gradient.low;
this._attr.range_high=b||ja.opts.gradient.high;this._d3scale=null};ja.scale.time.prototype.make=function(){this._d3scale=F.time.scale();var a=this._makeDomain();this._d3scale.domain(a).range(this.range())};ja.scale.time_gradient.prototype._apply=function(a){this._d3scale||this.make();return this._d3scale(a)};var Ga=j;Ga.stats.bin=f.makeClass("gg.stats.bin",Ga.stats.sum);Ga.stats.bin.prototype.compute=function(a,b){var c=a.getObject(0),d=a.len(),f=b.mapping.y;if(f)for(var j=1;j<d&&e.isNull(c[f]);)c=
a.getObject(j),j++;d=this.makeMeta(a);c.$sum=a.len();return Ga.data([c],d)};var ka=j;ka.stats.box=f.makeClass("gg.stats.box",ka.stats.aggregate);ka.stats.box.prototype.imputeMapping=function(a){a=ka.stats.aggregate.prototype.imputeMapping.call(this,a,{group_stats:["group","x"]});return e.extend(a,{y_q0:"$q0",y_q1:"$q1",y_q2:"$q2",y_q3:"$q3",y_q4:"$q4"})};ka.stats.box.prototype.compute=function(a,b){for(var c=b.mapping,d=a.getObject(0),c=a.get(c.y),g=c.length-1,j=e.sortBy(c,f.identity),h=g/4,k=g/2,
l=3*(g/4),h=(j[Math.ceil(h)]+j[Math.floor(h)])/2,k=(j[Math.ceil(k)]+j[Math.floor(k)])/2,l=(j[Math.ceil(l)]+j[Math.floor(l)])/2,p=l-h,m=0;j[m]<k-1.5*p;)m++;for(m=j[m];j[g]>k+1.5*p;)g--;j=j[g];d.$q0=m;d.$q1=h;d.$q2=k;d.$q3=l;d.$q4=j;f.assertNumber(m);f.assertNumber(h);f.assertNumber(k);f.assertNumber(l);f.assertNumber(j);d=[d];for(h=0;h<c.length;h++)(c[h]>j||c[h]<m)&&d.push(a.getObject(h));c=this.makeMeta(a);return ka.data(d,c)};ka.stats.box.prototype.keys=function(){return ka.stats.aggregate.prototype.keys.call(this).concat(["$q0",
"$q1","$q2","$q3","$q4"])};j.stats.count=j.stats.bin;j.stats.id=f.makeClass("gg.stats.id",j.stats.base);var Ha=j;Ha.stats.mean=f.makeClass("gg.stats.mean",Ha.stats.sum);Ha.stats.mean.prototype.compute=function(a,b){var c=b.mapping,d=a.getObject(0),g=a.len();if(c=c.y){for(var j=1;j<g&&e.isNull(d[c]);)d=a.getObject(j),j++;g=f.sum.apply(a.get(c))/a.len();d.$sum=g}else d.$sum=b.attr.y;g=this.makeMeta(a);return Ha.data([d],g)};var la=j;la.stats.stack=f.makeClass("gg.stats.stack",la.stats.aggregate);la.stats.stack.prototype.compute=
function(a,b){var c=b.mapping,d=c.y,f=[],j=a.len(),h=0,k=0;if(d)for(var l=a.getTypeObj(d).represent,p=c.group_stats||d,c=e.sortBy(a.getObjects(),function(a){return l(a[p])}),m=0;m<j;m++){var q=c[j-m-1],r=q[d];0>r?(q.$partial_1=k,k+=r,q.$partial_2=k):(q.$partial_1=h,h+=r,q.$partial_2=h);f.push(q)}else for(m=0;m<j;m++)q=a.getObject(m),q.$partial_1=h,h+=1,q.$partial_2=h,f.push(q);d=this.makeMeta(a);return la.data(f,d)};la.stats.stack.prototype.imputeMapping=function(a){a=la.stats.aggregate.prototype.imputeMapping.call(this,
a,{group_stats:"x"});return e.extend(a,{y_1:"$partial_1",y_2:"$partial_2"})};la.stats.stack.prototype.keys=function(){return la.stats.aggregate.prototype.keys.call(this).concat(["$partial_1","$partial_2"])};var ta=j;ta.stats.tilestat=f.makeClass("gg.stats.tilestat",ta.stats.base);ta.stats.tilestat.prototype.entry=function(a,b,c){var d={};if(b.x){var e=b.x;d.group=Va(a.min(e),a.max(e),10);b.group=e}b.y&&(e=b.y,d.group2=Va(a.min(e),a.may(e),10),b.group2=e);return this.group(a,b,c,d)};var Va=function(a,
b,c){a>=b&&ta.error(900,"Cannot create a grouping function where min is "+a+" and max is "+b);0>=c&&ta.error(901,"Cannot create a grouping function where number of bins is less than 1.");var d=b-a;b=function(b){b=Math.floor((b-a)/d*c);b==c&&(b=c-1);return a+b*d/c};b.width=d/c;return b};ta.stats.tilestat.prototype.imputeMapping=function(a){a=ta.stats.base.prototype.imputeMapping.call(this,a,{group_stats_1:"x",group_stats_2:"y"});return e.extend(a,{y:"$count"})};var ma=j;ma.stats.unique=f.makeClass("gg.stats.unique",
ma.stats.aggregate);ma.stats.unique.prototype.compute=function(a,b){var c=b.mapping,d=a.getObject(0),c=c.y;d.$unique=c?a.levels(c).length:0;c=this.makeMeta(a);return ma.data([d],c)};ma.stats.unique.prototype.imputeMapping=function(a){a=ma.stats.aggregate.prototype.imputeMapping.call(this,a,{group_stats:"x"});return e.extend(a,{y_override:"$unique"})};ma.stats.unique.prototype.keys=function(){return ma.stats.aggregate.prototype.keys.call(this).concat(["$unique"])};var T=j;T.symbol=T.symbol||{};var nb=
Math.sqrt(2),Wa=Math.sqrt(3)/2,Xa=Math.sqrt(3)/2,Ya=-Math.sqrt(3)/2,Za=-Math.sqrt(3)/2,ob=(Math.sqrt(5)-1)/4,da=function(a){return Math.cos(36*(Math.PI/180)*a)},ea=function(a){return Math.sin(36*(Math.PI/180)*a)},pb=da(1),qb=da(2),rb=da(3),sb=da(4),tb=da(5),ub=da(6),vb=da(7),wb=da(8),xb=da(9),yb=ea(1),zb=ea(2),Ab=ea(3),Bb=ea(4),Cb=ea(5),Db=ea(6),Eb=ea(7),Fb=ea(8),Gb=ea(9);T.symbol.CIRCLE=1;T.symbol.BOX=2;T.symbol.DIAMOND=3;T.symbol.HEX=4;T.symbol.TRIANGLE=5;T.symbol.TRIANGLE_REVERSE=6;T.symbol.STAR=
7;T.symbol.CROSS=8;T.symbol.X=9;T.symbol.makePath=function(a,b,c,d){if(1==a)return[["M",b,c+d],["A",d,d,0,1,1,b,c-d],["A",d,d,0,1,1,b,c+d],["Z"]];if(2==a)return[["M",b+d,c+d],["L",b-d,c+d],["L",b-d,c-d],["L",b+d,c-d],["Z"]];if(3==a)return[["M",b+d,c],["L",b,c+d],["L",b-d,c],["L",b,c-d],["Z"]];if(4==a)return[["M",b+0*d,c+1*d],["L",b+d*Wa,c+0.5*d],["L",b+d*Xa,c+-0.5*d],["L",b+0*d,c+-1*d],["L",b+d*Ya,c+-0.5*d],["L",b+d*Za,c+0.5*d],["Z"]];if(6==a)return[["M",b+0*d,c+1*d],["L",b+d*Xa,c+-0.5*d],["L",b+
d*Ya,c+-0.5*d],["Z"]];if(5==a)return[["M",b+d*Wa,c+0.5*d],["L",b+0*d,c+-1*d],["L",b+d*Za,c+0.5*d],["Z"]];if(7==a)return a=d*ob,[["M",b+0*a,c+1*a],["L",b+d*yb,c+d*pb],["L",b+a*zb,c+a*qb],["L",b+d*Ab,c+d*rb],["L",b+a*Bb,c+a*sb],["L",b+d*Cb,c+d*tb],["L",b+a*Db,c+a*ub],["L",b+d*Eb,c+d*vb],["L",b+a*Fb,c+a*wb],["L",b+d*Gb,c+d*xb],["Z"]];if(8==a)return[["M",b+d,c],["L",b,c],["L",b,c+d],["L",b,c],["L",b-d,c],["L",b,c],["L",b,c-d],["L",b,c],["Z"]];if(9==a)return a=d*nb/2,[["M",b+a,c+a],["L",b,c],["L",b+a,
c-a],["L",b,c],["L",b-a,c+a],["L",b,c],["L",b-a,c-a],["L",b,c],["Z"]]};var C=j;C.type.category=f.makeClass("gg.type.category",C.type.base);C.type.category.prototype.min=function(){C.error(802,"Invalid operation min() on categorical variable.")};C.type.category.prototype.max=function(){C.error(802,"Invalid operation max() on categorical variable.")};C.type.category.prototype.coerce=function(a){return C.type.category.prototype.represent(a)};C.type.category.prototype.represent=function(a){return e.isString(a)?
a:null==a?"":e.isNumber(a)?a.toString():""+a};C.type.category.prototype.sort=function(a,b){if(a===b)return 0;e.isString(a)||(a=""+a);e.isString(b)||(b=""+b);var c=a.toLowerCase(),d=b.toLowerCase();return c===d?a<b?-1:a>b?1:0:c<d?-1:c>d?1:0};C.type.category.prototype.validate=function(){return!0};C.type.category.prototype.defaultScale=function(a){f.assertAes(a);var b=null,b=(b={color:C.scale.palette,opacity:C.scale.discrete,radius:C.scale.discrete,stroke:C.scale.palette,strokewidth:C.scale.discrete,
symbol:C.scale.symbol,x:C.scale.discrete,y:C.scale.discrete}[a])?b():C.scale.id();this._postProcess(a,b);return b};var J=j;J.type.date=f.makeClass("gg.type.date",J.type.base);var $a=function(a){return e.isNumber(a)?a:a.getTime()};J.type.date.prototype.min=function(a){return this.coerce(e.min(e.reject(a,e.isNull),$a))};J.type.date.prototype.max=function(a){return this.coerce(e.max(e.reject(a,e.isNull),$a))};J.type.date.prototype.coerce=function(a){return e.isDate(a)?a.getTime():e.isNumber(a)?a:Number(a)};
J.type.date.prototype.represent=function(a){return e.isNumber(a)?a:e.isDate(a)?a.getTime():null};J.type.date.prototype.validate=function(a){return e.isNumber(a)||e.isDate(a)};J.type.date.prototype.defaultScale=function(a){f.assertAes(a);var b=null,b=(b={color:J.scale.time_gradient,opacity:J.scale.time,radius:J.scale.time,stroke:J.scale.time_gradient,strokewidth:J.scale.time,symbol:J.scale.symbol,x:J.scale.time,y:J.scale.time}[a])?b():J.scale.id();this._postProcess(a,b);return b};var D=j;D.type.number=
f.makeClass("gg.type.number",D.type.base);D.type.number.prototype.min=D.type.date.prototype.min;D.type.number.prototype.max=D.type.date.prototype.max;D.type.number.prototype.coerce=function(a){return e.isDate(a)?a.getTime():e.isNumber(a)?a:Number(a)};D.type.number.prototype.represent=D.type.date.prototype.represent;D.type.number.prototype.validate=function(a){return e.isNumber(a)};D.type.number.prototype.sort=function(a,b){return a===b?0:null==a?-1:null==b?1:a<b?-1:a>b?1:0};D.type.number.prototype.defaultScale=
function(a){f.assertAes(a);var b=null,b=(b={color:D.scale.gradient,opacity:D.scale.continuous,radius:D.scale.continuous,stroke:D.scale.gradient,strokewidth:D.scale.continuous,symbol:D.scale.symbol,x:D.scale.continuous,y:D.scale.continuous}[a])?b():D.scale.id();this._postProcess(a,b);return b};var fa=j;fa.type.unknown=f.makeClass("gg.type.unknown",fa.type.base);fa.type.unknown.prototype.min=function(){return null};fa.type.unknown.prototype.max=function(){return null};fa.type.unknown.prototype.coerce=
function(a){return a};fa.type.unknown.prototype.represent=function(a){return a};fa.type.unknown.prototype.validate=function(){return!0};fa.type.unknown.prototype.defaultScale=function(){fa.error(801,"Attempted to call defaultScale() on unknown type.")};var ga=j,Ia=j,Ia=Ia||{},za=function(a,b){a||ga.error(1,"Attempting to package an object that does not exist.");for(var c=b.length,d=0;d<c;d++){var e=b[d];Ia[e]?ga.error(3,"gg."+e+" is already set."):(a[e]||ga.error(2,"Failed while packing "+e+"."),
Ia[e]=a[e])}};za(ga.coord,["cart","polar"]);za(ga.facet,["grid","wrap"]);za(ga.guide,["axis","legend"]);za(ga.layer,"area bar box line path point text tile".split(" "));za(ga.scale,"continuous discrete gradient id palette time".split(" "));za(ga.stats,["bin","stack","count"]);var Ja=j;Ja.stats.ratio=f.makeClass("gg.stats.ratio",Ja.stats.stack);Ja.stats.ratio.prototype.compute=function(a,b){var c=b.mapping.y,d=[],g=a.len(),j=0;if(c)for(var h=f.sum.apply(a.get(c)),k=a.getTypeObj(c).represent,l=e.sortBy(a.getObjects(),
function(a){return k(a[c])}),m=0;m<g;m++){var q=l[g-m-1],r;r=0==h?1/g:q[c]/h;q.$partial_1=j;j+=r;q.$partial_2=j;q[c]=r;d.push(q)}else{r=1/g;for(m=0;m<g;m++)q=a.getObject(m),q.$partial_1=j,j+=r,q.$partial_2=j,d.push(q)}g=this.makeMeta(a);return Ja.data(d,g)};var e=window._,F=window.d3;return j}();