/** Generated on 2012-04-24T11:39:02.320381 */var gg=gg||{},u=u||{};if(!console)var console={log:function(){},assert:function(){},warn:function(){}};(function(a,b){"use strict",b.makeClass=function(a,c){var d={},e=function(a,b){if(!(this instanceof e))return new e(d,arguments);typeof this.init=="function"&&this.init.apply(this,a===d?b:arguments)};return arguments.length>=2&&(e.prototype=new c,e.prototype.constructor=e),b.undef(a)||(e.prototype._cls_name=a,e._class=!0),e},b.undef=function(a){return typeof a=="undefined"},b.constfunc=function(a){return function(){return a}},b.invertedIndex=function(a){var b={};return _.each(a,function(a,c){b[a]=c}),b},b.identity=function(a){return a},b.cloneobj=function(a){var b=_.clone(a);return b.constructor!=a.constructor&&(b.constructor=a.constructor),_.has(a,"_attr")&&(b._attr=_.clone(a._attr)),b},b.postfix=function(a,b){var c={0:"",3:"k",6:"m",9:"b",12:"t"};return _.isUndefined(c[b])?a+"x10^"+b:a+c[b]},b.prettify=function(a,c){arguments.length==1&&(c=-Math.floor(Math.log(Math.abs(a))/Math.LN10),a>0&&a<10&&(c=0));var d=3*Math.round(c/3),e=Math.max(c,d),f=Math.round(a*Math.pow(10,e))/Math.pow(10,e-d);return b.postfix(f.toFixed(e-d),-d)},b.roundTo=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},b.array=function(a,b){var c=[],d=a,e,f=_.isFunction(b);while(d--)f?e=b():e=b,c[d]=e;return c},b.grid=function(a,b,c){var d=0,e=0,f=[],g=_.isFunction(c);for(d=0;d<a;d++){var h=[];for(e=0;e<b;e++)g?h.push(c()):h.push(c);f.push(h)}return f},b.opts=function(){var c=function(c,d){arguments.length===0&&a.error(12,"Function opts() called with less than 1 parameter.");var e=this,f=this._optsUpdate;_.isFunction(f)?f=_.bind(f,this):f=function(){};if(arguments.length==1){if(!_.isString(c)&&_.keys(c).length>0)return _.each(c,function(a,b){e._attr[b]=a,f(b,a)}),this;var g=this._attr[c];return g}return b.assertString(c),this._attr[c]=d,f(c,d),this};return c},b.singleOpts=function(a){return function(b){return arguments.length===0?this.opts(a):this.opts(a,b)}},b.getAttr=function(){var a={};return _.each(this._attr,function(b,c){!_.isNull(b)&&!_.isUndefined(b)&&b!=-Infinity&&b!=Infinity&&(a[c]=b)}),a},b.dataGetter=function(b){b=b||{};var c=b.onChange,d=function(b){if(arguments.length===0)return this._data;if(!b||b._cls_name!="gg.data")b=a.data(b);return this._data=b,c&&c.apply(this),this};return d},b.calculateFacet=function(a,c){if(!c)return[a];var d=c.nrow(),e=c.ncol(),f=function(){return a.clone()},g=b.array(d*e,f),h,i=a.len();for(h=0;h<i;h++){var j=a.getObject(h),k=c.bin(j);g[k].push(j)}return g},b.doubleMap=function(a,b){return _.map(a,function(a){return _.map(a,b)})},b.tripleMap=function(a,b){return _.map(a,function(a){return _.map(a,function(a){return _.map(a,b)})})};var c=[];b.concat=function(a){return c.concat.apply(c,a)},b.pushall=function(a,b){return c.push.apply(a,b)},b.add=function(a,c){var d=_.isFunction(a),e=_.isFunction(c);return d&&e?function(b){return a(b)+c(b)}:d?function(b){return a(b)+c}:e?function(b){return a+c(b)}:b.constfunc(a+c)},b.sub=function(a,c){var d=_.isFunction(a),e=_.isFunction(c);return d&&e?function(b){return a(b)-c(b)}:d?function(b){return a(b)-c}:e?function(b){return a-c(b)}:b.constfunc(a-c)},b.evaluate=function(a,b){return _.isFunction(a)?a(b):a},b.unionType=function(a){var b=_.uniq(_.reject(a,_.isNull));return b.length===0?null:b.length===1?b[0]:_.include(b,"unknown")?"unknown":"category"},b.bool=function(a){return a?!0:!1},b.startswith=function(a,b){if(!_.isString(b)||!_.isString(a))return!1;var c=b.length,d=a.length;return c>d?!1:a.slice(0,c)===b},b.instantiate=function(b){return _.isString(b)?a[b]():b&&b.prototype&&b.prototype._cls_name?b():b},b.sum=function(){var a,b=0,c;if(_.isArray(this)){c=this.length;for(var a=0;a<c;a++)b+=this[a]}c=arguments.length;for(var a=0;a<c;a++)b+=arguments[a];return b},b.mergeArrays=function(a,c){var d=!0,e=b.concat(a);return c=c?c:b.identity,e=_.sortBy(e,c),_.uniq(e,d,c)},b.minimumDelta=function(a,b){if(a.length<=1)return null;var c=a.length,d,e;b=b?b:function(a){return a};var f=b(a[0]),g=Infinity;for(d=1;d<c;d++)e=b(a[d]),g=Math.min(g,e-f),f=e;return g},b.isSuperset=function(a,b){var c=0;for(var d=0;d<b.length;d++){while(a[c]!=b[d]&&c<a.length)c++;if(c==a.length)return!1}return!0},b.assertNumber=function(b){_.isNumber(b)||a.warn(13,"Expecting a number but got "+b+".")},b.assertString=function(b){_.isString(b)||a.warn(14,"Expecting a string but got "+b+".")},b.assertAes=function(c){_.include(a.opts.aes,b.getBaseAes(c))||a.error(11,"Aesthetics "+c+" does not exist.")},b.assertQuery=function(b){b!=="data"&&b!=="aes"&&b!=="aes_group"&&b!=="key"&&a.error(-1,"Query type "+b+" is invalid.")},b.getBlank=function(a){return Array(a+1).join(" ")},b.qt=function(a){return'"'+a+'"'},b.toCode=function(a,c,d){a||(a=0),_.isNumber(c)||(c=a+2),d.cls||(d.cls=[]),d.params||(d.params=[]),d.funcs||(d.funcs=[]);var e=b.getBlank(a)+d.cls+"("+d.params.join(", ")+")";return _.each(d.funcs,function(a){var d=a[0],f=a[1]||[];_.isArray(f)||(f=[f]),e+="\n"+b.getBlank(c)+"."+d+"("+f.join(", ")+")"}),e},b.toCodeBasic=function(a,c){var d={cls:this._cls_name};return _.isFunction(this.getAttr)&&(d.funcs=[["opts",JSON.stringify(this.getAttr())]]),b.toCode(a,c,d)},b.timer=function(){return{_time:new Date,mark:function(a){var b=this._time,c=this._time=new Date;if(a)var d=c-b}}}})(gg,u),u.isDerivedAes=function(a){return a.indexOf("_")>-1},u.getBaseAes=function(a){var b=a.split("_",1),c=b[0];return c},function(a){"use strict",a.isNode=function(a){return typeof window.Node=="object"?a instanceof window.Node:a&&typeof a=="object"&&typeof a.nodeType=="number"&&typeof a.nodeName=="string"},a.isElement=function(a){return typeof window.HTMLElement=="object"?a instanceof window.HTMLElement:a&&typeof a=="object"&&a.nodeType===1&&typeof a.nodeName=="string"},a.isURL=function(a){var b=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return _.isString(a)&&b.test(a)}}(u),function(a){"use strict",a.Observer=function(){this.callbacks=[]},a.Observer.prototype.register=function(a,b,c){this.callbacks.push({key:a,callback:b,name:c})},a.Observer.prototype.remove=function(a){this.callbacks=_.reject(this.callbacks,function(b){return b.callback===a})},a.Observer.prototype.removeNamed=function(a){this.callbacks=_.reject(this.callbacks,function(b){return b.name===a})},a.Observer.prototype.removeKey=function(a){this.callbacks=_.reject(this.callbacks,function(b){return b.key===a})},a.Observer.prototype.trigger=function(a,b){_.chain(this.callback).filter(function(b){return b.key===a}).each(function(a){a.callback(b)})}}(u),function(){function d(){dom=$("#polychart-helper"),dom.length==0&&(helper=$("<div id='polychart-helper' class='polychart-ui bootstrap'></div>"),$("body").prepend(helper))}"use strict",Raphael.fn.gg_point=function(a){e++;var b=a._offsetX,c=a._offsetY,d=this.circle().attr("postProcess",function(d){var e=d.cx,f=d.cy;return d.cx=b+a.transX(e,f),d.cy=c+a.transY(e,f),d});return d=u.addMouseover(a,d),d},Raphael.fn.gg_symbol=function(a){e++;var b=a._offsetX,c=a._offsetY,d=this.path().attr("postProcess",function(d){var e=d.cx,f=d.cy,g=b+a.transX(e,f),h=c+a.transY(e,f),i=d.r,j=d.symbol;return d.path=gg.symbol.makePath(j,g,h,i),delete d.cx,delete d.cy,delete d.symbol,delete d.r,d});return d=u.addMouseover(a,d),d},Raphael.fn.gg_text=function(a){e++;var b=a._offsetX,c=a._offsetY,d=this.text().attr("postProcess",function(d){var e=d.x,f=d.y;return d.x=b+a.transX(e,f),d.y=c+a.transY(e,f),d.text||(d.text=" "),d});return d=u.addMouseover(a,d),d},Raphael.fn.gg_cart_line=function(a){e++;var b=a._offsetX,c=a._offsetY,d=this.path().attr("postProcess",function(d){var e,f,g,h;return g=c+a.transY(d.x1,d.y1),h=c+a.transY(d.x2,d.y2),e=b+a.transX(d.x1,d.y1),f=b+a.transX(d.x2,d.y2),delete d.x1,delete d.x2,delete d.y1,delete d.y2,d.path=[["M",e,g],["L",f,h]],d});return d=u.addMouseover(a,d),d},Raphael.fn.gg_cart_rect=function(a){e++;var b=a._offsetX,c=a._offsetY,d=this.rect().attr("postProcess",function(d){var e,f,g,h,i,j,k,l;return e=a.transX(d.x1,d.y1),f=a.transX(d.x2,d.y2),g=a.transY(d.x1,d.y1),h=a.transY(d.x2,d.y2),i=Math.min(e,f),k=Math.abs(f-e),j=Math.min(g,h),l=Math.abs(h-g),delete d.x1,delete d.x2,delete d.y1,delete d.y2,d.x=b+i,d.y=c+j,d.width=k,d.height=l,d});return d=u.addMouseover(a,d),d};var a=-Math.PI/2,b=2*Math.PI-1e-6,c=function(c,d,e,f,g,h,i){return function(j){var k,l,m,n;c?(k=h(j),l=i(j),m=f(j)+a,n=g(j)+a):(k=f(j),l=g(j),m=h(j)+a,n=i(j)+a);if(l<k){var o=k;k=l,l=o}var p=(n<m&&(p=m,m=n,n=p),n-m),q=p<Math.PI?0:1,r=Math.cos(m),s=Math.sin(m),t=Math.cos(n),u=Math.sin(n);return p>=b?k?[["M",d,e+l],["A",l,l,0,1,1,d,e-l],["A",l,l,0,1,1,d,e+l],["M",d,e+k],["A",k,k,0,1,0,d,e-k],["A",k,k,0,1,0,d,e+k],["Z"]]:l?[["M",d,e+l],["A",l,l,0,1,1,d,e-l],["A",l,l,0,1,1,d,e+l],["Z"]]:"":k?m==n?[["M",l*r+d,l*s+e],["L",k*t+d,k*u+e]]:[["M",l*r+d,l*s+e],["A",l,l,0,q,1,l*t+d,l*u+e],["L",k*t+d,k*u+e],["A",k,k,0,q,0,k*r+d,k*s+e],["Z"]]:l?m==n?[["M",l*r+d,l*s+e],["L",k*t+d,k*u+e]]:[["M",l*r+d,l*s+e],["A",l,l,0,q,1,l*t+d,l*u+e],["L",d,e],["Z"]]:""}};Raphael.fn.gg_polar_rect=function(a){e++;var b=a._offsetX,d=a._offsetY,f=a._flip,g=this.path().attr("preProcess",function(a){var e,g,h,i;return e=a.x1,g=a.x2,h=a.y1,i=a.y2,delete a.x1,delete a.x2,delete a.y1,delete a.y2,a.path=c(f,b,d,e,g,h,i),a});return g=u.addMouseover(a,g),g},Raphael.fn.gg_cart_vline=function(a){e++;var b=a._offsetX,c=a._offsetY,d=this.path().attr("postProcess",function(d){var e,f,g,h;return g=c+a.transY(d.x,d.y1),h=c+a.transY(d.x,d.y2),e=b+a.transX(d.x,d.y1),f=b+a.transX(d.x,d.y2),d.path=[["M",e,g],["L",f,h]],delete d.x,delete d.y1,delete d.y2,d});return d=u.addMouseover(a,d),d},Raphael.fn.gg_polar_vline=function(a){e++;var b=a._offsetX,d=a._offsetY,f=a._flip,g=this.path().attr("preProcess",function(a){var e,g,h,i;return e=g=a.x,h=a.y1,i=a.y2,delete a.x,delete a.y1,delete a.y2,a.path=c(f,b,d,e,g,h,i),a});return g=u.addMouseover(a,g),g},Raphael.fn.gg_cart_hline=function(a){e++;var b=a._offsetX,c=a._offsetY,d=this.path().attr("postProcess",function(d){var e,f,g,h;return g=c+a.transY(d.x1,d.y),h=c+a.transY(d.x2,d.y),e=b+a.transX(d.x1,d.y),f=b+a.transX(d.x2,d.y),d.path=[["M",e,g],["L",f,h]],delete d.x1,delete d.x2,delete d.y,d});return d=u.addMouseover(a,d),d},Raphael.fn.gg_polar_hline=function(a){e++;var b=a._offsetX,d=a._offsetY,f=a._flip,g=this.path().attr("preProcess",function(a){var e,g,h,i;return e=a.x1,g=a.x2,h=i=a.y,delete a.x1,delete a.x2,delete a.y,a.path=c(f,b,d,e,g,h,i),a});return g=u.addMouseover(a,g),g},u._path_function=function(a,b,c,d,e,f,g){var h=a._offsetX,i=a._offsetY,j=g.getObjects();f&&(j=_.sortBy(j,f));var k=_.map(j,b),l=_.map(j,c);d&&d(k,l);if(e){var m=e(k,l);k=m.x,l=m.y}var n=[],o=!0,p=k.length;for(var q=0;q<p;q++){var r=k[q],s=l[q];if(!_.isNumber(r)||!_.isNumber(s))continue;var t=a.transX(r,s),u=a.transY(r,s);if(!_.isNumber(t)||!_.isNumber(u))continue;o?(n.push(["M",t+h,u+i]),o=!1):n.push(["L",t+h,u+i])}return n},u._ensureFunction=function(a){for(var b in a){var c=a[b];typeof c!="function"&&(a[b]=u.constfunc(c))}},Raphael.fn.gg_path=function(a,b){e++;var c=this.path().attr("preProcess",function(c){var d=c._sort;delete c._sort;var e=c.x;delete c.x;var f=c.y;delete c.y;var g=c._pointModifier;return delete c._pointModifier,c.path=_.bind(u._path_function,null,a,e,f,g,b,d),c});return c=u.addMouseover(a,c),c},u.configRaphaelAttributes=function(a){var b=function(a,b){var c=this.attr("preProcess"),d=this.attr("postProcess");if(!a||!b)return{};if(b._style){b=_.clone(b);var e=b._style;b.stroke=e.stroke,b.fill=e.color,b["stroke-width"]=e.strokewidth,b["fill-opacity"]=e.opacity,delete b._style}u._ensureFunction(b),c&&(b=c(_.clone(b)));var f={};for(var g in b){var h=b[g];f[g]=h(a)}return d?d(f):f};a.ca.func=function(a){return b.call(this,this.attr("data"),a)},a.ca.data=function(a){return b.call(this,a,this.attr("func"))},a.ca.postProcess=function(a){},a.ca.preProcess=function(a){}},u.Raphael=Raphael.ninja(),u.addMouseover=function(a,b){if(!a.opts("mouseover_highlight"))return b;var c="_old_fill",d="_old_stroke";return b.mouseover(function(a){var e=b.attr("fill"),f=b.attr("stroke");e!="none"?(b.data(c,e),b.attr("fill",d3.rgb(e).darker().toString())):b.attr("stroke-width")>0&&(b.data(d,f),b.attr("stroke",d3.rgb(f).darker().toString())),b.attr("cursor","hand")}),b.mouseout(function(a){var e=b.attr("fill");b.attr("fill")!="none"?b.attr("fill",b.data(c)):b.attr("stroke-width")>0&&b.attr("stroke",b.data(d)),b.attr("cursor","normal")}),b},u.addTooltip=function(a,b){return b&&(a.mouseover(function(c){$(c.srcElement).tooltip({title:b(a.attr("data")),helper:$("body"),trigger:"manual",placement:"left"}).tooltip("show")}),a.mouseout(function(a){$(a.srcElement).tooltip("hide")})),a};var e=0,f=0;u.raphael_mark=function(a){var b=e-f;f=e,!a}}(),function(a){"use strict";var b=function(a,b){this.code=a,this.msg=b,this.toString=function(){return"Error Code #"+a+": "+b},console&&console.trace&&(this.stack=console.trace())};a.error=function(a,c){throw new b(a,c)},a.warn=function(a,c){console&&console.log(new b(a,c))},a.info=function(a){console&&console.log(a)}}(gg),function(a){"use strict",a.opts={},a.opts.graph={width:300,height:300,"padding-left":50,"padding-right":50,"padding-top":50,"padding-bottom":50,"legend-position":"right","legend-width":60,"legend-height":30,"spacing-x":20,"spacing-y":40,"facet-x":20,title:"","title-size":15,"title-bold":!0,"label-size":12,"label-bold":!1,"axis-y":"left","axis-y-line":null,"axis-y-label":null,"axis-y-ticks":null,"axis-y-ticklength":null,"axis-y-color":null,"axis-y-strokewidth":null,"axis-y-":null,"axis-x":"bottom","axis-x-line":null,"axis-x-label":null,"axis-x-ticks":null,"axis-x-ticklength":null,"axis-x-color":null,"axis-x-strokewidth":null,"grid-render-vertical":null,"grid-render-horizontal":null,"grid-stroke":null,"grid-strokewidth":null,"grid-dasharray":null,dom:null,filter:null,"render-make-default-scale":!0,"render-compute":!0,"render-impute-mapping":!0,tooltip:null},a.opts.aes=["color","fill","font","fontsize","group","opacity","radius","size","stats","stroke","strokewidth","symbol","text","x","y"],a.opts.mainFill="steelblue",a.opts.mainColor="black",a.opts.layer={x:1,y:1,color:a.opts.mainFill,opacity:.9,stroke:"#FFFFFF",strokewidth:0,facet:!0,radius:3,"render-max":400},a.opts.box={stroke:a.opts.mainColor,strokewidth:1,padding:0},a.opts.line={color:a.opts.mainColor,strokewidth:2,padding:.5},a.opts.text={opacity:1,color:"#000000",font:"Verdana",text:"text label"},a.opts.gradient={low:"#cccccc",high:"steelblue"},a.opts.grid={dasharray:"- ",dashoffset:5,stroke:"#CCC",strokewidth:1,"render-vertical":!1,"render-horizontal":!0},a.opts.axis={color:"#000",fontsize:11,labels:!0,strokewidth:1,"ticklength-x":3,"ticklength-y":7,ticks:!0},a.opts.axis_x={line:!0},a.opts.axis_y={line:!1},a.opts.coord={mouseover_highlight:!0},a.opts.epsilon=Math.pow(10,-7),a.opts.theme_bw=function(){}}(gg),function(a){"use strict",a.graph=u.makeClass("gg.graph"),a.graph.prototype.init=function(b){this._data=null,this._paper=null,this._filteredData=null,this._layers=[],this._scales={},this._coord=null,this._facet=null,this._attr=u.cloneobj(a.opts.graph),this._doms={},this._dimCache=null,this._rendered=!1,b&&this.data(b)};var b=function(){this._filterData()};a.graph.prototype.data=u.dataGetter({onChange:b}),a.graph.prototype.getFilteredData=function(){return this._filteredData},a.graph.prototype.getAttr=function(){var a={};return _.each(this._attr,function(b,c){if(_.isNull(b)||_.isUndefined(b)||b===-Infinity||b===Infinity||_.isFunction(b))return;if(u.isNode(b)){var d=b.getAttribute("id");d!==null&&(a[c]=d);return}a[c]=b}),a},a.graph.prototype._varlabel=function(a){var b=this.opts("label-"+a);if(!u.undef(b))return b;var c=_.chain(this._layers).map(function(b){return b.map(a)}).filter(u.identity).value();return c.length>0?c[0]:""},a.graph.prototype.getLayer=function(a){return this._layers[a]},a.graph.prototype.removeLayer=function(a){var b=this._layers.length;return this._layers=_.without(this._layers,a),b!==this._layers.length},a.graph.prototype.numLayers=function(){return this._layers.length},a.graph.prototype.getMapKeys=function(){return _.chain(this._layers).map(function(a){return _.keys(a.getMap())}).flatten().uniq().value()},a.graph.prototype.isMapped=function(a,b){return b?(a=u.getBaseAes(a),_.any(this._layers,function(b){return _.any(_.keys(b.getMap()),function(b){return u.getBaseAes(b)===a})})):_.any(_.invoke(this._layers,"map",a))},a.graph.prototype.defaultMin=function(a){if(this._layers.length===0)return null;var b=_.chain(this._layers).invoke("defaultMin",a).filter(_.isNumber).min().value();return b!=Infinity?b:null},a.graph.prototype.defaultMax=function(a){if(this._layers.length===0)return null;var b=_.chain(this._layers).invoke("defaultMax",a).filter(_.isNumber).max().value();return b!=-Infinity?b:null},a.graph.prototype.opts=u.opts(),a.graph.prototype.warn=function(b,c){a.warn(b,c)},a.graph.prototype._optsUpdate=function(a,b){this._rendered&&(a=="title"?this._update_label("_debug_title",b):a=="label-x"?this._update_label("_debug_x_label",b):a=="label-y"&&this._update_label("_debug_y_label",b)),a==="dom"&&this._clearCache()},a.graph.prototype.layer=function(b){b=u.instantiate(b),b||a.error(201,"Attempting to add an undefined or malformed layer: "+b);var c=u.cloneobj(b);return c.attach(this),this._layers.push(c),this},a.graph.prototype.coord=function(a){if(arguments.length===0)return this._coord;a=u.instantiate(a);var b=null;return b=u.cloneobj(a),b.attach(this),this._coord=b,this},a.graph.prototype.facet=function(b){if(arguments.length===0)return this._facet;if(b===null)this._facet=null;else{b=u.instantiate(b),b||a.error(201,"Attempting to add an undefined or malformed facet: "+b);var c=u.cloneobj(b);c.attach(this),this._facet=c}return this._clearCanvas(),this},a.graph.prototype._update_label=function(a,b){var c=this._doms[a];c&&c.attr("text",b)},a.graph.prototype.dimensions=function(){return this._dimCache||(this._dimCache=this._calculateDims()),this._dimCache},a.graph.prototype._calculateDims=function(){var a=_.keys(this._scales).length-2,b=this.opts("width")-this.opts("padding-left")-this.opts("padding-right"),c=this.opts("height")-this.opts("padding-top")-this.opts("padding-bottom");u.assertNumber(b),u.assertNumber(c);var d=this._facet?this._facet.ncol():1,e=this._facet?this._facet.nrow():1,f=d==1?0:this.opts("spacing-x"),g=e==1?0:this.opts("spacing-y"),h={ncol:d,nrow:e,chartWidth:b,chartHeight:c,eachWidth:(b-(d-1)*f)/d,eachHeight:(c-e*g)/e,spacingX:f,spacingY:g,additionalScales:a};return h},a.graph.prototype.getAxisOffset=function(a,b,c){var d=this.dimensions(),e=this.xposition(b),f=this.yposition(a),g=d.eachWidth,h=d.eachHeight,i=this.coord()._cls_name==="gg.coord.polar",j=this.coord()._flip!==i,k=j?"x":"y";return c=="right"?e+=g:c=="bottom"?f+=h:c=="center"?(e+=g/2,f+=h/2):c=="left"&&i&&(e-=9,f+=h/2-this._scales[k].range()[1]),{x:e-.5,y:f-.5}},a.graph.prototype.createOffsetCoord=function(b,c){var d=new a.coord.cart;return d.attach(this),d.opts("mouseover_highlight",!1),d.differentOffset(b,c)},a.graph.prototype.makeplot=function(b){var c=this.opts("width"),d=this.opts("height"),e,f;if(!b)a.error(212,"Invalid dom for .opts('dom') - "+b);else if(_.isString(b)){var g=b[0]=="#"?b.substring(1):b;f=document.getElementById(g),f||a.error(212,"Invalid dom for .opts('dom') - "+b)}else f=b;return e=u.Raphael(f,c,d),u.configRaphaelAttributes(e),this.render_branding(f),e},a.graph.prototype.setDefaultCoord=function(){return this._coord||this.coord(a.coord.cart()),this},a.graph.prototype.filter=function(a){return arguments.length===0?this.opts("filter"):(this.opts("filter",a),this._filterData(),this)},a.graph.prototype._filterData=function(){this.opts("filter")?this._filteredData=this.data().filter(this.opts("filter")):this._filteredData=this.data()},a.graph.prototype._clearCache=function(){this._paper=null,this._doms={},this._dimCache=null,this._rendered=!1},a.graph.prototype._clearCanvas=function(){this._paper&&this._paper.clear(),this._doms={},this._dimCache=null,this._rendered=!1},a.graph.prototype._preRender=function(a){this._debugStartTime=new Date,a&&this.opts("dom",a),this._paper?this._clearCanvas():this._paper=this.makeplot(this.opts("dom"))},a.graph.prototype._postRender=function(){var b=new Date,c=b-this._debugStartTime;this._rendered=!0,a.info("render() took "+c+" ms."),this._renderingTime=c},a.graph.prototype.xposition=function(a){var b=this.dimensions();return this.opts("padding-left")+a*(b.eachWidth+b.spacingX)},a.graph.prototype.yposition=function(a){var b=this.dimensions();return this.opts("padding-top")+a*(b.eachHeight+b.spacingY)+b.spacingY},a.graph.prototype._defaultComputeOptions=function(){return{defaultScale:this.opts("render-make-default-scale"),imputeMapping:this.opts("render-impute-mapping")}},a.graph.prototype.compute=function(a){a=a||this._defaultComputeOptions();var b=this;this._facet&&this._facet.prepare(),a.imputeMapping&&_.invoke(this._layers,"attachDerivedMappings"),_.invoke(this._layers,"resetCalculate"),_.invoke(this._layers,"calculate"),a.defaultScale&&_.each(this.makeDefaultScales(),function(a,c){b.scale(c,a)}),this.setDefaultCoord(),this.computeScale()},a.graph.prototype.render=function(a){this._preRender(a);var b=u.timer();u.raphael_mark(),this.opts("render-compute")&&(this.compute(),b.mark("compute()"),u.raphael_mark("compute()")),this.bindDerivedScales(),b.mark("bindDerivedScales()"),u.raphael_mark("bindDeriveScales()");var c=this.checkLayerError();return this.renderPrimary(c),b.mark("renderPrimary()"),u.raphael_mark("renderPrimary()"),this.renderAllFacetLabel(),b.mark("renderAllFacetLabel()"),u.raphael_mark("renderAllFacetLabel()"),this.renderOtherLabel(),b.mark("renderOtherLabel()"),u.raphael_mark("renderOtherLabel()"),this.renderLegend(),b.mark("renderLegend()"),u.raphael_mark("renderOtherLabel()"),this._postRender(),this},a.graph.prototype.checkLayerError=function(){var a={rawScales:this._scales,coord:this._coord};return _.invoke(this._layers,"checkErrors",a)},a.graph.prototype.toCode=function(a,b,c){var d=[];a||(a=0);var e=a+this._cls_name.length+3;c?d=[c]:this._data&&(d=[this._data.toCode(a,e)]);var f={cls:this._cls_name,params:d,funcs:[]};_.each(this._layers,function(b){f.funcs.push(["layer",b.toCode(a,e)])}),_.each(this._scales,function(b,c){if(b){var d=u.qt(c);f.funcs.push(["scale",[d,b.toCode(a,e+d.length+2)]])}}),this._coord&&f.funcs.push(["coord",this._coord.toCode(a,e)]),this._facet&&f.funcs.push(["facet",this._facet.toCode(a,e)]);var g=this.getAttr();return _.each(g,function(a,b){b.split("-")[0]=="render"&&delete g[b]}),f.funcs.push(["opts",JSON.stringify(g)]),u.toCode(a,b,f)}}(gg),function(a){"use strict",a.coord=a.coord||{},a.coord.base=u.makeClass("gg.coord.base"),a.coord.base.prototype.init=function(){this._graph=null,this._detached=!0,this._offsetX=0,this._offsetY=0,this._attr=_.clone(a.opts.coord)},a.coord.base.prototype.opts=u.opts(),a.coord.base.prototype.differentOffset=function(a,b){var c=u.cloneobj(this);return c._offsetX+=a,c._offsetY+=b,c._attr=u.cloneobj(this._attr),c},a.coord.base.prototype.attach=function(b){return this._detached||a.error(600,"This coordinate is already attached to a graph. Unexpected behaviour may occur."),this._detached=!1,this._graph=b,this},a.coord.base.prototype.getPaper=function(){return this._graph._paper},a.coord.base.prototype.set=function(a,b){return this.attr[a]=b,this},a.coord.base.prototype.configScale=function(b,c){a.error(10,"Not implemented.")},a.coord.base.prototype.transX=function(b,c){a.error(10,"Not implemented.")},a.coord.base.prototype.transY=function(b,c){a.error(10,"Not implemented.")},a.coord.base.prototype.drawAxis=function(b,c){a.error(10,"Not implemented.")},a.coord.base.prototype.line=function(){a.error(10,"Not implemented.")},a.coord.base.prototype.vline=function(){a.error(10,"Not implemented.")},a.coord.base.prototype.hline=function(){a.error(10,"Not implemented.")},a.coord.base.prototype.rect=function(){a.error(10,"Not implemented.")},a.coord.base.prototype.point=function(){var a=this.getPaper();return a.gg_point(this)},a.coord.base.prototype.poly=function(){var a=this.getPaper();return a.gg_path(this)},a.coord.base.prototype.text=function(){var a=this.getPaper();return a.gg_text(this)},a.coord.base.prototype.toCode=u.toCodeBasic}(gg),function(a){"use strict",a.facet=a.facet||{},a.facet.base=u.makeClass("gg.facet.base"),a.facet.base.prototype.init=function(){this._graph=null,this._detached=!0,this._attr={free_x:!1,free_y:!1}},a.facet.base.prototype.attach=function(a){this._detached||this.warn(700,"This facet is already attached to a graph. Unexpected behaviour may occur."),this._graph=a,this._detached=!1},a.facet.base.prototype.opts=u.opts(),a.facet.base.prototype.warn=function(b,c){this._detached?a.warn(b,c):this._graph.warn(b,c)},a.facet.base.prototype.getAttr=u.getAttr,a.facet.base.bin=function(b){a.error(10,"Not implemented.")},a.facet.base.prototype.ncol=function(){a.error(10,"Not implemented.")},a.facet.base.prototype.nrow=function(){a.error(10,"Not implemented.")},a.facet.base.prototype.isValidIndex=function(a){return!0},a.facet.base.prototype.renderLabel=function(b,c,d){a.error(10,"Not implemented.")},a.facet.base.prototype.toCode=u.toCodeBasic}(gg),function(a){"use strict",a.guide=a.guide||{},a.guide.base=u.makeClass("gg.guide.base"),a.guide.base.prototype.init=function(){this._attr={num_ticks:5}},a.guide.base.prototype.opts=u.opts()}(gg),function(a){"use strict";var b={};a.layer=a.layer||{},a.layer.base=u.makeClass("gg.layer.base");var c=function(a,b,c){_.isFunction(a)?(this.code=a,this.functionMapping=!0):this.name=a,this.defaultMapping=!!b};a.layer.base.prototype.init=function(b){this._attr=u.cloneobj(a.opts.layer),this._graph=null,this._data=null,this._facetedData=null,this._statData=null,this._stats=undefined,this._detached=!0,this._default_stats=a.stats.id,this._calculated=!1,b&&this.data(b)},a.layer.base.prototype.warn=function(b,c){this._detached?a.warn(b,c):this._graph.warn(b,c)},a.layer.base.prototype.opts=u.opts(),a.layer.base.prototype.data=function(c){if(arguments.length===0)return this._data===b?this._graph.getFilteredData():this._data;if(c===b)this._data=c;else{if(!c||c._cls_name!="gg.data")c=a.data(c);this._data=c}return this},a.layer.base.prototype.stats=function(b){if(arguments.length===1)return b=u.instantiate(b),b||a.error(304,"Attempting to add an undefined or malformed statistic: "+b),this._stats=b,this.resetCalculate(),this;if(_.isUndefined(this._stats)){var c=this._default_stats();this._stats=c}return this._stats},a.layer.base.prototype.attach=function(a){return this._detached||this.warn(300,"This layer is already attached to a graph. Unexpected behaviour may occur."),this.data()||this.data(b),this._detached=!1,this._graph=a,this},a.layer.base.prototype.resetCalculate=function(){this._calculated=!1},a.layer.base.prototype.defaultMin=function(a){return null},a.layer.base.prototype.defaultMax=function(a){return null},a.layer.base.prototype.requiredMap=function(){return null},a.layer.base.prototype.needDefined=function(){return["x","y"]},a.layer.base.prototype.calculateStats=function(a){var b=this.getMap(),c=this.getAttr(),d=_.chain(this.needDefined()).map(function(a){return b[a]}).filter(function(a){return a}).value();!this.hasGroup()&&b.group&&delete b.group;var e={mapping:b,attr:c,need:d,bin:this.allBin(),scales:this._graph._scales},f=this.stats().calculateStats(a,e);return f},a.layer.base.prototype.hasGroup=function(){return!0},a.layer.base.prototype.calculate=function(){this._detached&&this.warn(301,"Calculating statistics on a detached layer.");if(this._calculated)return;this.checkStatsRequiredMapping(),this.checkLayerRequiredMapping(),this.checkInvalidMapping(),this._facetedData=u.calculateFacet(this.data(),this._graph.facet());var a=_.bind(this.calculateStats,this);return this._statData=_.map(this._facetedData,a),this._calculated=!0,this},a.layer.base.prototype._map=function(a,b){this._attr[a]=new c(b)},a.layer.base.prototype.map=function(b,d){var e=this;arguments.length===0&&a.error(12,"Function map() called with less than 1 parameter.");if(arguments.length===1){if(!_.isString(b)&&_.keys(b).length>0)return _.each(_.keys(b),function(a){u.assertAes(a)}),_.each(b,function(a,b){e._map(b,a)}),this.resetCalculate(),this;u.assertAes(b);var f=this._attr[b];return f instanceof c?f.name:null}return u.assertAes(b),_.isUndefined(d)||d===null?this.unset(b):this._map(b,d),this.resetCalculate(),this},a.layer.base.prototype.isDefaultMap=function(a){var b=this._attr[a];return b instanceof c?b.defaultMapping:!1},a.layer.base.prototype.getAttr=function(){var a={};return _.each(this._attr,function(b,d){b instanceof c||(a[d]=b)}),a},a.layer.base.prototype.getMap=function(){var a={};return _.each(this._attr,function(b,d){b instanceof c&&(a[d]=b.name)}),a},a.layer.base.prototype.unset=function(b){return _.has(this._attr,b)&&delete this._attr[b],_.has(a.opts.layer,b)&&(this._attr[b]=a.opts.layer[b]),this},a.layer.base.prototype.getAestheticsGroup=function(a){var b=a+"_",c=this.getMap(),d={};return _.chain(c).keys().filter(function(c){return c==a||u.startswith(c,b)}).map(function(a){d[a]=c[a]}),d},a.layer.base.prototype.getData=function(a,b){if(!this.data())return null;var c=this.map(a);return c?this.data().get(c,b):null},a.layer.base.prototype.getScales=function(a){var b=a.rawScales,d,e={};return _.each(this._attr,function(f,g){if(f instanceof c){var h=b[g];h&&(e[g]=_.bind(h.apply,h,f.name))}else g=="x"||g=="y"?(d=b[g],a["free_"+g]&&d._type=="category"&&d.make(this._levels(g,null,a.facetId)),e[g]=u.constfunc(d.apply(f))):e[g]=u.constfunc(f)}),e},a.layer.base.prototype.renderEntry=function(a){this.calculate(),this.hasGroup()?a.computedData=this._statData[a.facetIndex]:a.computedData=this._statData[a.facetIndex][0],a.scales=this.getScales(a);var b=null;if(this._stats.number&&this.map("group_stats")){var c=a.rawScales.x._cls_name;if(c=="gg.scale.continuous"||c=="gg.scale.time"){var d=this.map("group_stats"),e=this.data(),f=e.min(d),g=e.max(d);b=a.rawScales.x.distance(f,g)/this._stats.number(),a.align="left"}}b===null&&(b=a.rawScales.x.width(),a.align="center"),a.width=b,a.computedData&&this.render(a)},a.layer.base.prototype.checkErrors=function(a){return _.keys(this.getMap()).length===0?(this.warn(320,"No mapping has been set in layer "+this._cls_name),!0):!1},a.layer.base.prototype.render=function(b){a.error(10,"Not implemented.")};var d=[],e="aes",f="key",g="aes_group",h="data";a.layer.base.prototype.queryData=function(b,c,d,i,j){if(c===h)return d(b,this.data());var k=this;this.calculate(),c=c||g,j=_.isNumber(j)?j:-1,j>k._statData.length&&a.error(-1,"Attempting to access facet id "+j+" when there are only "+k._statData.length);var l=j==-1?u.doubleMap:_.map,m=j==-1?k._statData:k._statData[j],n,o,p;if(c===g){o=_.values(this.getAestheticsGroup(b));var q=_.map(o,function(a){return l(m,_.bind(d,null,a))});p=u.concat(q)}else c===f?n=b:c===e?n=this.map(b):this.warn(-1,"Should not reach here."),p=l(m,_.bind(d,null,n));var r=u.concat(p);return i(r)},a.layer.base.prototype.min=function(b,c,d){var e=function(a,b){return b.min(a)},f=this.type(b,c),g=a.type.fromString(f).min;return this.queryData(b,c,e,g,d)},a.layer.base.prototype.max=function(b,c,d){var e=function(a,b){return b.max(a)},f=this.type(b,c),g=a.type.fromString(f).max;return this.queryData(b,c,e,g,d)},a.layer.base.prototype.levels=function(b,c,d){var e=function(a,b){return b.levels(a)},f=this.type(b,c),g=a.type.fromString(f),h=function(a){return u.mergeArrays(a,g.represent)};return this.queryData(b,c,e,h,d)},a.layer.base.prototype.type=function(a,b,c){var d=function(a,b){return b.type(a)},e=u.unionType;return this.queryData(a,b,d,e,c)},a.layer.base.prototype.checkStatsRequiredMapping=function(){var b=this.stats().requiredMap()||[],c=_.difference(b,_.keys(this.getMap()));c.length>0&&a.error(302,"Variable need to be mapped to the following aesthetics: "+c.join(", "))},a.layer.base.prototype.checkLayerRequiredMapping=function(){var b=this.stats().requiredMap()||[],c=_.difference(b,_.keys(this.getMap()));c.length>0&&a.error(302,"Variable need to be mapped to the following aesthetics: "+c.join(", "))},a.layer.base.prototype.getInvalidMapping=function(){var a=this,b=this.data().keys(),c=this.stats().keys(),d=_.union(b,c),e={};return _.each(this.getMap(),function(a,b){if(_.include(d,a))return;e[b]=a}),e},a.layer.base.prototype.checkInvalidMapping=function(){var b=this.getInvalidMapping();if(_.size(b)>0){var c=_.map(b,function(a,b){return"Mapping of aesthetics "+b+" to variable "+a+" is invalid."});a.error(303,c.join("\n"))}},a.layer.base.prototype.checkAllMapping=function(){this.checkStatsRequiredMapping(),this.checkInvalidMapping()},a.layer.base.prototype
.imputeMapping=function(a,b){var c={};if(!a||!b)return c;var d=function(b,d){a[b]=d,c[b]=d};return _.each(b,function(b,c){if(a[c])return;if(_.isArray(b))for(var e=0;e<b.length;e++){var f=b[e];if(a[f]){d(c,a[f]);return}}else a[b]&&d(c,a[b])}),c},a.layer.base.prototype._removePreviousDefaults=function(){var a=this;_.each(this._attr,function(b,d){b instanceof c&&b.defaultMapping&&delete a._attr[d]})},a.layer.base.prototype.bin=function(b,c,d){return a.group.binMaker(this,b,c,d)},a.layer.base.prototype.allBin=function(){var a=this,b={};return b},a.layer.base.prototype._attachImputed=function(a,b){var d=this._attr[a];!_.isUndefined(d)&&d instanceof c?d instanceof c&&d.defaultMapping&&(this._attr[a].value=b):this._attr[a]=new c(b,!0)},a.layer.base.prototype.attachDerivedMappings=function(){this._removePreviousDefaults();var a=this,b=this.stats(),c=this.getMap(),d=function(b,c){a._attachImputed(c,b)},e=this.imputeMapping(c),f=b?b.imputeMapping(c):{},g=_.defaults({},e,f);return _.each(g,d),g},a.layer.base.prototype.toCode=function(c,d){var e={cls:this._cls_name};if(this._data&&this._data!==b){var f=c+this._cls_name.length+3;e.params=[this._data.toCode(c,f)]}e.funcs=[["opts",JSON.stringify(this.getAttr())]];var g=this.getMap();return _.each(g,function(b,c){_.include(a.opts.aes,c.split("_")[0])||delete g[c]}),_.keys(g).length>0&&e.funcs.push(["map",JSON.stringify(g)]),this._stats&&e.funcs.push(["stats",this._stats.toCode()]),u.toCode(c,d,e)}}(gg),function(a){"use strict";var b=function(a,b,c){this.data=a,this.label=c,this.pos=b};a.scale=a.scale||{},a.scale.base=u.makeClass("gg.scale.base"),a.scale.base.prototype.init=function(){this._aes=null,this._graph=null,this._detached=!0,this._type=null,this._attr={pixel_per_tick_x:60,pixel_per_tick_y:30,ticks:null,numticks:null,min:null,max:null,absolute_min:-Infinity,absolute_max:Infinity,domain_low:null,domain_high:null,range_low:null,range_high:null},this._facetIndex=-1},a.scale.base.prototype.opts=u.opts(),a.scale.base.prototype.warn=function(b,c){this._detached?a.warn(b,c):this._graph.warn(b,c)},a.scale.base.prototype.CONTINUOUS=!1,a.scale.base.prototype.DISCRETE=!1,a.scale.base.prototype.getAttr=u.getAttr,a.scale.base.prototype.attach=function(b,c){this._detached||this.warn(400,"This scale is already attached to a graph. Unexpected behaviour may occur."),b||a.error(401,"Attempting to attach a scale to an empty graph."),c||a.error(402,"Scale type "+this._cls_name+" cannot to be attached to aesthetics "+c+"."),this._aes=c,this._graph=b,this._detached=!1},a.scale.base.prototype.min=function(a){var b=this._attr.absolute_min;return arguments.length===1?(_.isNumber(b)&&a<b&&(this.warn(403,"Minimum cannot be set below "+b+". Using "+b+" instead of "+a+"."),a=b),this._attr.min=a,this):this._attr.min},a.scale.base.prototype.max=function(a){var b=this._attr.absolute_max;return arguments.length===1?(_.isNumber(b)&&a>b&&(this.warn(403,"Maximum cannot be set above "+b+". Using "+b+" instead of "+a+"."),a=b),this._attr.max=a,this):this._attr.max},a.scale.base.prototype.rangeSize=function(){return Math.abs(this._attr.range_low-this._attr.range_high)},a.scale.base.prototype.type=function(){return this._type},a.scale.base.prototype._saneNumber=function(a){return _.isNumber(a)&&!isNaN(a)&&a!=Infinity&&a!=-Infinity},a.scale.base.prototype._makeDomain=function(){var a=this._aes,b=this._graph.min(a),c=this._graph.defaultMin(a),d=this._graph.max(a),e=this._graph.defaultMax(a);return this._attr.domain_low=_.chain([b,this._attr.min,c]).filter(_.isNumber).min().value(),this._attr.domain_high=_.chain([d,this._attr.max,e]).filter(_.isNumber).max().value(),[this._attr.domain_low,this._attr.domain_high]},a.scale.base.prototype.domain=function(a){return arguments.length===1?(this._attr.min=a[0],this._attr.max=a[1],this):[this._attr.min,this._attr.max]},a.scale.base.prototype.range=function(a){return arguments.length===1?(this._attr.range_low=a[0],this._attr.range_high=a[1],this):!_.isUndefined(this._attr.range_low)&&!_.isUndefined(this._attr.range_high)?[this._attr.range_low,this._attr.range_high]:null},a.scale.base.prototype.make=function(){a.error(10,"Not implemented.")},a.scale.base.prototype._apply=function(b){a.error(10,"Not implemented.")},a.scale.base.prototype.apply=function(a,b){arguments.length==1&&(b=a,a=undefined),b&&b._cls_name==="gg.data"&&(b=b.getObject(0));var c=_.isUndefined(a)||_.isUndefined(b[a])?b:b[a];return this._apply(c)},a.scale.base.prototype._tickObject=function(a,c,d){var e=new b(a,c,d);return e},a.scale.base.prototype._getNumticks=function(a,b){if(a)this.opts("numticks",a);else{a=this.opts("numticks");if(_.isNull(a)){var c=this.rangeSize();if(c==2*Math.PI)a=6;else{var d=this._aes=="x"==Boolean(b)?this.opts("pixel_per_tick_y"):this.opts("pixel_per_tick_x");a=c/d}this.opts("numticks",a)}}return Math.ceil(a)},a.scale.base.prototype.ticks=function(b){a.error(10,"Not implemented.")},a.scale.base.prototype.toCode=u.toCodeBasic}(gg),function(a){"use strict",a.stats=a.stats||{},a.stats.base=u.makeClass("gg.stats.base"),a.stats.base.prototype.init=function(){this._attr={}},a.stats.base.prototype.imputeMapping=function(a,b){var c={};if(!a||!b)return c;var d=function(b,d){a[b]=d,c[b]=d};return _.each(b,function(b,c){if(a[c])return;if(_.isArray(b))for(var e=0;e<b.length;e++){var f=b[e];if(a[f]){d(c,a[f]);return}}else a[b]&&d(c,a[b])}),c},a.stats.base.prototype.requiredMap=function(){return null},a.stats.base.prototype.compute=function(a,b){return a},a.stats.base.prototype.postProcess=function(a,b){return a},a.stats.base.prototype.calculateStats=function(a,b){return this.group(a,b)},a.stats.base.prototype.group=function(b,c){var d=this,e=c.mapping,f={},g=c.groupFunctions||{};c.need||(c.need=[]);var h=function(a){for(var b=0;b<c.need.length;b++)if(_.isNull(a[c.need[b]]))return!1;return!0};_.each(e,function(a,b){var c=u.getBaseAes(b);c=="group"&&(f[a]=g[b]||u.identity)});var i=b.group(f),j=_.map(i,function(a){return d.compute(a,c)}),k={},l=e.group;l&&f[l]&&(k[l]=f[l]);var m=a.data.group(j,k,h);return this.postProcess(m,c)},a.stats.base.prototype.createGroupFunction=function(b,c,d){b>=c&&a.error(900,"Cannot create a grouping function where min is "+b+" and max is "+c),d<=0&&a.error(901,"Cannot create a grouping function where number of bins is less than 1.");var e=c-b,f=e/d,g=function(c){var f=(c-b)/e,g=Math.floor(f*d);return g==d&&(g=d-1),b+g*e/d};return g.width=f,g},a.stats.base.prototype.createDateGroupFunction=function(b,c,d){var e=b.getTime(),f=c.getTime();e>=f&&a.error(900,"Cannot create a grouping function where min is "+e+" and max is "+f),d<=0&&a.error(901,"Cannot create a grouping function where number of bins is less than 1.");var g=f-e,h=g/d,i=function(b){var c=b.getTime(),f=(c-e)/g,h=Math.floor(f*d);return h==d&&(h=d-1),new Date(e+h*g/d)};return i.width=h,i},a.stats.base.prototype.keys=function(){return[]},a.stats.base.prototype.toCode=u.toCodeBasic}(gg),function(a){"use strict",a.type={};var b=null,c=function(){return{number:new a.type.number,category:new a.type.category,unknown:new a.type.unknown,date:new a.type.date}};a.type.fromString=function(d){b===null&&(b=c()),d||(d="unknown");var e=b[d];return e||a.error(800,"No such type "+d+"."),e},a.type.base=u.makeClass("gg.type.base"),a.type.base.prototype.min=function(b){a.error(10,"Not implemented.")},a.type.base.prototype.max=function(b){a.error(10,"Not implemented.")},a.type.base.prototype.ticks=function(){a.error(10,"Not implemented.")},a.type.base.prototype.coerce=function(b,c){a.error(10,"Not implemented.")},a.type.base.prototype.validate=function(b,c){a.error(10,"Not implemented.")},a.type.base.prototype.defaultScale=function(b){a.error(10,"Not implemented.")},a.type.base.prototype.represent=function(b){a.error(10,"Not implemented.")},a.type.base.prototype._postProcess=function(a,b){a=="opacity"?b.range([.2,.9]):a=="strokewidth"?b.range([0,5]):a=="radius"&&b.range([1,10])}}(gg),function(a){"use strict",a.coord.cart=u.makeClass("gg.coord.cart",a.coord.base),a.coord.cart.prototype.init=function(b){a.coord.base.prototype.init.call(this),this._flip=u.bool(b)},a.coord.cart.prototype.configScale=function(a,b){this._flip?(b.x.range([a.y,a.height]),b.y.range([a.x,a.width])):(b.x.range([a.x,a.width]),b.y.range([a.height,a.y]))},a.coord.cart.prototype.transX=function(a,b){return this._flip?b:a},a.coord.cart.prototype.transY=function(a,b){return this._flip?a:b},a.coord.cart.prototype.vline=function(){var a=this.getPaper();return a.gg_cart_vline(this)},a.coord.cart.prototype.hline=function(){var a=this.getPaper();return a.gg_cart_hline(this)},a.coord.cart.prototype.line=function(){var a=this.getPaper();return a.gg_cart_line(this)},a.coord.cart.prototype.rect=function(){var a=this.getPaper();return a.gg_cart_rect(this)},a.coord.cart.prototype.toCode=function(a,b){return u.toCode(a,b,{cls:this._cls_name,params:[this._flip.toString()]})}}(gg),function(a){"use strict",a.coord.polar=u.makeClass("gg.coord.polar",a.coord.base),a.coord.polar.prototype.init=function(b){a.coord.base.prototype.init.call(this),this._flip=u.bool(b),this._configured=!1},a.coord.polar.prototype.configScale=function(a,b){this._offsetX=a.x+a.width/2,this._offsetY=a.y+a.height/2;var c=1,d=Math.min(a.width,a.height)/2*c;this._flip?(b.y.range([0,d]),b.x.range([0,2*Math.PI]),b.x.opts("expand",0)):(b.x.range([0,d]),b.y.range([0,2*Math.PI]),b.y.opts("expand",0)),this._configured=!0},a.coord.polar.prototype.transX=function(b,c){return this._configured||a.error(605,"Attempting to use a coordinate that has not been configured."),this._flip?c*Math.cos(b-Math.PI/2):b*Math.cos(c-Math.PI/2)},a.coord.polar.prototype.transY=function(b,c){return this._configured||a.error(605,"Attempting to use a coordinate that has not been configured."),this._flip?c*Math.sin(b-Math.PI/2):b*Math.sin(c-Math.PI/2)},a.coord.polar.prototype.vline=function(){var a=this.getPaper();return a.gg_polar_vline(this)},a.coord.polar.prototype.hline=function(){var a=this.getPaper();return a.gg_polar_hline(this)},a.coord.polar.prototype.rect=function(){var a=this.getPaper();return a.gg_polar_rect(this)},a.coord.polar.prototype.toCode=function(a,b){return u.toCode(a,b,{cls:this._cls_name,params:[this._flip.toString()]})},a.coord.polar.prototype.poly=function(){var a=this.getPaper(),b=_.bind(this._smoother,this);return a.gg_path(this,b)},a.coord.polar.prototype._getRange=function(){return Math.PI*2},a.coord.polar.prototype._getTickSize=function(){return.01},a.coord.polar.prototype._smoother=function(a,b){var c=this._flip,d=a.length,e=0,f=!0,g,h,i,j,k=[],l=[],m=this._getRange(),n=this._getTickSize();for(e=0;e<d;e++){g=a[e],h=b[e];if(!_.isNumber(g)||!_.isNumber(h))continue;if(f)i=g,j=h,k.push(g),l.push(h),f=!1;else{var o,p,q,r,s;p=g-i,q=h-j,c?o=Math.floor(p/m/n):o=Math.floor(q/m/n);for(var t=1;t<o;t++){var u=t/o;s=u*q,r=u*p,k.push(i+r),l.push(j+s)}i=g,j=h,k.push(g),l.push(h)}}return{x:k,y:l}}}(gg),function(a){"use strict";var b=["min","max","levels"],c={hit:0,miss:0};a.data=u.makeClass("gg.data"),a.data._CACHE_STATS=c,a.data.fetch=function(b,c){d3.text(b,function(d){var e=null;if(b.substr(-4)==".csv")e=a.data(d);else{var f=JSON.parse(d);e=a.data(f)}c(e)})},a.data.group=function(b,c,d){d||(d=function(){return!0});var e;_.size(c)===0?e=function(){return""}:e=function(a){var b="";return _.each(c,function(c,d){b+=d+":"+c(a[d])+";"}),b};if(b.length===0)return[];var f=b[0].keys(),g={};return _.each(b,function(a){for(var b=0;b<a.len();b++){var c=a._internal[b];if(d(c)){var f=e(c);g[f]||(g[f]=[]),g[f].push(c)}}}),g=_.values(g),_.map(g,function(b){return a.data(b,f)})},a.data.prototype.fromObject=function(a,b){b=b?b:_.keys(a);var c=_.map(b,function(b){return a[b].length}),d=_.max(c),e=[];for(var f=0;f<d;f++){var g={};for(var h=0;h<b.length;h++){var i=b[h],j=a[i][f];typeof j=="undefined"&&(j=null),g[i]=f<c[h]?j:null}e.push(g)}this._unparsed=e,this._keys=b},a.data.prototype.fromArray=function(a,b){if(a.length===0){this._unparsed=[],b=b?b:[],this._keys=b;return}b=b?b:_.keys(a[0]);for(var c=1;c<a.length;c++)for(var d=0;d<b.length;d++)_.isUndefined(a[c][b[d]])&&(a[c][b[d]]=null);this._unparsed=a,this._keys=b},a.data.prototype.fromGrid=function(a,b,c){if(a.length===0){this._unparsed=[],b=b?b:[],this._keys=b;return}b=b?b:_.keys(a[0]);var d=b.length;this._unparsed=_.map(a,function(a){var c={};for(var e=0;e<d;e++)c[b[e]]=_.isUndefined(a[e])?null:a[e];return c}),this._keys=b},a.data.prototype.fromCSV=function(a,b){this._unparsed=d3.csv.parse(a),this._keys=_.keys(this._unparsed[0]);for(var c=0;c<this._unparsed.length;c++){var d=this._unparsed[c];_.each(this._keys,function(a){var b=parseFloat(d[a]);b==d[a]&&(d[a]=b)})}},a.data.prototype.constructData=function(a,b){var c=!1,d;_.isArray(b)?(d=b,b={}):b?(d=_.keys(b),b=b,c=!0):(d=undefined,b={}),_.isArray(a)?a.length>0&&_.isArray(a[0])?this.fromGrid(a,d,b):this.fromArray(a,d,b):_.isString(a)?this.fromCSV(a,d,b):this.fromObject(a,d,b),c?this._meta=b:this._meta=this.guessMeta()},a.data.prototype.guessMeta=function(){var a={},b=this;return _.each(this._keys,function(c){var d=b._guessType(c);a[c]={type:d}}),a},a.data.prototype.init=function(a,b){var c=this;this._unparsed=null,this._internal=null,this._keys=null,this._meta=null,this._cache=null,a?(this.constructData(a,b),this._guessParsers(),this._applyParsers()):(this._unparsed=[],this._internal=[],this._keys=[],this._meta={});var d=this._keys.length;this._clearCache()},a.data.prototype.clone=function(b){b=b||[];var c=new a.data;return c._keys=_.keys(this._meta),c._meta=_.clone(this._meta),c._internal=b,c},a.data.prototype.get=function(a,b){if(arguments.length>=2){var c=this._internal[b][a];return c}var d=_.pluck(this._internal,a);return d},a.data.prototype.getObject=function(a){var b,c,d={};for(b=0;b<this._keys.length;b++)c=this._keys[b],d[c]=this.get(c,a);return d},a.data.prototype.getObjects=function(){var a=[];for(var b=0;b<this.len();b++)a.push(this.getObject(b));return a},a.data.prototype.getBlock=function(){var a=[],b=this._internal,c,d=this._meta,e=function(a){var e=d[a].type;return e!=="date"?b[c][a]:+b[c][a]};for(c=0;c<this._internal.length;c++)a[c]=_.map(this._keys,e);return a},a.data.prototype.getTypeObj=function(b){return a.type.fromString(this.type(b))},a.data.prototype.toCode=function(a,b){return u.toCode(a,b,{cls:this._cls_name,params:[JSON.stringify(this.getBlock()),JSON.stringify(this._meta)]})},a.data.prototype.len=function(){return this._internal.length},a.data.prototype.indices=function(){return _.range(this.len())},a.data.prototype.keys=function(){return this._keys},a.data.prototype.metas=function(){return _.clone(this._meta)},a.data.prototype.getMeta=function(a){return this._meta[a]};var d=function(a){return a===null||typeof a=="undefined"};a.data.guessType=function(a){return _.all(a,_.isNumber)?"number":_.all(a,_.isDate)?"date":"category"},a.data.prototype._guessType=function(b){var c=_.pluck(this._unparsed,b);return a.data.guessType(_.reject(c,d))},a.data.prototype.type=function(a){var b=this._meta[a];return b?b.type:"unknown"},a.data.prototype.levels=function(a,b){return this._cached("levels",a,function(a){var b=this.getTypeObj(a),c=_.chain(this._internal).pluck(a).reject(_.isUndefined).sortBy(b.represent).uniq(!0,b.represent).value();return c},[])},a.data.prototype.min=function(a){return this._cached("min",a,function(a){var b=this.getTypeObj(a),c=b.validate,d=b.min;return this.query(a,d,c)},undefined)},a.data.prototype.max=function(a){return this._cached("max",a,function(a){var b=this.getTypeObj(a),c=b.validate,d=b.max;return this.query(a,d,c)},undefined)},a.data.prototype.query=function(a,b,c){return b(_.filter(this.get(a),c))},a.data.prototype.remove=function(a){var b=_.indexOf(this._keys,a);if(b===-1)return!1;this._keys.splice(b,1),delete this._meta[a];var c,d=this._internal.length;for(c=0;c<d;c++){var e=this._internal[c];delete e[a]}return!0},a.data.prototype.derive=function(b,c,d,e){arguments.length===1&&(c=_.uniqueId("var_")),d||(d=a.derive);try{var f,g;if(_.isFunction(b))f=b,g=!1;else{var h=b;if(b==="")var h='""';f=new Function("d","with(this) { with(d) { return "+h+";}}"),g=!0}var i=this.len(),j=[];for(var k=0;k<i;k++){var l=this._internal[k],m=f.call(d,l);_.isFunction(m)&&a.error(121,"invalud return value"),j.push(m);if(e){if(k>10)break}else l[c]=f.call(d,l)}return e?{success:!0,values:j}:(_.include(this._keys,c)||this._keys.push(c),this._meta[c]={type:this._guessType(j),derived:!0},g&&(this._meta[c].formula=b),c)}catch(n){return e?{success:!1,error:n}:(a.warn(121,"Error while generating derived variable "+c+": "+n.toString()),!1)}},a.data.prototype.checkRename=function(a,b){var c=_.indexOf(this._keys,a),d=_.indexOf(this._keys,b);return b?c===-1?!1:d!==-1?!1:!0:!1},a.data.prototype.rename=function(a,b){a=a.toString(),b=b.toString();if(!this.checkRename(a,b))return!1;var c=_.indexOf(this._keys,a);return _.each(this._internal,function(c){c[b]=c[a],delete c[a]}),this._keys[c]=b,this._meta[b]=this._meta[a],delete this._meta[a],!0},a.data.prototype.push=function(b){var c,d;for(c=0;c<this._keys.length;c++)d=this._keys[c],_.has(b,d)||a.warn(101,"Data is missing key "+d+".");return this._internal.push(b),this},a.data.prototype.iterator=function(a){var b=this,c={};return c.i=0,c.next=function(){var d=b.len();while(c.i<d&&!a(b._internal[c.i]))c.i++;return c.i==d?!1:b._internal[c.i++]},c},a.data.prototype.filter=function(b){var c=[];b=a.data.makeFilterFunction(b);try{_.each(this._internal,function(a){b(a)&&c.push(a)})}catch(d){a.error(122,"Error while filtering data: "+d.toString())}return this.clone(c)},a.data.prototype.sort=function(a,b){var c=this.getTypeObj(a),d=_.sortBy(this._internal,function(d){var e=c.represent(d[a]);return b?-e:e});return this.clone(d)},a.data.prototype.group=function(b){return a.data.group([this],b)},a.data.prototype.merge=function(b){return _.isEqual(this.keys(),b.keys())||a.error(110,"Cannot merge two datasets with unequal keys."),this._internal=this._internal.concat(b._internal),this},a.data.prototype.each=function(a,b){if(!b||b>this.len())return _.each(this._internal,a);var c=_.shuffle(this._internal);return _.each(c.slice(0,b),a)},a.data.prototype._cached=function(a,b,d,e){var f;if(_.isFunction(b)){var g=b;g._data_key||(g._data_key=_.uniqueId("var_"),this.derive(g,g._data_key)),f=b._data_key}else f=b;var h=_.indexOf(this._keys,f);if(h===-1)return e;if(_.has(this._cache[a],f)){var i=this._cache[a][f];return c.hit++,i}c.miss++;var j=d.call(this,f);return this._cache[a][f]=j,j},a.data.prototype._clearCache=function(){this._cache={};var a=this._cache,c=this._keys.length;_.each(b,function(b){a[b]={}})},a.data.prototype.parser=function(a,b){return arguments.length===1?this._meta[a].parser:(this._meta[a].parser=b,this)},a.data.prototype._guessParsers=function(){var b=this;_.each(this._keys,function(c){var d=b._meta[c];if(b.parser(c))return;if(d.type=="number")return;if(d.type=="date"&&d.format){var e=b._meta[c].format;d.parser=a.data.makeDateParser(e)}else{var f=_.pluck(b._unparsed,c),e=a.data.guessDateFormat(f);e&&(d.type="date",d.parser=a.data.makeDateParser(e),d.format=e)}})},a.data.prototype._applyParsers=function(){var a=this,b=this.keys();this._internal=_.map(this._unparsed,function(c){var d={},e=0;for(e=0;e<b.length;e++){var f=b[e],g=a._meta[f],h=g.parser,i=c[f],j;if(h)try{j=h(i)}catch(k){j=null}else j=i;d[f]=j}return d})};var e="%Y-%m-%d %H:%M:%S",f=[e,"%c","%m-%d-%Y","%Y-%m-%d","%m/%d/%Y","%Y/%m/%d","%m%d%Y","%d%m%Y","%Y"];a.data.guessDateFormat=function(b){var c=b[0]||"",d=_.find(f,function(b){return _.isString(c)?a.date.parseDate(b,c)!==null:!1});return d},a.data.makeDateParser=function(a){var b=d3.time.format(a);return function(a){if(_.isNumber(a))return new Date(a);var c;return c=b.parse(a),c}},a.data.makeFilterFunction=function(a){return _.isFunction(a)?a:_.isString(a)?new Function("d","with(d) { return "+a+";}"):function(){return!0}}}(gg),function(){"use strict",gg.date={},gg.date.parseDate=function(a,b){return b?d3.time.format(a).parse(b):null},gg.date.formatDate=function(a,b){return b?d3.time.format(a)(b):""}}(),function(a){"use strict",a.derive={},a.derive.year=function(a){return a.getFullYear()},a.derive.month=function(a){return a.getMonth()+1},a.derive.day=function(a){return a.getDate()},a.derive.has=function(a,b){return a.indexOf(b)>-1},a.derive.len=function(a){return _.isString(a)?a.length:0}}(gg),function(a){"use strict",a.facet.grid=u.makeClass("gg.facet.grid",a.facet.base),a.facet.grid.prototype.init=function(b,c){a.facet.base.prototype.init.call(this),this.opts("x",b),this.opts("y",c),this.opts("auto",!0)},a.facet.grid.prototype.x=u.singleOpts("x"),a.facet.grid.prototype.y=u.singleOpts("y"),a.facet.grid.prototype.ncol=function(a){return arguments.length===0?this.opts("col"):(u.assertNumber(a),this.opts("col",a),this.opts("auto",!1),this)},a.facet.grid.prototype.nrow=function(a){return arguments.length===0?this.opts("row"):(u.assertNumber(a),this.opts("row",a),this.opts("auto",!1),this)},a.facet.grid.prototype.bin=function(a){var b=this._func_x.index(a[this._key_x]),c=this._func_y.index(a[this._key_y]);return c*this._ncol+b},a.facet.grid.prototype.prepare=function(){var a=this.x(),b=this.y(),c,d,e=this._graph,f=function(a){var b=e.type(a,"data");if(b=="category")return Math.min(10,e.levels(a,"data").length);if(b=="number")return 3};return this.opts("auto")?(d=f(a),c=f(b),this.nrow(c),this.ncol(d)):(d=this.ncol(),c=this.nrow()),this._ncol=d,this._nrow=c,this._key_x=a,this._key_y=b,this._func_x=this._graph.bin(a,d,!0),this._func_y=this._graph.bin(b,c,!0),this},a.facet.grid.prototype.renderLabel=function(a,b){var c="FOOZLE";this.x()&&b.row===0&&(c=this._func_x.label(b.col),a.text().attr("font-size",12).attr("font-weight","bold").attr("text-anchor","center").attr("text",c).attr("x",b.xpos+b.eachWidth/2).attr("y",b.ypos-10)),this.y()&&b.col===this.opts("col")-1&&(c=this._func_y.label(b.row),a.text().attr("font-size",12).attr("font-weight","bold").attr("text-anchor","center").attr("text",c).attr("x",b.width+10).attr("y",b.ypos+b.eachHeight/2).transform("r90"))}}(gg),function(a){"use strict",a.facet.wrap=u.makeClass("gg.facet.wrap",a.facet.base),a.facet.wrap.prototype.init=function(b){a.facet.base.prototype.init.call(this),this.opts("x",b),this.opts("col",null),this.opts("row",null),this._func=null,this._key=null},a.facet.wrap.prototype.x=u.singleOpts("x"),a.facet.wrap.prototype.ncol=function(a){return arguments.length===0?this.opts("col"):(u.assertNumber(a),this.opts("col",a),this)},a.facet.wrap.prototype.nrow=function(a){return arguments.length===0?this.opts("row"):(u.assertNumber(a),this.opts("row",a),this)},a.facet.wrap.prototype.sanity=function(){var a=this.levels();return a.length>0&&a.length<this.opts("col")?this.ncol(a.length):this.ncol(this.opts("col")),this},a.facet.wrap.prototype.isValidIndex=function(a){return a<this._graph.levels(this.x(),"data").length},a.facet.wrap.prototype.bin=function(a){return this._func.index(a[this._key])},a.facet.wrap.prototype.prepare=function(){var a=this.x(),b=this._graph.type(a,"data"),c=b=="category"?this._graph.levels(a,"data").length:9,d,e;return this.opts("col")?(d=this.opts("col")||3,e=this.opts("row")||Math.ceil(c/d)):(e=this.opts("row")||2,d=this.opts("col")||Math.ceil(c/e)),this.opts("col",d),this.opts("row",e),this._func=this._graph.bin(a,d*e,!0),this._key=a,this},a.facet.wrap.prototype.renderLabel=function(a,b){var c=b.row*this.ncol()+b.col,d=this._func.label(c);if(d===null)return null;var e=a.text().attr("font-size",12).attr("font-weight","bold").attr("text",d);return this.opts("col")==1?e.attr("x",b.width+10).attr("y",b.ypos+b.eachHeight/2).transform("r90"):e.attr("x",b.xpos+b.eachWidth/2).attr("y",b.ypos-10),this}}(gg),function(){"use strict",gg.graph.prototype.bin=function(a,b,c){return gg.group.binMaker(this,a,b,c)}}(),function(a){"use strict",a.graph.prototype.type=function(a,b,c){if(this._layers.length===0&&b=="data")return this.data().type(a);var d=_.invoke(this._layers,"type",a,b,c);return u.unionType(d)},a.graph.prototype.min=function(b,c,d){if(this._layers.length===0&&c=="data")return this.data().min(b);var e=_.invoke(this._layers,"min",b,c,d),f=this.type(b,c),g=a.type.fromString(f);return g.min(e)},a.graph.prototype.max=function(b,c,d){if(this._layers.length===0&&c=="data")return this.data().max(b);var e=_.invoke(this._layers,"max",b,c,d),f=this.type(b,c),g=a.type.fromString(f);return g.max(e)},a.graph.prototype.levels=function(b,c,d){if(this._layers.length===0&&c=="data")return this.data().levels(b);var e=_.invoke(this._layers,"levels",b,c,d),f=this.type(b,c),g=a.type.fromString(f);return u.mergeArrays(e,g.represent)}}(gg),function(a){"use strict",a.graph.prototype._setupGrid=function(){var b=this.coord(),c=this._scales,d=a.guide.grid(c.x,c.y);return b._cls_name==="gg.coord.polar"&&d.opts("render-vertical",!0),_.each(this._attr,function(a,b){b.substr(0,5)=="grid-"&&!_.isNull(a)&&d.opts(b.substr(5),a)}),d},a.graph.prototype._setupAxes=function(){var b=this.coord(),c=this._scales,d=b._flip!==(b._cls_name==="gg.coord.polar"),e=d?"y":"x",f=d?"x":"y",g=a.guide.axis(this._scales[e],"x",b),h=a.guide.axis(this._scales[f],"y",b);return b._cls_name==="gg.coord.polar"&&h.opts("line",!0),_.each(this._attr,function(a,b){var c=b.substr(0,7);c=="axis-x-"&&!_.isNull(a)?g.opts(b.substr(7),a):c=="axis-y-"&&!_.isNull(a)?h.opts(b.substr(7),a):c.substr(0,5)=="axis-"&&(g.opts(b.substr(5),a),h.opts(b.substr(5),a))}),{x:g,y:h,flip:d}},a.graph.prototype._renderAxis=function(a,b){var c=this,d=this._paper,e=this.coord(),f,g=a.flip?"y":"x",h=a.flip?"x":"y",i,j=this.opts("axis-y");if(j=="left"&&b.col===0||j=="right"&&b.col===b.ncol-1||b.free_y)i=this.getAxisOffset(b.row,b.col,j),f={position:j,coord:e,canvas:c.createOffsetCoord(i.x,i.y)},a.y.renderLinear(f);j=this.opts("axis-x"),j!="none"&&(e._cls_name==="gg.coord.polar"?(i=this.getAxisOffset(b.row,b.col,"circular"),f={position:"circular",coord:e.differentOffset(b.xpos,b.ypos),radius:this._scales[h].range()[1],canvas:c.createOffsetCoord(i.x,i.y)},a.x.renderCircular(f)):(i=this.getAxisOffset(b.row,b.col,j),f={position:j,coord:e,canvas:c.createOffsetCoord(i.x,i.y)},j=="bottom"&&b.row==b.nrow-1||j=="top"&&b.row===0||b.free_x?a.x.renderLinear(f):a.x.renderLinear(f,{labels:!1})))},a.graph.prototype.renderPrimary=function(a){var b=this.dimensions(),c=this._facet,d=b.ncol,e=b.nrow,f=0,g,h,i=this.coord(),j=this,k=this._setupGrid(),l=this._setupAxes(),m=this._scales,n=c?c.opts("free_x"):!1,o=c?c.opts("free_y"):!1,p=function(a,b){m[a].make(b),k.opts(a+"scale",m[a]);var c=l.flip==(a=="x")?"y":"x";l[c].scale(m[a])};for(var q=0;q<e;q++)for(var r=0;r<d;r++){if(c&&!c.isValidIndex(f))break;g=this.xposition(r),h=this.yposition(q),n&&p("x",f),o&&p("y",f);var s=i.differentOffset(g,h).opts("mouseover_highlight",!1);k.render(s);for(var t=0;t<this._layers.length;t++){if(a&&a[t])continue;this.renderLayer(this.getLayer(t),g,h,m,f)}this._renderAxis(l,{col:r,row:q,ncol:d,nrow:e,xpos:g,ypos:h,free_x:n,free_y:o}),f++}},a.graph.prototype.renderLayer=function(a,b,c,d,e){var f={rawScales:d,coord:this._coord.differentOffset(b,c),facetIndex:e};a.renderEntry(f)},a.graph.prototype.renderAllFacetLabel=function(){var a=this.dimensions(),b=a.ncol,c=a.nrow,d=a.spacingY;if(!(c>1||b>1))return;var e={eachWidth:a.eachWidth,width:a.chartWidth+this.opts("padding-left"),eachHeight:a.eachHeight};for(var f=0;f<c;f++)for(var g=0;g<b;g++){e.row=f,e.col=g,e.ypos=this.yposition(f),e.xpos=this.xposition(g);var h=this._facet.renderLabel(this._paper,e)}},a.graph.prototype.renderLegend=function(){var b=this.opts("legend-position");if(b=="none")return;var c=this.dimensions(),d=c.chartWidth,e=c.chartHeight,f,g;b=="left"||b=="right"?(g=this.opts("padding-top"),f=10,b=="right"&&(f+=this.opts("padding-left")+d+10)):b=="bottom"?(g=e+this.opts("padding-top")+45,f=this.opts("padding-left")):a.error(1e3,"Leged position should be left, right, bottom or none. Got "+b+" instead.");var h={canvas:this.createOffsetCoord(f,g),position:b,chartWidth:d,chartHeight:e};a.guide.legend(this,this._layers,this._scales).render(h)},a.graph.prototype.renderOtherLabel=function(){var a=this.dimensions(),b=a.chartWidth,c=a.chartHeight;this._coord._name!=="polar"&&(this.render_y_label(),this.render_x_label()),this.render_title()},a.graph.prototype.render_label=function(a,b,c,d){var e=this._paper.text(b,c,a).attr("class",d);return this._doms[d]=e,e},a.graph.prototype.render_title=function(){var a=this.opts("width")/2,b=this.opts("padding-top")*.7;this.render_label(this.opts("title"),a,b,"_debug_title").attr("font-weight",this.opts("title-bold")?"bold":"normal").attr("font-size",this.opts("title-size"))},a.graph.prototype.render_x_label=function(){var a=this.dimensions(),b=a.chartWidth,c=a.chartHeight,d=this.opts("padding-left")+b/2,e=this.opts("padding-top")+c+30,f=this._coord._flip?"y":"x";this.render_label(this._varlabel(f),d,e,"_debug_x_label").attr("font-weight",this.opts("label-bold")?"bold":"normal").attr("font-size",this.opts("label-size"))},a.graph.prototype.render_y_label=function(){var a=this.dimensions(),b=a.chartHeight,c=Math.max(this.opts("padding-left")*.35,this.opts("padding-left")-40),d=this.opts("padding-top")+b/2,e=this._coord._flip?"x":"y";this.render_label(this._varlabel(e),c,d,"_debug_y_label").transform("r270").attr("font-weight",this.opts("label-bold")?"bold":"normal").attr("font-size",this.opts("label-size"))},a.graph.prototype.render_branding=function(a){a.setAttribute("style","position:relative");var b=document.createElement("img");b.setAttribute("src","/s/resources/branding.png"),b.setAttribute("style","position:relative; top:-2px");var c=document.createElement("a");c.appendChild(document.createTextNode("Made with ")),c.appendChild(b),c.setAttribute("href","http://www.polychart.com"),c.setAttribute("target","_blank"),c.setAttribute("style","position:absolute; bottom:2px; left:20px; color: #BBB"),a.appendChild(c)}}(gg),"use strict",gg.graph.prototype.getScaleKeys=function(){return _.keys(this._scales)},gg.graph.prototype.removeScale=function(a){return _.has(this._scales,a)?(delete this._scales[a],!0):!1},gg.graph.prototype.removeAllScales=function(){this._scales={}},gg.graph.prototype.getScale=function(a){return this._scales[a]},gg.graph.prototype.scale=function(a,b){u.assertAes(a),b=u.instantiate(b),b||gg.error(201,"Attempting to add an undefined or malformed scale: "+b);var c=u.cloneobj(b);return c.attach(this,a),this._scales[a]=c,this},gg.graph.prototype.resetScale=function(a){var b=this.makeDefaultScales([a]),c=b[a];return c?(this.scale(a,c),this.computeScale(),!0):!1},gg.graph.prototype.makeDefaultScales=function(a){var b=this,c=this._scales;a||(a=_.chain(this._layers).map(function(a){return _.keys(a.getMap())}).flatten().push("x").push("y").uniq().filter(function(a){if(u.isDerivedAes(a))return!1;var b=u.getBaseAes(a);return b=="group"?!1:!0}).reject(function(a){return _.has(c,a)}).value());var d={};return _.each(a,function(a){var c=b.type(a);if(!c)return;var e=gg.type.fromString(c),f=e.defaultScale(a);d[a]=f}),!this._scales.x&&!d.x&&_.contains(a,"x")&&(d.x=gg.scale.continuous()),!this._scales.y&&!d.y&&_.contains(a,"y")&&(d.y=gg.scale.continuous()),d},gg.graph.prototype.bindDerivedScales=function(){var a=this._scales,b=this.getMapKeys();_.each(b,function(b){u.isDerivedAes(b)&&(a[b]=a[u.getBaseAes(b)])})},gg.graph.prototype.computeScale=function(){var a=this._scales,b=this.dimensions();this._coord.configScale({x:0,y:0,width:b.eachWidth,height:b.eachHeight},a),_.each(a,function(a,b){u.isDerivedAes(b)||a.make()})},gg.group={},gg.group.niceBinFunction=function(a,b,c){var d=b-a,e=Math.pow(10,Math.floor(Math.log(d/c)/Math.LN10)),f=c/d*e;f<=.15?e*=10:f<=.35?e*=5:f<=.75&&(e*=2);var g=[],h=Math.ceil(a/e)*e;return function(a){var b=Math.floor((a-h)/e);return h+b*e}},gg.group.rawBinFunction=function(a,b,c){var d=function(a,b){return Math.round(a*b)/b},e=b-a,f=e/c,g=function(b){var d=(b-a)/e,f=Math.floor(d*c);return f>=c&&(f=c-1),f<0&&(f=0),f},h=function(d){return a+g(d)*e/c},i=function(b){var f=a+b*e/c,g=a+(b+1)*e/c;return d(f,100)+" ~ "+d(g,100)};return h.index=g,h.label=i,h},gg.group.dateBinFunction=function(a,b,c){var d=a.getTime(),e=b.getTime();d>=e&&gg.error(900,"Cannot create a grouping function where min is "+d+" and max is "+e),c<=0&&gg.error(901,"Cannot create a grouping function where number of bins is less than 1.");var f=e-d,g=f/c,h=function(b){var e=b.getTime(),g=(e-d)/f,h=Math.floor(g*c);return h==c&&(h=c-1),new Date(d+h*f/c)};return h.width=g,h},gg.group.binMaker=function(a,b,c,d){d=d||!0,c=c||10;var e,f,g=a.type(b,"data");if(g==="number")return e=a.min(b,"data"),f=a.max(b,"data"),d?gg.group.rawBinFunction(e,f,c):null;if(g=="category"){var h=a.levels(b,"data"),i=function(a){};return i.index=function(a){var b=_.indexOf(h,a);return b%c},i.label=function(a){return a>=h.length?
null:h[a%c]},i}return g=="date"?(e=a.min(b,"data"),f=a.max(b,"data"),gg.group.dateBinFunction(e,f,c)):null},function(a){"use strict",a.guide.axis=u.makeClass("gg.guide.axis",a.guide.base),a.guide.axis.prototype.init=function(b,c,d){a.guide.base.prototype.init.call(this),this._type=c||b._aes,this._type!="x"&&this._type!="y"&&a.error(500,"Axis can only be created from x- or y- aesthetics, got "+this._type+" instead."),this._scale=b,this._coord=d,this._flip=c=="y"&&d._cls_name=="gg.coord.polar",this._attr=u.cloneobj(a.opts.axis),this._type=="x"?_.extend(this._attr,a.opts.axis_x):this._type=="y"&&_.extend(this._attr,a.opts.axis_y)},a.guide.axis.prototype.scale=function(a){return this._scale=a,this},a.guide.axis.prototype.renderLinear=function(b,c){var d=b.canvas,e=b.position,f=e=="top"||e=="bottom",g=e=="left"||e=="right",h=f?"middle":e=="left"?"end":"start",i=f?0:e=="left"?-10:10,j=g?0:e=="top"?-5:15,k=f?this.opts("ticklength-x"):this.opts("ticklength-y"),l=this.opts("fontsize"),m=this.opts("color"),n=this.opts("strokewidth");c||(c={line:!0,ticks:!0,labels:!0}),!f&&!g&&a.error(501,"Position should be 'top', 'bottom', 'left', or 'right'. Got "+e+" instead."),f&&this._type!="x"&&a.error(501,"Position should be 'top' or 'bottom'. Got "+e+" instead."),g&&this._type!="y"&&a.error(501,"Position should be 'left', or 'right'. Got "+e+" instead.");var o=[0,0],p=[0,0];f?o=this._scale.range():p=this._scale.range(),this.opts("line")&&c.line!==!1&&d.line().attr("func",{x1:o[0],x2:o[1],y1:p[0],y2:p[1],stroke:m,"stroke-width":n}).attr("data",{});var q=this._scale.ticks(null,this._flip);if(this._flip){var r=_.max(this._scale.range());_.each(q,function(a){a.pos=r-a.pos})}this.opts("ticks")&&c.ticks!==!1&&_.each(q,function(a){d.line().attr("func",{x1:function(a){return f?a.pos:0},x2:function(a){return f?a.pos:e=="left"?-k:k},y1:function(a){return g?a.pos:0},y2:function(a){return g?a.pos:e=="top"?-k:k},stroke:m,"stroke-width":n}).attr("data",a)}),this.opts("labels")&&c.labels!==!1&&_.each(q,function(a){d.text().attr("func",{x:function(a){return f?a.pos:i},y:function(a){return g?a.pos:j},text:function(a){return String(a.label)},"font-size":l,"font-color":m,"text-anchor":h}).attr("data",a)})},a.guide.axis.prototype.renderCircular=function(a,b){var c=a.coord,d=a.radius,e=this.opts("ticklength-y"),f=this.opts("fontsize"),g=this.opts("color"),h=this.opts("strokewidth");b=b||{line:!0,ticks:!0,labels:!0};var i,j,k,l,m,n,o,p;c._flip?(i=_.bind(c.vline,c),j=_.bind(c.hline,c),k="y",l="x",m="y1",n="y2",o="x1",p="x2"):(i=_.bind(c.hline,c),j=_.bind(c.vline,c),k="x",l="y",m="x1",n="x2",o="y1",p="y2");if(this.opts("line")&&b.line!==!1){var q={stroke:g,"stroke-width":h};q[k]=u.constfunc(d),q[o]=u.constfunc(0),q[p]=u.constfunc(360),j().attr("func",q).attr("data",{})}var r=this._scale.ticks(null);if(this.opts("ticks")&&b.ticks!==!1){var q={"class":"labeltick",stroke:g,"stroke-width":h};q[m]=u.constfunc(d),q[n]=u.constfunc(d+e),q[l]=function(a){return a.pos},_.each(r,function(a){i().attr("func",q).attr("data",a)})}if(this.opts("labels")&&b.labels!==!1){var q={text:function(a){return a.label},"font-size":u.constfunc(f),"text-anchor":u.constfunc("middle"),"font-color":u.constfunc(g)};q[k]=u.constfunc(d+e+2),q[l]=function(a){return a.pos},_.each(r,function(a){c.text().attr("func",q).attr("data",a)})}}}(gg),function(a){"use strict",a.guide.grid=u.makeClass("gg.guide.grid",a.guide.base),a.guide.grid.prototype.init=function(b,c){a.guide.base.prototype.init.call(this),this._attr=u.cloneobj(a.opts.grid),this.opts("xscale",b),this.opts("yscale",c)},a.guide.grid.prototype.render=function(a){var b=this,c=a._flip!==(a._cls_name==="gg.coord.polar"),d=this.opts("xscale"),e=d.range(),f=_.min(e),g=_.max(e),h=d.ticks(null,c),i=this.opts("yscale"),j=i.range(),k=_.min(j),l=_.max(j),m=i.ticks(null,c),n=function(a){return a.data};this.opts("render-vertical")&&_.each(h,function(c){a.vline().attr("func",{x:function(a){return d.apply(a.data)},y1:u.constfunc(k),y2:u.constfunc(l),stroke:b.opts("stroke"),"stroke-width":b.opts("strokewidth"),"stroke-dasharray":b.opts("dasharray"),"stroke-dashoffset":b.opts("dashoffset")}).attr("data",c)}),this.opts("render-horizontal")&&_.each(m,function(c){a.hline().attr("func",{y:function(a){return i.apply(a.data)},x1:u.constfunc(f),x2:u.constfunc(g),stroke:b.opts("stroke"),"stroke-width":b.opts("strokewidth"),"stroke-dasharray":b.opts("dasharray"),"stroke-dashoffset":b.opts("dashoffset")}).attr("data",c)})}}(gg),function(a){"use strict";var b=["x","y","text","group","group2","grp"];a.guide.legend=u.makeClass("gg.guide.legend",a.guide.base),a.guide.legend.prototype.init=function(c,d,e){a.guide.base.prototype.init.call(this),this._graph=c,this._layers=d,this._scales=e,this._aes=_.chain(e).keys().reject(function(a){return u.isDerivedAes(a)||_.indexOf(b,a)!=-1}).value(),this._mappings=_.map(d,function(a){return a.getMap()}),this._legends=null},a.guide.legend.prototype.group=function(){this._legends=[];var a=_.clone(this._aes);while(a.length>0){var b=[],c=a.pop(),d=_.pluck(this._mappings,c),e=null;b.push(c);var f=0;while(f<a.length)e=_.pluck(this._mappings,a[f]),_.isEqual(e,d)?b.push(a.splice(f,1)[0]):f++;this._legends.push(b)}return this},a.guide.legend.prototype.render=function(a){_.isNull(this._legends)&&this.group();var b=this,c,d=0,e=0,f=a.position=="bottom"?"h":"v";_.each(this._legends,function(g){var h={aes:g,canvas:a.canvas.differentOffset(d,e),orientation:f,chartWidth:a.chartWidth,chartHeight:a.chartHeight};c=b._renderEach(h),f=="h"?e+=c.y+15:e+=c.y+10})},a.guide.legend.prototype._renderEach=function(b){var c=this,d=b.aes,e=b.canvas,f=d[0],g=this._scales[f];if(g.type()=="number")for(var h=1;h<d.length;h++)if(this._scales[d[h]].type()=="category"){f=d[h],g=this._scales[d[h]];break}var i=[],j=[];for(var h=0;h<this._layers.length;h++)this._mappings[h][f]&&(j.push(this._layers[h]),i.push(this._layers[h]._cls_name.split(".")[2]));i=_.uniq(i);var k={color:u.constfunc("#000000"),stroke:u.constfunc("#000000"),strokewidth:u.constfunc(0),symbol:u.constfunc(a.symbol.DIAMOND),radius:u.constfunc(5),opacity:u.constfunc(1)};if(i.length==1){if(i[0]=="point")k.symbol=u.constfunc(a.symbol.CIRCLE);else if(i[0]=="line"||i[0]=="path")k.symbol=u.constfunc(a.symbol.CROSS),k.strokewidth=u.constfunc(1);_.each(_.keys(k),function(a){if(a!="radius"){var b=j[0].opts(a);if(_.isString(b)||_.isNumber(b))k[a]=u.constfunc(b)}})}_.each(d,function(a){k[a]=_.bind(c._scales[a].apply,c._scales[a],"data")});var l=g.type()=="category"?this._graph.levels(f).length:5,m=g.ticks(l),n=i[0]=="line"||i[0]=="path"?this._render_line_tick:this._render_point_tick,o=0,p=0,q=function(a){o+=a.getBBox().width},r=function(a){p+=a.getBBox().height},s=e.text().attr("func",{x:0,y:0,"font-size":"13px","font-weight":"bold","text-anchor":"start",text:u.constfunc(c._graph._varlabel(f))}).attr("data",{});r(s);var t,v,w=0,x=0;return _.each(m,function(a){t=n(a,e,k,o,p),v=c._render_label(a,e,o+20,p),b.orientation=="v"?(p+=Math.max(v.getBBox().height,t.getBBox().height),x=Math.max(x,p)):(o+=v.getBBox().width+40,w=Math.max(w,o),o>b.chartWidth-v.getBBox().width&&(p+=Math.max(v.getBBox().height,t.getBBox().height),x=Math.max(x,p),o=0))}),b.orientation=="h"&&(x+=Math.max(v.getBBox().height,t.getBBox().height)),{y:x,x:w}},a.guide.legend.prototype._render_line_tick=function(a,b,c,d,e){return b.line().attr("func",{x1:u.constfunc(0),x2:u.constfunc(13),y1:u.constfunc(d),y2:u.constfunc(e),stroke:c.color,"fill-opacity":c.opacity,"stroke-width":c.strokewidth}).attr("data",a)},a.guide.legend.prototype._render_point_tick=function(a,b,c,d,e){return b.point().attr("func",{cx:u.constfunc(d+7),cy:u.constfunc(e),r:c.radius,symbol:c.symbol,fill:c.color,stroke:c.stroke,"fill-opacity":c.opacity,"stroke-width":c.strokewidth}).attr("data",a)},a.guide.legend.prototype._render_label=function(a,b,c,d){return b.text().attr("func",{x:u.constfunc(c),y:u.constfunc(d),"font-size":"12px","text-anchor":"start",text:function(a){return String(a.label)}}).attr("data",a)}}(gg),function(a){a.layer.area=u.makeClass("gg.layer.area",a.layer.base),a.layer.area.prototype.init=function(){a.layer.base.prototype.init.call(this),this.opts("stroke","none").opts("opacity",.4).opts("color","steelblue").opts("strokewidth",0).opts("padding",.5)},a.layer.area.prototype.render=function(a){var b=a.coord,c=a.cell,d=a.scales,e=a.rawScales.y.opts("domain_low"),f=d.y(e),g=function(a,b){var c=a.length;a.push(a[a.length-1]),a.push(a[0]),b.push(f),b.push(f)},h,i;h=d.x,d.y_stack?i=d.y_stack:i=d.y,_.each(a.computedData,function(a){b.poly().attr("func",{x:h,y:i,_sort:h,_pointModifier:g,_style:d}).attr("data",a)})},a.layer.area.prototype.imputeMapping=function(b){return a.layer.base.prototype.imputeMapping.call(this,b,{color:"stroke",group:["stroke","color"]})}}(gg),function(a){"use strict",a.layer.bar=u.makeClass("gg.layer.bar",a.layer.base),a.layer.bar.prototype.init=function(){a.layer.base.prototype.init.call(this);var b=0;b<0&&a.error(310,"Padding should be between 0 and 0.5"),b>.5&&this.warn(310,"Padding should be between 0 and 0.5"),this.opts("padding",b).opts("strokewidth",0)},a.layer.bar.prototype.defaultMin=function(a){if(a=="y")return 0},a.layer.bar.prototype.defaultScales=function(){return{x:a.scale.discrete("x")}},a.layer.bar.prototype.checkErrors=function(b){var c=b.rawScales;return c.y.type()!=="number"?(a.error(311,"y scale must be numeric."),!0):!1},a.layer.bar.prototype.render=function(a){var b=a.coord,c=a.scales,d=a.width,e=d/2*(1-this.opts("padding")*2),f=a.rawScales.y.opts("domain_low");_.isNumber(f)||this.warn(-2,"originLocation is numeric.");var g,h=null,i=null,j,k;if(a.align=="center")k=u.add(c.x,e),j=u.sub(c.x,e);else if(a.align=="left"){var l=d/2-e;k=u.add(c.x,l+e*2),j=u.add(c.x,l)}c.y_1&&c.y_2?(i=c.y_1,h=c.y_2):c.y_override?(i=c.y_override,g=i(f),h=g):(i=c.y,g=i(f),h=g),a.computedData.each(function(a){b.rect().attr("func",{x1:j,x2:k,y1:i,y2:h,_style:c}).attr("data",a)})},a.layer.bar.prototype.hasGroup=function(){return!1}}(gg),function(a){"use strict",a.layer.box=u.makeClass("gg.layer.box",a.layer.base),a.layer.box.prototype.init=function(){a.layer.base.prototype.init.call(this);var b=0;b<0&&a.error(310,"Padding should be between 0 and 0.5"),b>.5&&this.warn(310,"Padding should be between 0 and 0.5");var c=this;_.each(a.opts.box,function(a,b){c.opts(b,a)}),this.opts("padding",b),this._default_stats=a.stats.box},a.layer.box.prototype.defaultMin=function(a){if(a=="y")return 0},a.layer.box.prototype.checkErrors=function(a){var b=_.keys(this.getMap());return _.include(b,"y")?!1:(this.warn(320,"No mapping has been set in layer "+this._cls_name),!0)},a.layer.box.prototype.render=function(a){var b=a.coord,c=a.scales,d=a.width,e=d/2*(1-this.opts("padding")*2),f,g,h;if(a.align=="center")g=u.add(c.x,e),f=u.sub(c.x,e),h=c.x;else if(a.align=="left"){var i=d/2-e;g=u.add(c.x,i+e*2),f=u.add(c.x,i),h=u.add(c.x,e)}c.y_q0||(c.y_q0=c.y),c.y_q1||(c.y_q1=c.y),c.y_q2||(c.y_q2=c.y),c.y_q3||(c.y_q3=c.y),c.y_q4||(c.y_q4=c.y),a.computedData.each(function(a){b.vline().attr("func",{y1:c.y_q0,y2:c.y_q1,x:h,_style:c}).attr("data",a),b.vline().attr("func",{y1:c.y_q3,y2:c.y_q4,x:h,_style:c}).attr("data",a),b.rect().attr("func",{x1:f,x2:g,y1:c.y_q1,y2:c.y_q3,_style:c}).attr("data",a),b.hline().attr("func",{x1:f,x2:g,y:c.y_q4,_style:c}).attr("data",a),b.hline().attr("func",{x1:f,x2:g,y:c.y_q2,_style:c}).attr("data",a),b.hline().attr("func",{x1:f,x2:g,y:c.y_q0,_style:c}).attr("data",a)})},a.layer.box.prototype.imputeMapping=function(b){return a.layer.base.prototype.imputeMapping.call(this,b,{group:"x"})},a.layer.box.prototype.hasGroup=function(){return!1},a.layer.box.prototype.checkErrors=function(b){var c=b.rawScales;return c.y.type()!=="number"?(a.error(311,"y scale must be numeric."),!0):!1}}(gg),function(a){"use strict",a.layer.histo=u.makeClass("gg.layer.histo",a.layer.bar),a.layer.histo.prototype.init=function(){a.layer.bar.prototype.init.call(this),this._default_stats=a.stats.bin}}(gg),function(a){"use strict",a.layer.jitter=u.makeClass("gg.layer.jitter",a.layer.base),a.layer.jitter.prototype.init=function(){a.layer.base.prototype.init.call(this),this.opts("radius",3),this.opts("symbol",a.symbol.CIRCLE)},a.layer.jitter.prototype.render=function(a){var b=a.coord,c=a.scales,d=20,e=20,f={cx:function(a){return c.x(a)+d*(Math.random()-.5)},cy:function(a){return c.y(a)+e*(Math.random()-.5)},r:c.radius,symbol:c.symbol,stroke:c.stroke,"stroke-width":c.strokewidth,"fill-opacity":c.opacity,fill:c.color};a.computedData.each(function(a){b.point().attr("func",f).attr("data",a)})},a.layer.jitter.prototype.hasGroup=function(){return!1}}(gg),function(a){"use strict",a.layer.line=u.makeClass("gg.layer.line",a.layer.base),a.layer.line.prototype.init=function(){a.layer.base.prototype.init.call(this);var b=this;_.each(a.opts.line,function(a,c){b.opts(c,a)})},a.layer.line.prototype.render=function(a){var b=a.coord,c=a.scales,d;c.y_override?d=c.y_override:d=c.y,_.each(a.computedData,function(a){b.poly().attr("func",{x:c.x,y:d,_sort:c.x,stroke:c.color,fill:"none","stroke-width":c.strokewidth}).attr("data",a)})},a.layer.line.prototype.imputeMapping=function(b){return a.layer.base.prototype.imputeMapping.call(this,b,{group:["stroke","color"]})},a.layer.line.prototype.defaultMin=function(a){if(a=="y")return 0}}(gg),function(a){"use strict",a.layer.path=u.makeClass("gg.layer.path",a.layer.base),a.layer.path.prototype.init=function(){a.layer.base.prototype.init.call(this);var b=this;_.each(a.opts.line,function(a,c){b.opts(c,a)})},a.layer.path.prototype.render=function(a){var b=a.coord,c=a.scales;_.each(a.computedData,function(a){b.poly().attr("func",{x:c.x,y:c.y,stroke:c.color,fill:"none","stroke-width":c.strokewidth}).attr("data",a)})},a.layer.line.prototype.imputeMapping=function(b){return a.layer.base.prototype.imputeMapping.call(this,b,{group:["stroke","color"]})}}(gg),function(a){"use strict",a.layer.point=u.makeClass("gg.layer.point",a.layer.base),a.layer.point.prototype.init=function(){a.layer.base.prototype.init.call(this),this.opts("radius",3),this.opts("symbol",a.symbol.CIRCLE)},a.layer.point.prototype.render=function(a){var b=a.coord,c=a.scales,d={cx:c.x,cy:c.y,r:c.radius,symbol:c.symbol,_style:c},e=this.opts("tooltip");a.computedData.each(function(a){u.addTooltip(b.point().attr("func",d).attr("data",a),e)},this.opts("render-max"))},a.layer.point.prototype.imputeMapping=function(b){return a.layer.base.prototype.imputeMapping.call(this,b,{color:"stroke"})},a.layer.point.prototype.hasGroup=function(){return!1},a.layer.base.prototype.requiredMap=function(){return["x","y"]}}(gg),function(a){"use strict",a.layer.text=u.makeClass("gg.layer.text",a.layer.base),a.layer.text.prototype.init=function(){a.layer.base.prototype.init.call(this);var b=this;_.each(a.opts.text,function(a,c){b.opts(c,a)})},a.layer.text.prototype.render=function(a){var b=a.coord,c=a.scales;a.computedData.each(function(a){b.text().attr("func",{x:c.x,y:c.y,text:c.text,fill:c.color,"fill-opacity":c.opacity,"font-size":c.fontsize,"font-family":c.font}).attr("data",a)})},a.layer.text.prototype.hasGroup=function(){return!1}}(gg),function(a){"use strict",a.layer.tile=u.makeClass("gg.layer.tile",a.layer.base),a.layer.tile.prototype.init=function(){a.layer.base.prototype.init.call(this),this.opts("stroke","none").opts("padding",.5)},a.layer.tile.prototype.render=function(a){var b=a.scales,c=a.rawScales.x.width(),d=a.rawScales.y.width(),e=c/2,f=d/2,g=a.coord;a.computedData.each(function(a,c){g.rect().attr("func",{x1:u.sub(b.x,e),y1:u.sub(b.y,f),x2:u.add(b.x,e),y2:u.add(b.y,f),_style:b}).attr("data",a)})},a.layer.tile.prototype.hasGroup=function(){return!1}}(gg),function(a){"use strict",a.scale.continuous=u.makeClass("gg.scale.continuous",a.scale.base),a.scale.continuous.prototype.init=function(b,c,d){a.scale.base.prototype.init.call(this),this._type="number",this._d3scale=null,this._attr.min=_.isNumber(c)?c:null,this._attr.max=_.isNumber(d)?d:null,this._useDefault=!1,this._defaultMin=null,this._defaultMax=null,this.opts("transform",b||"linear").opts("expand",.05),this.opts("transform")==="log"&&this.opts("absolute_min",1)},a.scale.continuous.prototype.domain=function(a){return arguments.length===1?(this.min(a[0]),this.max(a[1]),this):[this._attr.domain_low,this._attr.domain_high]},a.scale.continuous.prototype.width=function(){return this._attr.width||(this._attr.width=this._makeWidth()),this._attr.width},a.scale.continuous.prototype.distance=function(a,b){return Math.abs(this._d3scale(a)-this._d3scale(b))},a.scale.continuous.prototype._makeDefaultMinMax=function(){var a=this._aes;this._defaultMin=this._graph.defaultMin(a),this._defaultMax=this._graph.defaultMax(a),_.isNumber(this._defaultMin)&&this._defaultMin<this._attr.absolute_min&&(this._defaultMin=this._attr.absolute_min),_.isNumber(this._defaultMax)&&this._defaultMax<this._attr.absolute_max&&(this._defaultMax=this._attr.absolute_max)},a.scale.continuous.prototype._makeWidth=function(){var a=this._aes,b=this._graph.levels(a,null,this._facetIndex),c=b.length,d;if(c<=1)d=this.rangeSize();else{var e=_.bind(this._apply,this);d=u.minimumDelta(_.map(b,e))}return Math.max(d,1)},a.scale.continuous.prototype._makeDomain=function(){var b=this._aes,c=this._attr.min,d=this._attr.max,e,f,g=0,h=2;if(_.isNumber(c)&&_.isNumber(d))g=c,h=d;else if(this._graph._layers.length>0){if(this._graph.isMapped(b,!0))e=this._graph.min(b,null,this._facetIndex),f=this._graph.max(b,null,this._facetIndex);else{var i=_.chain(this._graph._layers).invoke("opts",b).value();e=_.min(i)-1,f=_.max(i)+1}if(this.opts("expand")>0){var j=(f-e)*this.opts("expand");if(e!==0||this._aes!="y")e-=j;f+=j}_.isNumber(this._defaultMin)&&e<this._defaultMin&&(e=this._defaultMin),_.isNumber(this._defaultMax)&&f>this._defaultMax&&(f=this._defaultMax),g=_.isNumber(c)?c:e,h=_.isNumber(d)?d:f}return _.isNumber(this._attr.absolute_min)&&(g=Math.max(g,this._attr.absolute_min)),_.isNumber(this._attr.absolute_max)&&(h=Math.min(h,this._attr.absolute_max)),this._saneNumber(g)||a.error(406,"min() calculation returned an invalid number."),this._saneNumber(h)||a.error(406,"max() calculation returned an invalid number."),g>h&&a.error(408,"min is set to be bigger than max in a continuous scale."),this.opts("domain_low",g),this.opts("domain_high",h),[g,h]},a.scale.continuous.prototype.make=function(b){this.range()||a.error(407,"Continuous scale's range is not set."),this._d3scale=this.opts("transform")=="log"?d3.scale.log():d3.scale.linear(),this._facetIndex=_.isNumber(b)?b:-1;var c=this._makeDomain();return this._d3scale.domain(c).range(this.range()),this},a.scale.continuous.prototype._apply=function(b){this._d3scale||this.make();var c=a.opts.epsilon;return b===null?null:((b<this._attr.domain_low-c||b>this._attr.domain_high+c)&&this.warn(404,"Continuous scale got value "+b+" that is not in the "+"domain ["+this._attr.domain_low+","+this._attr.domain_high+"]"),this._d3scale(b))},a.scale.base.prototype.ticks=function(b,c){var d=0,e=this._attr.domain_low,f=this._attr.domain_high;b=this._getNumticks(b,c),this.opts("transform")=="log"&&(e=Math.max(Math.log(e)/Math.LN10,0),f=Math.log(f)/Math.LN10,d=a.opts.epsilon);var g=f-e,h=Math.pow(10,Math.floor(Math.log(g/b)/Math.LN10)),i=b/g*h;i<=.15?h*=10:i<=.35?h*=5:i<=.75&&(h*=2);var j=[],k=Math.ceil(e/h)*h,l=-Math.floor(Math.log(h)/Math.LN10);while(k<=f+d){var m=k,n=m;if(this.opts("transform")=="log"){m%1>d&&(m=Math.floor(m)+Math.log(10*(m%1))/Math.LN10),m=Math.exp(m*Math.LN10);if(m<this._attr.domain_low-d){k+=h;continue}if(m>this._attr.domain_high+d)break;n=u.prettify(m)}else n=u.prettify(m,l);j.push(this._tickObject(m,this.apply(m),n)),k+=h}return j},a.scale.continuous.prototype.CONTINUOUS=!0}(gg),function(a){"use strict",a.scale.discrete=u.makeClass("gg.scale.discrete",a.scale.base),a.scale.discrete.prototype.init=function(){a.scale.base.prototype.init.call(this),this._type="category",this._levels=null,this._eachWidth=null,this._padding=.02,this._rangeMin=null},a.scale.discrete.prototype.domain=function(a){return arguments.length===0?this._levels:(this._levels=a,this)},a.scale.discrete.prototype.padding=function(a){return arguments.length===0?this._padding:(u.assertNumber(a),this._padding=a,this)},a.scale.discrete.prototype.width=function(){return this._eachWidth||this.make(),this._eachWidth},a.scale.discrete.prototype.make=function(b){this.range()||a.error(407,"Discrete scale's range is not set."),this._facetIndex=_.isNumber(b)?b:-1;var c=this.range(),d=Math.abs(c[1]-c[0]);this._rangeMin=_.min(c),this._levels||(this._levels=this._graph.levels(this._aes,null,b)),this._eachWidth=d/this._levels.length,this._eachWidth=Math.abs(this._eachWidth);var e=this._padding>=1?this._padding:this._eachWidth*this._padding;return this._eachWidth-=e,this._padding=e,this},a.scale.discrete.prototype._apply=function(a){this._levels||this.make();var b=_.indexOf(this._levels,a);return b===-1&&this.warn(404,"Discrete scale got value "+a+" that is not in the domain."),this._rangeMin+b*(this._eachWidth+this._padding)+this._padding/2+this._eachWidth/2},a.scale.discrete.prototype.ticks=function(a,b){var a=this._getNumticks(a,b),c=Math.max(1,Math.round(this._levels.length/a)),d=Math.floor(c/2),e=[];for(var f=d;f<this._levels.length;f+=c)e.push(this._tickObject(this._levels[f],this.apply(this._levels[f]),this._levels[f]));return e},a.scale.discrete.prototype.toCode=function(a,b){var c={cls:this._cls_name,funcs:[["padding",this._padding],["opts",JSON.stringify(this.getAttr())]]};return this._levels&&c.funcs.push(["domain",JSON.stringify(this._levels)]),u.toCode(a,b,c)},a.scale.discrete.prototype.DISCRETE=!1}(gg),function(a){"use strict",a.scale.gradient=u.makeClass("gg.scale.gradient",a.scale.continuous),a.scale.gradient.prototype.init=function(b,c){a.scale.continuous.prototype.init.call(this),this._attr.range_low=b||a.opts.gradient.low,this._attr.range_high=c||a.opts.gradient.high,this._d3scale=null},a.scale.gradient.prototype.make=function(){return this.range()||a.error(407,"Gradient scale's range is not set."),_.isNumber(this._attr.min)||(this._attr.min=this._graph.min(this._aes)),_.isNumber(this._attr.max)||(this._attr.max=this._graph.max(this._aes)),this._d3scale=d3.scale.linear().domain([this._attr.min,this._attr.max]).range(this.range()),this},a.scale.gradient.prototype._apply=function(a){return this._d3scale||this.make(),this._d3scale(a)}}(gg),function(a){"use strict",a.scale.id=u.makeClass("gg.scale.id",a.scale.base),a.scale.id.prototype.init=function(){a.scale.base.prototype.init.call(this),this._type=null},a.scale.id.prototype.type=function(){return this._type||(this._type=this._graph.type(this._aes)),this._type},a.scale.id.prototype.domain=function(){return this._type=="number"?[this._graph.min(this._aes),this._graph.max(this._aes)]:this._graph.levels(this._aes)},a.scale.id.prototype.range=function(){return this.domain()},a.scale.id.prototype.make=function(){this._type=="number"&&(this._attr.min=this._graph.min(this._aes),this._attr.max=this._graph.max(this._aes))},a.scale.id.prototype._apply=function(a){return a}}(gg),function(a){"use strict",a.scale.palette=u.makeClass("gg.scale.palette",a.scale.discrete),a.scale.palette.prototype.init=function(b){a.scale.discrete.prototype.init.call(this),this._paletteName=b,this._d3scale=null},a.scale.palette.prototype.make=function(b){b?this._levels=b:this._levels||(this._levels=this._graph.levels(this._aes));var c=this._levels.length;return this._paletteName&&!1?this._d3scale=d3.scale.ordinal().domain(this._levels).range(colorbrewer[this.paletteName][c]):c<=10?this._d3scale=d3.scale.category10():c<=20?this._d3scale=d3.scale.category20():a.error(405,"Palette scale cannot handle more than 20 cateogries (there are "+c+")."),this},a.scale.palette.prototype._apply=function(a){return this._d3scale||this.make(),this._d3scale(a)},a.scale.palette.prototype.toCode=function(a,b){var c={cls:this._cls_name,funcs:[["opts",JSON.stringify(this.getAttr())]]};return this._paletteName&&(c.params=[u.qt(this._paletteName)]),this._levels&&c.funcs.push(["domain",JSON.stringify(this._levels)]),u.toCode(a,b,c)}}(gg),function(a){"use strict",a.scale.symbol=u.makeClass("gg.scale.symbol",a.scale.discrete),a.scale.symbol.prototype.init=function(){a.scale.discrete.prototype.init.call(this),this._symbols=[1,2,3,4,5,6,7,8,9],this._numSymbols=this._symbols.length},a.scale.symbol.prototype.make=function(a){return a?this._levels=a:this._levels||(this._levels=this._graph.levels(this._aes)),this._numLevels=this._levels.length,this},a.scale.symbol.prototype._apply=function(a){return this._d3scale||this.make(),this._symbols[_.indexOf(this._levels,a)%this._numSymbols]}}(gg),function(a){"use strict",a.scale.time=u.makeClass("gg.scale.time",a.scale.continuous),a.scale.time.prototype.init=function(){a.scale.continuous.prototype.init.call(this),this.opts("pixel_per_tick_x",90)},a.scale.time.prototype.make=function(a){this._facetIndex=_.isNumber(a)?a:-1,this._d3scale=d3.time.scale();var b=this._makeDomain();this._d3scale.domain(b).range(this.range())},a.scale.time.prototype._makeDomain=function(){var a=this._aes,b=this.min(),c=this.max();if(_.isUndefined(b)||b===null)b=this._graph.min(a,null,this._facetIndex),this.min(b);if(_.isUndefined(c)||c===null)c=this._graph.max(a,null,this._facetIndex),this.max(c);return[b,c]},a.scale.time.prototype.ticks=function(a){a=this._getNumticks(a);var b=this,c=this._d3scale.ticks(a),d=this._d3scale.tickFormat(a),e=_.map(c,function(a){return b._tickObject(a,b.apply(a),d(a))});return e}}(gg),function(a){"use strict",a.scale.time_gradient=u.makeClass("gg.scale.time_gradient",a.scale.time),a.scale.time_gradient.prototype.init=function(b,c){a.scale.time.prototype.init.call(this),this._attr.range_low=b||a.opts.gradient.low,this._attr.range_high=c||a.opts.gradient.high,this._d3scale=null},a.scale.time.prototype.make=function(){this._d3scale=d3.time.scale();var a=this._makeDomain();this._d3scale.domain(a).range(this.range())},a.scale.time_gradient.prototype._apply=function(a){return this._d3scale||this.make(),this._d3scale(a)}}(gg),function(a){"use strict",a.stats.aggregate=u.makeClass("gg.stats.aggregate",a.stats.base),a.stats.aggregate.prototype.init=function(){a.stats.base.prototype.init.call(this),this.number(12)},a.stats.aggregate.prototype.number=function(a){return arguments.length===0?this._attr.number:(this._attr.number=a,this)},a.stats.aggregate.prototype.calculateStats=function(a,b){var c=b.mapping,d=b.scales,e=c.group_stats,f=null,g=this.number(),h=null;e&&(h=a.type(e));var i=!0;d.x&&(i=d.x.CONTINUOUS);if(i&&e&&g&&(h=="number"||h=="date")){var j;h=="number"?j=this.createGroupFunction:h=="date"&&(j=this.createDateGroupFunction);var k=j(a.min(e),a.max(e),g);b.groupFunctions={group_stats:k},b.hasGroupFunction=!0,b.width=k.width}return this.group(a,b)},a.stats.aggregate.prototype.postProcess=function(a,b){var c=b.mapping;if(b.hasGroupFunction){var d=c.group_stats,e=b.groupFunctions.group_stats;_.each(a,function(a){var b=a.len();for(var c=0;c<b;c++){var f=a._internal[c];f[d]=e(f[d])}})}return a}}(gg),function(a){a.stats.bin=u.makeClass("gg.stats.bin",a.stats.aggregate),a.stats.bin.prototype.compute=function(b,c){var d=b.getObject(0);return d.$count=b.len(),a.data([d])},a.stats.bin.prototype.imputeMapping=function(b){var c=a.stats.base.prototype.imputeMapping.call(this,b,{group_stats:["x","group"]});return _.extend(c,{y:"$count"})},a.stats.bin.prototype.keys=function(){return["$count"]}}(gg),function(a){"use strict",a.stats.box=u.makeClass("gg.stats.box",a.stats.aggregate),a.stats.box.prototype.imputeMapping=function(b){var c=a.stats.aggregate.prototype.imputeMapping.call(this,b,{group_stats:["group","x"]});return _.extend(c,{y_q0:"$q0",y_q1:"$q1",y_q2:"$q2",y_q3:"$q3",y_q4:"$q4"})},a.stats.box.prototype.compute=function(b,c){var d=c.mapping,e=b.getObject(0),f=d.y,g=b.get(f),h=g.length,i=h-1,j=_.sortBy(g,u.identity),k=j[0],l=j[i],m=i/4,n=i/2,o=i/4*3,p=(j[Math.ceil(m)]+j[Math.floor(m)])/2,q=(j[Math.ceil(n)]+j[Math.floor(n)])/2,r=(j[Math.ceil(o)]+j[Math.floor(o)])/2;return e.$q0=k,e.$q1=p,e.$q2=q,e.$q3=r,e.$q4=l,u.assertNumber(p),u.assertNumber(q),u.assertNumber(r),u.assertNumber(k),u.assertNumber(l),a.data([e])},a.stats.box.prototype.keys=function(){return["$q0","$q1","$q2","$q3","$q4"]}}(gg),gg.stats.count=gg.stats.bin,gg.stats.id=u.makeClass("gg.stats.id",gg.stats.base),function(a){"use strict",a.stats.mean=u.makeClass("gg.stats.mean",a.stats.aggregate),a.stats.mean.prototype.compute=function(b,c){var d=c.mapping,e=c.attr,f=b.getObject(0),g=d.y;if(g){var h=u.sum.apply(b.get(g)),i=h/b.len();f.$mean=i}else f.$mean=e.y;return a.data([f])},a.stats.mean.prototype.imputeMapping=function(b){var c=a.stats.base.prototype.imputeMapping.call(this,b,{group_stats:"x"});return _.extend(c,{y_sum:"$mean"})},a.stats.mean.prototype.keys=function(){return["$mean"]}}(gg),function(a){"use strict",a.stats.stack=u.makeClass("gg.stats.stack",a.stats.aggregate),a.stats.stack.prototype.compute=function(b,c){var d=c.mapping,e=c.attr,f=d.y,g=[],h=b.len(),i=0;if(f){var j=b.getTypeObj(f).represent,k=d.group_stats||f,l=function(a){return j(a[k])},m=_.sortBy(b.getObjects(),l),n=!0;for(var o=0;o<h;o++){var p=n?h-o-1:o,q=m[p];q.$partial_1=i,i+=q[f],q.$partial_2=i,g.push(q)}}else{var r=1;for(var o=0;o<h;o++){var q=b.getObject(o);q.$partial_1=i,i+=r,q.$partial_2=i,g.push(q)}}return a.data(g)},a.stats.stack.prototype.imputeMapping=function(b){var c=a.stats.base.prototype.imputeMapping.call(this,b,{group_stats:"x"});return _.extend(c,{y_1:"$partial_1",y_2:"$partial_2"})},a.stats.stack.prototype.keys=function(){return["$partial_1","$partial_2"]}}(gg),function(a){"use strict",a.stats.sum=u.makeClass("gg.stats.sum",a.stats.aggregate),a.stats.sum.prototype.compute=function(b,c){var d=c.mapping,e=b.getObject(0),f=d.y;if(f){var g=u.sum.apply(b.get(f));e.$sum=g}else e.$sum=c.attr.y*b.len();return a.data([e])},a.stats.sum.prototype.imputeMapping=function(b){var c=a.stats.base.prototype.imputeMapping.call(this,b,{group_stats:"x"});return _.extend(c,{y_override:"$sum"})},a.stats.sum.prototype.keys=function(){return["$sum"]}}(gg),function(a){"use strict",a.stats.tilestat=u.makeClass("gg.stats.tilestat",a.stats.base),a.stats.tilestat.prototype.entry=function(a,b,c){var d={};if(b.x){var e=b.x;d.group=this.createGroupFunction(a.min(e),a.max(e),10),b.group=e}if(b.y){var f=b.y;d.group2=this.createGroupFunction(a.min(f),a.may(f),10),b.group2=f}return this.group(a,b,c,d)},a.stats.tilestat.prototype.imputeMapping=function(b){var c=a.stats.base.prototype.imputeMapping.call(this,b,{group_stats_1:"x",group_stats_2:"y"});return _.extend(c,{y:"$count"})}}(gg),function(a){"use strict",a.symbol=a.symbol||{};var b={},c=Math.sqrt(2),d=0,e=Math.sqrt(3)/2,f=Math.sqrt(3)/2,g=0,h=-Math.sqrt(3)/2,i=-Math.sqrt(3)/2,j=1,k=.5,l=-0.5,m=-1,n=-0.5,o=.5,p=(Math.sqrt(5)-1)/4,q=function(a){return Math.cos(Math.PI/180*36*a)},r=function(a){return Math.sin(Math.PI/180*36*a)},s=q(1),t=q(2),u=q(3),v=q(4),w=q(5),x=q(6),y=q(7),z=q(8),A=q(9),B=r(1),C=r(2),D=r(3),E=r(4),F=r(5),G=r(6),H=r(7),I=r(8),J=r(9),K=1,L=2,M=3,N=4,O=5,P=6,Q=7,R=8,S=9;a.symbol.CIRCLE=K,a.symbol.BOX=L,a.symbol.DIAMOND=M,a.symbol.HEX=N,a.symbol.TRIANGLE=O,a.symbol.TRIANGLE_REVERSE=P,a.symbol.STAR=Q,a.symbol.CROSS=R,a.symbol.X=S,a.symbol.makePath=function(a,b,q,r){var T;if(a==K)return[["M",b,q+r],["A",r,r,0,1,1,b,q-r],["A",r,r,0,1,1,b,q+r],["Z"]];if(a==L)return[["M",b+r,q+r],["L",b-r,q+r],["L",b-r,q-r],["L",b+r,q-r],["Z"]];if(a==M)return[["M",b+r,q],["L",b,q+r],["L",b-r,q],["L",b,q-r],["Z"]];if(a==N)return[["M",b+r*d,q+r*j],["L",b+r*e,q+r*k],["L",b+r*f,q+r*l],["L",b+r*g,q+r*m],["L",b+r*h,q+r*n],["L",b+r*i,q+r*o],["Z"]];if(a==P)return[["M",b+r*d,q+r*j],["L",b+r*f,q+r*l],["L",b+r*h,q+r*n],["Z"]];if(a==O)return[["M",b+r*e,q+r*k],["L",b+r*g,q+r*m],["L",b+r*i,q+r*o],["Z"]];if(a==Q)return T=r*p,[["M",b+T*d,q+T*j],["L",b+r*B,q+r*s],["L",b+T*C,q+T*t],["L",b+r*D,q+r*u],["L",b+T*E,q+T*v],["L",b+r*F,q+r*w],["L",b+T*G,q+T*x],["L",b+r*H,q+r*y],["L",b+T*I,q+T*z],["L",b+r*J,q+r*A],["Z"]];if(a==R)return[["M",b+r,q],["L",b,q],["L",b,q+r],["L",b,q],["L",b-r,q],["L",b,q],["L",b,q-r],["L",b,q],["Z"]];if(a==S)return T=r*c/2,[["M",b+T,q+T],["L",b,q],["L",b+T,q-T],["L",b,q],["L",b-T,q+T],["L",b,q],["L",b-T,q-T],["L",b,q],["Z"]]}}(gg),function(a){"use strict",a.type.category=u.makeClass("gg.type.category",a.type.base),a.type.category.prototype.min=function(b){a.error(802,"Invalid operation min() on categorical variable.")},a.type.category.prototype.max=function(b){a.error(802,"Invalid operation max() on categorical variable.")},a.type.category.prototype.coerce=function(a){return a},a.type.category.prototype.represent=function(a){return a},a.type.category.prototype.validate=function(a){return!0},a.type.category.prototype.defaultScale=function(b){u.assertAes(b);var c=null,d=
{color:a.scale.palette,opacity:a.scale.discrete,radius:a.scale.discrete,stroke:a.scale.palette,strokewidth:a.scale.discrete,symbol:a.scale.symbol,x:a.scale.discrete,y:a.scale.discrete}[b];return d?c=d():c=a.scale.id(),this._postProcess(b,c),c}}(gg),function(a){"use strict",a.type.date=u.makeClass("gg.type.date",a.type.base);var b=function(a){return a.getTime()};a.type.date.prototype.min=function(a){return _.min(_.reject(a,_.isNull),b)},a.type.date.prototype.max=function(a){return _.max(_.reject(a,_.isNull),b)},a.type.date.prototype.coerce=function(a){return new Date(a)},a.type.date.prototype.represent=function(a){return a?a.getTime():0},a.type.date.prototype.validate=function(a){return _.isDate(a)},a.type.date.prototype.defaultScale=function(b){u.assertAes(b);var c=null,d={color:a.scale.time_gradient,opacity:a.scale.time,radius:a.scale.time,stroke:a.scale.time_gradient,strokewidth:a.scale.time,symbol:a.scale.symbol,x:a.scale.time,y:a.scale.time}[b];return d?c=d():c=a.scale.id(),this._postProcess(b,c),c}}(gg),function(a){"use strict",a.type.number=u.makeClass("gg.type.number",a.type.base),a.type.number.prototype.min=function(a){return _.min(_.reject(a,_.isNull))},a.type.number.prototype.max=function(a){return _.max(_.reject(a,_.isNull))},a.type.number.prototype.coerce=function(a){return Number(a)},a.type.number.prototype.represent=function(a){return a},a.type.number.prototype.validate=function(a){return _.isNumber(a)},a.type.number.prototype.defaultScale=function(b){u.assertAes(b);var c=null,d={color:a.scale.gradient,opacity:a.scale.continuous,radius:a.scale.continuous,stroke:a.scale.gradient,strokewidth:a.scale.continuous,symbol:a.scale.symbol,x:a.scale.continuous,y:a.scale.continuous}[b];return d?c=d():c=a.scale.id(),this._postProcess(b,c),c}}(gg),function(a){"use strict",a.type.unknown=u.makeClass("gg.type.unknown",a.type.base),a.type.unknown.prototype.min=function(a){return null},a.type.unknown.prototype.max=function(a){return null},a.type.unknown.prototype.coerce=function(a){return a},a.type.unknown.prototype.represent=function(a){return a},a.type.unknown.prototype.validate=function(a){return!0},a.type.unknown.prototype.defaultScale=function(b){a.error(801,"Attempted to call defaultScale() on unknown type.")}}(gg);var packageFunction=function(a,b){b=b||{};var c=function(c,d){c||a.error(1,"Attempting to package an object that does not exist.");var e=d.length;for(var f=0;f<e;f++){var g=d[f];b[g]?a.error(3,"gg."+g+" is already set."):(c[g]||a.error(2,"Failed while packing "+g+"."),b[g]=c[g])}};return c(a.coord,["cart","polar"]),c(a.facet,["grid","wrap"]),c(a.guide,["axis","legend"]),c(a.layer,["area","bar","box","line","path","point","text","tile"]),c(a.scale,["continuous","discrete","gradient","id","palette","time"]),c(a.stats,["bin","stack","count"]),b};packageFunction(gg,gg),function(a){"use strict",a.stats.ratio=u.makeClass("gg.stats.ratio",a.stats.stack),a.stats.ratio.prototype.compute=function(b,c){var d=c.mapping,e=c.attr,f=d.y,g=[],h=b.len(),i=0;if(f){var j=u.sum.apply(b.get(f)),k=b.getTypeObj(f).represent,l=function(a){return k(a[f])},m=_.sortBy(b.getObjects(),l),n=!0;for(var o=0;o<h;o++){var p=n?h-o-1:o,q=m[p],r;j==0?r=1/h:r=q[f]/j,q.$partial_1=i,i+=r,q.$partial_2=i,q[f]=r,g.push(q)}}else{var r=1/h;for(var o=0;o<h;o++){var q=b.getObject(o);q.$partial_1=i,i+=r,q.$partial_2=i,g.push(q)}}return a.data(g)}}(gg);